const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-D_Om384i.js","assets/index-Dkm9kZbf.js","assets/index-Dr561nqf.css"])))=>i.map(i=>d[i]);
import{e as Tc,f as X,h as qr,i as $c,j as c0,w as Kl,r as Vl,k as Nc,t as ba,m as u0,o as aa,p as _i,V as h0,M as l0,N as B,q as f0,s as mc,u as p0,K as d0,A as g0,v as kh,x as y0,H as v0,F as m0,y as Kh,$ as w0,z as _0,J as b0,B as Gs,C as Vh,X as I0,D as E0,E as Dc,_ as Fl,G as Dr,I as x0,L as Fh,O as ls,P as St,U as kt,Q as wi,R as ar,S as P0,T as fs,W as Bl,Y as S0,Z as O0,a0 as R0,a1 as Gl,a2 as A0,a3 as Wl,a4 as Jl,a5 as ds,a6 as wc,a7 as da,a8 as ys,a9 as C0,aa as ga,ab as T0,ac as $0,ad as N0,ae as D0,af as oa,ag as q0,ah as j0,ai as rc,aj as Bh,ak as L0,al as z0,am as M0,an as Gh,ao as U0,ap as H0,aq as k0,ar as K0,as as V0,at as F0,au as B0,av as Vs,aw as Ql,ax as ic,ay as G0,az as W0,aA as J0}from"./index-Dkm9kZbf.js";import{s as Ys,a as Ia,r as Q0,f as gs,g as Yl,i as Kr,b as Ea,c as Wh,d as Y0,e as Z0,h as qc,p as X0,j as jc,k as xa,l as mi,m as ew,n as Ei}from"./index.es-Wu-QzEe2.js";const tw=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,rw=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,iw=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function sw(o,t){if(o==="__proto__"||o==="constructor"&&t&&typeof t=="object"&&"prototype"in t){nw(o);return}return t}function nw(o){console.warn(`[destr] Dropping "${o}" key to prevent prototype pollution.`)}function ca(o,t={}){if(typeof o!="string")return o;const i=o.trim();if(o[0]==='"'&&o.endsWith('"')&&!o.includes("\\"))return i.slice(1,-1);if(i.length<=9){const s=i.toLowerCase();if(s==="true")return!0;if(s==="false")return!1;if(s==="undefined")return;if(s==="null")return null;if(s==="nan")return Number.NaN;if(s==="infinity")return Number.POSITIVE_INFINITY;if(s==="-infinity")return Number.NEGATIVE_INFINITY}if(!iw.test(o)){if(t.strict)throw new SyntaxError("[destr] Invalid JSON");return o}try{if(tw.test(o)||rw.test(o)){if(t.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(o,sw)}return JSON.parse(o)}catch(s){if(t.strict)throw s;return o}}function aw(o){return!o||typeof o.then!="function"?Promise.resolve(o):o}function qt(o,...t){try{return aw(o(...t))}catch(i){return Promise.reject(i)}}function ow(o){const t=typeof o;return o===null||t!=="object"&&t!=="function"}function cw(o){const t=Object.getPrototypeOf(o);return!t||t.isPrototypeOf(Object)}function ya(o){if(ow(o))return String(o);if(cw(o)||Array.isArray(o))return JSON.stringify(o);if(typeof o.toJSON=="function")return ya(o.toJSON());throw new Error("[unstorage] Cannot stringify value!")}function Zl(){if(typeof Buffer>"u")throw new TypeError("[unstorage] Buffer is not supported!")}const _c="base64:";function uw(o){if(typeof o=="string")return o;Zl();const t=Buffer.from(o).toString("base64");return _c+t}function hw(o){return typeof o!="string"||!o.startsWith(_c)?o:(Zl(),Buffer.from(o.slice(_c.length),"base64"))}function nr(o){return o?o.split("?")[0].replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""):""}function lw(...o){return nr(o.join(":"))}function ua(o){return o=nr(o),o?o+":":""}const fw="memory",pw=()=>{const o=new Map;return{name:fw,getInstance:()=>o,hasItem(t){return o.has(t)},getItem(t){return o.get(t)??null},getItemRaw(t){return o.get(t)??null},setItem(t,i){o.set(t,i)},setItemRaw(t,i){o.set(t,i)},removeItem(t){o.delete(t)},getKeys(){return[...o.keys()]},clear(){o.clear()},dispose(){o.clear()}}};function dw(o={}){const t={mounts:{"":o.driver||pw()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},i=d=>{for(const _ of t.mountpoints)if(d.startsWith(_))return{base:_,relativeKey:d.slice(_.length),driver:t.mounts[_]};return{base:"",relativeKey:d,driver:t.mounts[""]}},s=(d,_)=>t.mountpoints.filter(S=>S.startsWith(d)||_&&d.startsWith(S)).map(S=>({relativeBase:d.length>S.length?d.slice(S.length):void 0,mountpoint:S,driver:t.mounts[S]})),a=(d,_)=>{if(t.watching){_=nr(_);for(const S of t.watchListeners)S(d,_)}},u=async()=>{if(!t.watching){t.watching=!0;for(const d in t.mounts)t.unwatch[d]=await Jh(t.mounts[d],a,d)}},f=async()=>{if(t.watching){for(const d in t.unwatch)await t.unwatch[d]();t.unwatch={},t.watching=!1}},y=(d,_,S)=>{const R=new Map,D=A=>{let Q=R.get(A.base);return Q||(Q={driver:A.driver,base:A.base,items:[]},R.set(A.base,Q)),Q};for(const A of d){const Q=typeof A=="string",te=nr(Q?A:A.key),ce=Q?void 0:A.value,oe=Q||!A.options?_:{..._,...A.options},ne=i(te);D(ne).items.push({key:te,value:ce,relativeKey:ne.relativeKey,options:oe})}return Promise.all([...R.values()].map(A=>S(A))).then(A=>A.flat())},m={hasItem(d,_={}){d=nr(d);const{relativeKey:S,driver:R}=i(d);return qt(R.hasItem,S,_)},getItem(d,_={}){d=nr(d);const{relativeKey:S,driver:R}=i(d);return qt(R.getItem,S,_).then(D=>ca(D))},getItems(d,_){return y(d,_,S=>S.driver.getItems?qt(S.driver.getItems,S.items.map(R=>({key:R.relativeKey,options:R.options})),_).then(R=>R.map(D=>({key:lw(S.base,D.key),value:ca(D.value)}))):Promise.all(S.items.map(R=>qt(S.driver.getItem,R.relativeKey,R.options).then(D=>({key:R.key,value:ca(D)})))))},getItemRaw(d,_={}){d=nr(d);const{relativeKey:S,driver:R}=i(d);return R.getItemRaw?qt(R.getItemRaw,S,_):qt(R.getItem,S,_).then(D=>hw(D))},async setItem(d,_,S={}){if(_===void 0)return m.removeItem(d);d=nr(d);const{relativeKey:R,driver:D}=i(d);D.setItem&&(await qt(D.setItem,R,ya(_),S),D.watch||a("update",d))},async setItems(d,_){await y(d,_,async S=>{if(S.driver.setItems)return qt(S.driver.setItems,S.items.map(R=>({key:R.relativeKey,value:ya(R.value),options:R.options})),_);S.driver.setItem&&await Promise.all(S.items.map(R=>qt(S.driver.setItem,R.relativeKey,ya(R.value),R.options)))})},async setItemRaw(d,_,S={}){if(_===void 0)return m.removeItem(d,S);d=nr(d);const{relativeKey:R,driver:D}=i(d);if(D.setItemRaw)await qt(D.setItemRaw,R,_,S);else if(D.setItem)await qt(D.setItem,R,uw(_),S);else return;D.watch||a("update",d)},async removeItem(d,_={}){typeof _=="boolean"&&(_={removeMeta:_}),d=nr(d);const{relativeKey:S,driver:R}=i(d);R.removeItem&&(await qt(R.removeItem,S,_),(_.removeMeta||_.removeMata)&&await qt(R.removeItem,S+"$",_),R.watch||a("remove",d))},async getMeta(d,_={}){typeof _=="boolean"&&(_={nativeOnly:_}),d=nr(d);const{relativeKey:S,driver:R}=i(d),D=Object.create(null);if(R.getMeta&&Object.assign(D,await qt(R.getMeta,S,_)),!_.nativeOnly){const A=await qt(R.getItem,S+"$",_).then(Q=>ca(Q));A&&typeof A=="object"&&(typeof A.atime=="string"&&(A.atime=new Date(A.atime)),typeof A.mtime=="string"&&(A.mtime=new Date(A.mtime)),Object.assign(D,A))}return D},setMeta(d,_,S={}){return this.setItem(d+"$",_,S)},removeMeta(d,_={}){return this.removeItem(d+"$",_)},async getKeys(d,_={}){d=ua(d);const S=s(d,!0);let R=[];const D=[];for(const A of S){const Q=await qt(A.driver.getKeys,A.relativeBase,_);for(const te of Q){const ce=A.mountpoint+nr(te);R.some(oe=>ce.startsWith(oe))||D.push(ce)}R=[A.mountpoint,...R.filter(te=>!te.startsWith(A.mountpoint))]}return d?D.filter(A=>A.startsWith(d)&&A[A.length-1]!=="$"):D.filter(A=>A[A.length-1]!=="$")},async clear(d,_={}){d=ua(d),await Promise.all(s(d,!1).map(async S=>{if(S.driver.clear)return qt(S.driver.clear,S.relativeBase,_);if(S.driver.removeItem){const R=await S.driver.getKeys(S.relativeBase||"",_);return Promise.all(R.map(D=>S.driver.removeItem(D,_)))}}))},async dispose(){await Promise.all(Object.values(t.mounts).map(d=>Qh(d)))},async watch(d){return await u(),t.watchListeners.push(d),async()=>{t.watchListeners=t.watchListeners.filter(_=>_!==d),t.watchListeners.length===0&&await f()}},async unwatch(){t.watchListeners=[],await f()},mount(d,_){if(d=ua(d),d&&t.mounts[d])throw new Error(`already mounted at ${d}`);return d&&(t.mountpoints.push(d),t.mountpoints.sort((S,R)=>R.length-S.length)),t.mounts[d]=_,t.watching&&Promise.resolve(Jh(_,a,d)).then(S=>{t.unwatch[d]=S}).catch(console.error),m},async unmount(d,_=!0){d=ua(d),!(!d||!t.mounts[d])&&(t.watching&&d in t.unwatch&&(t.unwatch[d](),delete t.unwatch[d]),_&&await Qh(t.mounts[d]),t.mountpoints=t.mountpoints.filter(S=>S!==d),delete t.mounts[d])},getMount(d=""){d=nr(d)+":";const _=i(d);return{driver:_.driver,base:_.base}},getMounts(d="",_={}){return d=nr(d),s(d,_.parents).map(R=>({driver:R.driver,base:R.mountpoint}))},keys:(d,_={})=>m.getKeys(d,_),get:(d,_={})=>m.getItem(d,_),set:(d,_,S={})=>m.setItem(d,_,S),has:(d,_={})=>m.hasItem(d,_),del:(d,_={})=>m.removeItem(d,_),remove:(d,_={})=>m.removeItem(d,_)};return m}function Jh(o,t,i){return o.watch?o.watch((s,a)=>t(s,i+a)):()=>{}}async function Qh(o){typeof o.dispose=="function"&&await qt(o.dispose)}function Ui(o){return new Promise((t,i)=>{o.oncomplete=o.onsuccess=()=>t(o.result),o.onabort=o.onerror=()=>i(o.error)})}function Xl(o,t){const i=indexedDB.open(o);i.onupgradeneeded=()=>i.result.createObjectStore(t);const s=Ui(i);return(a,u)=>s.then(f=>u(f.transaction(t,a).objectStore(t)))}let sc;function Zs(){return sc||(sc=Xl("keyval-store","keyval")),sc}function Yh(o,t=Zs()){return t("readonly",i=>Ui(i.get(o)))}function gw(o,t,i=Zs()){return i("readwrite",s=>(s.put(t,o),Ui(s.transaction)))}function yw(o,t=Zs()){return t("readwrite",i=>(i.delete(o),Ui(i.transaction)))}function vw(o=Zs()){return o("readwrite",t=>(t.clear(),Ui(t.transaction)))}function mw(o,t){return o.openCursor().onsuccess=function(){this.result&&(t(this.result),this.result.continue())},Ui(o.transaction)}function ww(o=Zs()){return o("readonly",t=>{if(t.getAllKeys)return Ui(t.getAllKeys());const i=[];return mw(t,s=>i.push(s.key)).then(()=>i)})}const _w="idb-keyval";var bw=(o={})=>{const t=o.base&&o.base.length>0?`${o.base}:`:"",i=a=>t+a;let s;return o.dbName&&o.storeName&&(s=Xl(o.dbName,o.storeName)),{name:_w,options:o,async hasItem(a){return!(typeof await Yh(i(a),s)>"u")},async getItem(a){return await Yh(i(a),s)??null},setItem(a,u){return gw(i(a),u,s)},removeItem(a){return yw(i(a),s)},getKeys(){return ww(s)},clear(){return vw(s)}}};const Iw="WALLET_CONNECT_V2_INDEXED_DB",Ew="keyvaluestorage";let xw=class{constructor(){this.indexedDb=dw({driver:bw({dbName:Iw,storeName:Ew})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(t=>[t.key,t.value])}async getItem(t){const i=await this.indexedDb.getItem(t);if(i!==null)return i}async setItem(t,i){await this.indexedDb.setItem(t,Ys(i))}async removeItem(t){await this.indexedDb.removeItem(t)}};var nc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},va={exports:{}};(function(){let o;function t(){}o=t,o.prototype.getItem=function(i){return this.hasOwnProperty(i)?String(this[i]):null},o.prototype.setItem=function(i,s){this[i]=String(s)},o.prototype.removeItem=function(i){delete this[i]},o.prototype.clear=function(){const i=this;Object.keys(i).forEach(function(s){i[s]=void 0,delete i[s]})},o.prototype.key=function(i){return i=i||0,Object.keys(this)[i]},o.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof nc<"u"&&nc.localStorage?va.exports=nc.localStorage:typeof window<"u"&&window.localStorage?va.exports=window.localStorage:va.exports=new t})();function Pw(o){var t;return[o[0],Ia((t=o[1])!=null?t:"")]}class Sw{constructor(){this.localStorage=va.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Pw)}async getItem(t){const i=this.localStorage.getItem(t);if(i!==null)return Ia(i)}async setItem(t,i){this.localStorage.setItem(t,Ys(i))}async removeItem(t){this.localStorage.removeItem(t)}}const Ow="wc_storage_version",Zh=1,Rw=async(o,t,i)=>{const s=Ow,a=await t.getItem(s);if(a&&a>=Zh){i(t);return}const u=await o.getKeys();if(!u.length){i(t);return}const f=[];for(;u.length;){const y=u.shift();if(!y)continue;const m=y.toLowerCase();if(m.includes("wc@")||m.includes("walletconnect")||m.includes("wc_")||m.includes("wallet_connect")){const d=await o.getItem(y);await t.setItem(y,d),f.push(y)}}await t.setItem(s,Zh),i(t),Aw(o,f)},Aw=async(o,t)=>{t.length&&t.forEach(async i=>{await o.removeItem(i)})};let Cw=class{constructor(){this.initialized=!1,this.setInitialized=i=>{this.storage=i,this.initialized=!0};const t=new Sw;this.storage=t;try{const i=new xw;Rw(t,i,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(t){return await this.initialize(),this.storage.getItem(t)}async setItem(t,i){return await this.initialize(),this.storage.setItem(t,i)}async removeItem(t){return await this.initialize(),this.storage.removeItem(t)}async initialize(){this.initialized||await new Promise(t=>{const i=setInterval(()=>{this.initialized&&(clearInterval(i),t())},20)})}};var vs={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var bc=function(o,t){return bc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var a in s)s.hasOwnProperty(a)&&(i[a]=s[a])},bc(o,t)};function Tw(o,t){bc(o,t);function i(){this.constructor=o}o.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}var Ic=function(){return Ic=Object.assign||function(t){for(var i,s=1,a=arguments.length;s<a;s++){i=arguments[s];for(var u in i)Object.prototype.hasOwnProperty.call(i,u)&&(t[u]=i[u])}return t},Ic.apply(this,arguments)};function $w(o,t){var i={};for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&t.indexOf(s)<0&&(i[s]=o[s]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,s=Object.getOwnPropertySymbols(o);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(o,s[a])&&(i[s[a]]=o[s[a]]);return i}function Nw(o,t,i,s){var a=arguments.length,u=a<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,i):s,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(o,t,i,s);else for(var y=o.length-1;y>=0;y--)(f=o[y])&&(u=(a<3?f(u):a>3?f(t,i,u):f(t,i))||u);return a>3&&u&&Object.defineProperty(t,i,u),u}function Dw(o,t){return function(i,s){t(i,s,o)}}function qw(o,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,t)}function jw(o,t,i,s){function a(u){return u instanceof i?u:new i(function(f){f(u)})}return new(i||(i=Promise))(function(u,f){function y(_){try{d(s.next(_))}catch(S){f(S)}}function m(_){try{d(s.throw(_))}catch(S){f(S)}}function d(_){_.done?u(_.value):a(_.value).then(y,m)}d((s=s.apply(o,t||[])).next())})}function Lw(o,t){var i={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},s,a,u,f;return f={next:y(0),throw:y(1),return:y(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function y(d){return function(_){return m([d,_])}}function m(d){if(s)throw new TypeError("Generator is already executing.");for(;i;)try{if(s=1,a&&(u=d[0]&2?a.return:d[0]?a.throw||((u=a.return)&&u.call(a),0):a.next)&&!(u=u.call(a,d[1])).done)return u;switch(a=0,u&&(d=[d[0]&2,u.value]),d[0]){case 0:case 1:u=d;break;case 4:return i.label++,{value:d[1],done:!1};case 5:i.label++,a=d[1],d=[0];continue;case 7:d=i.ops.pop(),i.trys.pop();continue;default:if(u=i.trys,!(u=u.length>0&&u[u.length-1])&&(d[0]===6||d[0]===2)){i=0;continue}if(d[0]===3&&(!u||d[1]>u[0]&&d[1]<u[3])){i.label=d[1];break}if(d[0]===6&&i.label<u[1]){i.label=u[1],u=d;break}if(u&&i.label<u[2]){i.label=u[2],i.ops.push(d);break}u[2]&&i.ops.pop(),i.trys.pop();continue}d=t.call(o,i)}catch(_){d=[6,_],a=0}finally{s=u=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}}function zw(o,t,i,s){s===void 0&&(s=i),o[s]=t[i]}function Mw(o,t){for(var i in o)i!=="default"&&!t.hasOwnProperty(i)&&(t[i]=o[i])}function Ec(o){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&o[t],s=0;if(i)return i.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&s>=o.length&&(o=void 0),{value:o&&o[s++],done:!o}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function ef(o,t){var i=typeof Symbol=="function"&&o[Symbol.iterator];if(!i)return o;var s=i.call(o),a,u=[],f;try{for(;(t===void 0||t-- >0)&&!(a=s.next()).done;)u.push(a.value)}catch(y){f={error:y}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(f)throw f.error}}return u}function Uw(){for(var o=[],t=0;t<arguments.length;t++)o=o.concat(ef(arguments[t]));return o}function Hw(){for(var o=0,t=0,i=arguments.length;t<i;t++)o+=arguments[t].length;for(var s=Array(o),a=0,t=0;t<i;t++)for(var u=arguments[t],f=0,y=u.length;f<y;f++,a++)s[a]=u[f];return s}function Ws(o){return this instanceof Ws?(this.v=o,this):new Ws(o)}function kw(o,t,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=i.apply(o,t||[]),a,u=[];return a={},f("next"),f("throw"),f("return"),a[Symbol.asyncIterator]=function(){return this},a;function f(R){s[R]&&(a[R]=function(D){return new Promise(function(A,Q){u.push([R,D,A,Q])>1||y(R,D)})})}function y(R,D){try{m(s[R](D))}catch(A){S(u[0][3],A)}}function m(R){R.value instanceof Ws?Promise.resolve(R.value.v).then(d,_):S(u[0][2],R)}function d(R){y("next",R)}function _(R){y("throw",R)}function S(R,D){R(D),u.shift(),u.length&&y(u[0][0],u[0][1])}}function Kw(o){var t,i;return t={},s("next"),s("throw",function(a){throw a}),s("return"),t[Symbol.iterator]=function(){return this},t;function s(a,u){t[a]=o[a]?function(f){return(i=!i)?{value:Ws(o[a](f)),done:a==="return"}:u?u(f):f}:u}}function Vw(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=o[Symbol.asyncIterator],i;return t?t.call(o):(o=typeof Ec=="function"?Ec(o):o[Symbol.iterator](),i={},s("next"),s("throw"),s("return"),i[Symbol.asyncIterator]=function(){return this},i);function s(u){i[u]=o[u]&&function(f){return new Promise(function(y,m){f=o[u](f),a(y,m,f.done,f.value)})}}function a(u,f,y,m){Promise.resolve(m).then(function(d){u({value:d,done:y})},f)}}function Fw(o,t){return Object.defineProperty?Object.defineProperty(o,"raw",{value:t}):o.raw=t,o}function Bw(o){if(o&&o.__esModule)return o;var t={};if(o!=null)for(var i in o)Object.hasOwnProperty.call(o,i)&&(t[i]=o[i]);return t.default=o,t}function Gw(o){return o&&o.__esModule?o:{default:o}}function Ww(o,t){if(!t.has(o))throw new TypeError("attempted to get private field on non-instance");return t.get(o)}function Jw(o,t,i){if(!t.has(o))throw new TypeError("attempted to set private field on non-instance");return t.set(o,i),i}const Qw=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Ic},__asyncDelegator:Kw,__asyncGenerator:kw,__asyncValues:Vw,__await:Ws,__awaiter:jw,__classPrivateFieldGet:Ww,__classPrivateFieldSet:Jw,__createBinding:zw,__decorate:Nw,__exportStar:Mw,__extends:Tw,__generator:Lw,__importDefault:Gw,__importStar:Bw,__makeTemplateObject:Fw,__metadata:qw,__param:Dw,__read:ef,__rest:$w,__spread:Uw,__spreadArrays:Hw,__values:Ec},Symbol.toStringTag,{value:"Module"})),Pa=Tc(Qw);var Ls={},ac={},zs={};class Hi{}const Yw=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Hi},Symbol.toStringTag,{value:"Module"})),Zw=Tc(Yw);var Xh;function Xw(){if(Xh)return zs;Xh=1,Object.defineProperty(zs,"__esModule",{value:!0}),zs.IHeartBeat=void 0;const o=Zw;class t extends o.IEvents{constructor(s){super()}}return zs.IHeartBeat=t,zs}var el;function tf(){return el||(el=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),Pa.__exportStar(Xw(),o)}(ac)),ac}var oc={},Mi={},tl;function e_(){if(tl)return Mi;tl=1,Object.defineProperty(Mi,"__esModule",{value:!0}),Mi.HEARTBEAT_EVENTS=Mi.HEARTBEAT_INTERVAL=void 0;const o=X;return Mi.HEARTBEAT_INTERVAL=o.FIVE_SECONDS,Mi.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Mi}var rl;function rf(){return rl||(rl=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),Pa.__exportStar(e_(),o)}(oc)),oc}var il;function t_(){if(il)return Ls;il=1,Object.defineProperty(Ls,"__esModule",{value:!0}),Ls.HeartBeat=void 0;const o=Pa,t=qr,i=X,s=tf(),a=rf();class u extends s.IHeartBeat{constructor(y){super(y),this.events=new t.EventEmitter,this.interval=a.HEARTBEAT_INTERVAL,this.interval=(y==null?void 0:y.interval)||a.HEARTBEAT_INTERVAL}static init(y){return o.__awaiter(this,void 0,void 0,function*(){const m=new u(y);return yield m.init(),m})}init(){return o.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(y,m){this.events.on(y,m)}once(y,m){this.events.once(y,m)}off(y,m){this.events.off(y,m)}removeListener(y,m){this.events.removeListener(y,m)}initialize(){return o.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),i.toMiliseconds(this.interval))})}pulse(){this.events.emit(a.HEARTBEAT_EVENTS.pulse)}}return Ls.HeartBeat=u,Ls}(function(o){Object.defineProperty(o,"__esModule",{value:!0});const t=Pa;t.__exportStar(t_(),o),t.__exportStar(tf(),o),t.__exportStar(rf(),o)})(vs);function r_(o){try{return JSON.stringify(o)}catch{return'"[Circular]"'}}var i_=s_;function s_(o,t,i){var s=i&&i.stringify||r_,a=1;if(typeof o=="object"&&o!==null){var u=t.length+a;if(u===1)return o;var f=new Array(u);f[0]=s(o);for(var y=1;y<u;y++)f[y]=s(t[y]);return f.join(" ")}if(typeof o!="string")return o;var m=t.length;if(m===0)return o;for(var d="",_=1-a,S=-1,R=o&&o.length||0,D=0;D<R;){if(o.charCodeAt(D)===37&&D+1<R){switch(S=S>-1?S:0,o.charCodeAt(D+1)){case 100:case 102:if(_>=m||t[_]==null)break;S<D&&(d+=o.slice(S,D)),d+=Number(t[_]),S=D+2,D++;break;case 105:if(_>=m||t[_]==null)break;S<D&&(d+=o.slice(S,D)),d+=Math.floor(Number(t[_])),S=D+2,D++;break;case 79:case 111:case 106:if(_>=m||t[_]===void 0)break;S<D&&(d+=o.slice(S,D));var A=typeof t[_];if(A==="string"){d+="'"+t[_]+"'",S=D+2,D++;break}if(A==="function"){d+=t[_].name||"<anonymous>",S=D+2,D++;break}d+=s(t[_]),S=D+2,D++;break;case 115:if(_>=m)break;S<D&&(d+=o.slice(S,D)),d+=String(t[_]),S=D+2,D++;break;case 37:S<D&&(d+=o.slice(S,D)),d+="%",S=D+2,D++,_--;break}++_}++D}return S===-1?o:(S<R&&(d+=o.slice(S)),d)}const sl=i_;var n_=Vr;const Js=g_().console||{},a_={mapHttpRequest:ha,mapHttpResponse:ha,wrapRequestSerializer:cc,wrapResponseSerializer:cc,wrapErrorSerializer:cc,req:ha,res:ha,err:l_};function o_(o,t){return Array.isArray(o)?o.filter(function(s){return s!=="!stdSerializers.err"}):o===!0?Object.keys(t):!1}function Vr(o){o=o||{},o.browser=o.browser||{};const t=o.browser.transmit;if(t&&typeof t.send!="function")throw Error("pino: transmit option must have a send function");const i=o.browser.write||Js;o.browser.write&&(o.browser.asObject=!0);const s=o.serializers||{},a=o_(o.browser.serialize,s);let u=o.browser.serialize;Array.isArray(o.browser.serialize)&&o.browser.serialize.indexOf("!stdSerializers.err")>-1&&(u=!1);const f=["error","fatal","warn","info","debug","trace"];typeof i=="function"&&(i.error=i.fatal=i.warn=i.info=i.debug=i.trace=i),o.enabled===!1&&(o.level="silent");const y=o.level||"info",m=Object.create(i);m.log||(m.log=Qs),Object.defineProperty(m,"levelVal",{get:_}),Object.defineProperty(m,"level",{get:S,set:R});const d={transmit:t,serialize:a,asObject:o.browser.asObject,levels:f,timestamp:f_(o)};m.levels=Vr.levels,m.level=y,m.setMaxListeners=m.getMaxListeners=m.emit=m.addListener=m.on=m.prependListener=m.once=m.prependOnceListener=m.removeListener=m.removeAllListeners=m.listeners=m.listenerCount=m.eventNames=m.write=m.flush=Qs,m.serializers=s,m._serialize=a,m._stdErrSerialize=u,m.child=D,t&&(m._logEvent=xc());function _(){return this.level==="silent"?1/0:this.levels.values[this.level]}function S(){return this._level}function R(A){if(A!=="silent"&&!this.levels.values[A])throw Error("unknown level "+A);this._level=A,us(d,m,"error","log"),us(d,m,"fatal","error"),us(d,m,"warn","error"),us(d,m,"info","log"),us(d,m,"debug","log"),us(d,m,"trace","log")}function D(A,Q){if(!A)throw new Error("missing bindings for child Pino");Q=Q||{},a&&A.serializers&&(Q.serializers=A.serializers);const te=Q.serializers;if(a&&te){var ce=Object.assign({},s,te),oe=o.browser.serialize===!0?Object.keys(ce):a;delete A.serializers,Sa([A],oe,ce,this._stdErrSerialize)}function ne(re){this._childLevel=(re._childLevel|0)+1,this.error=hs(re,A,"error"),this.fatal=hs(re,A,"fatal"),this.warn=hs(re,A,"warn"),this.info=hs(re,A,"info"),this.debug=hs(re,A,"debug"),this.trace=hs(re,A,"trace"),ce&&(this.serializers=ce,this._serialize=oe),t&&(this._logEvent=xc([].concat(re._logEvent.bindings,A)))}return ne.prototype=this,new ne(this)}return m}Vr.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};Vr.stdSerializers=a_;Vr.stdTimeFunctions=Object.assign({},{nullTime:sf,epochTime:nf,unixTime:p_,isoTime:d_});function us(o,t,i,s){const a=Object.getPrototypeOf(t);t[i]=t.levelVal>t.levels.values[i]?Qs:a[i]?a[i]:Js[i]||Js[s]||Qs,c_(o,t,i)}function c_(o,t,i){!o.transmit&&t[i]===Qs||(t[i]=function(s){return function(){const u=o.timestamp(),f=new Array(arguments.length),y=Object.getPrototypeOf&&Object.getPrototypeOf(this)===Js?Js:this;for(var m=0;m<f.length;m++)f[m]=arguments[m];if(o.serialize&&!o.asObject&&Sa(f,this._serialize,this.serializers,this._stdErrSerialize),o.asObject?s.call(y,u_(this,i,f,u)):s.apply(y,f),o.transmit){const d=o.transmit.level||t.level,_=Vr.levels.values[d],S=Vr.levels.values[i];if(S<_)return;h_(this,{ts:u,methodLevel:i,methodValue:S,transmitLevel:d,transmitValue:Vr.levels.values[o.transmit.level||t.level],send:o.transmit.send,val:t.levelVal},f)}}}(t[i]))}function u_(o,t,i,s){o._serialize&&Sa(i,o._serialize,o.serializers,o._stdErrSerialize);const a=i.slice();let u=a[0];const f={};s&&(f.time=s),f.level=Vr.levels.values[t];let y=(o._childLevel|0)+1;if(y<1&&(y=1),u!==null&&typeof u=="object"){for(;y--&&typeof a[0]=="object";)Object.assign(f,a.shift());u=a.length?sl(a.shift(),a):void 0}else typeof u=="string"&&(u=sl(a.shift(),a));return u!==void 0&&(f.msg=u),f}function Sa(o,t,i,s){for(const a in o)if(s&&o[a]instanceof Error)o[a]=Vr.stdSerializers.err(o[a]);else if(typeof o[a]=="object"&&!Array.isArray(o[a]))for(const u in o[a])t&&t.indexOf(u)>-1&&u in i&&(o[a][u]=i[u](o[a][u]))}function hs(o,t,i){return function(){const s=new Array(1+arguments.length);s[0]=t;for(var a=1;a<s.length;a++)s[a]=arguments[a-1];return o[i].apply(this,s)}}function h_(o,t,i){const s=t.send,a=t.ts,u=t.methodLevel,f=t.methodValue,y=t.val,m=o._logEvent.bindings;Sa(i,o._serialize||Object.keys(o.serializers),o.serializers,o._stdErrSerialize===void 0?!0:o._stdErrSerialize),o._logEvent.ts=a,o._logEvent.messages=i.filter(function(d){return m.indexOf(d)===-1}),o._logEvent.level.label=u,o._logEvent.level.value=f,s(u,o._logEvent,y),o._logEvent=xc(m)}function xc(o){return{ts:0,messages:[],bindings:o||[],level:{label:"",value:0}}}function l_(o){const t={type:o.constructor.name,msg:o.message,stack:o.stack};for(const i in o)t[i]===void 0&&(t[i]=o[i]);return t}function f_(o){return typeof o.timestamp=="function"?o.timestamp:o.timestamp===!1?sf:nf}function ha(){return{}}function cc(o){return o}function Qs(){}function sf(){return!1}function nf(){return Date.now()}function p_(){return Math.round(Date.now()/1e3)}function d_(){return new Date(Date.now()).toISOString()}function g_(){function o(t){return typeof t<"u"&&t}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return o(self)||o(window)||o(this)||{}}}const Oa=$c(n_),y_={level:"info"},Xs="custom_context";var v_=Object.defineProperty,m_=Object.defineProperties,w_=Object.getOwnPropertyDescriptors,nl=Object.getOwnPropertySymbols,__=Object.prototype.hasOwnProperty,b_=Object.prototype.propertyIsEnumerable,al=(o,t,i)=>t in o?v_(o,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[t]=i,I_=(o,t)=>{for(var i in t||(t={}))__.call(t,i)&&al(o,i,t[i]);if(nl)for(var i of nl(t))b_.call(t,i)&&al(o,i,t[i]);return o},E_=(o,t)=>m_(o,w_(t));function Ra(o){return E_(I_({},o),{level:(o==null?void 0:o.level)||y_.level})}function x_(o,t=Xs){return o[t]||""}function P_(o,t,i=Xs){return o[i]=t,o}function or(o,t=Xs){let i="";return typeof o.bindings>"u"?i=x_(o,t):i=o.bindings().context||"",i}function S_(o,t,i=Xs){const s=or(o,i);return s.trim()?`${s}/${t}`:t}function cr(o,t,i=Xs){const s=S_(o,t,i),a=o.child({context:s});return P_(a,s,i)}class O_ extends Hi{constructor(t){super(),this.opts=t,this.protocol="wc",this.version=2}}let R_=class extends Hi{constructor(t,i){super(),this.core=t,this.logger=i,this.records=new Map}},A_=class{constructor(t,i){this.logger=t,this.core=i}},C_=class extends Hi{constructor(t,i){super(),this.relayer=t,this.logger=i}},T_=class extends Hi{constructor(t){super()}},$_=class{constructor(t,i,s,a){this.core=t,this.logger=i,this.name=s}};class N_ extends Hi{constructor(t,i){super(),this.relayer=t,this.logger=i}}let D_=class extends Hi{constructor(t,i){super(),this.core=t,this.logger=i}},q_=class{constructor(t,i){this.projectId=t,this.logger=i}},j_=class{constructor(t,i){this.projectId=t,this.logger=i}},L_=class{constructor(t){this.opts=t,this.protocol="wc",this.version=2}},z_=class{constructor(t){this.client=t}};var Lc={},af={};(function(o){Object.defineProperty(o,"__esModule",{value:!0});var t=c0,i=Kl;o.DIGEST_LENGTH=64,o.BLOCK_SIZE=128;var s=function(){function y(){this.digestLength=o.DIGEST_LENGTH,this.blockSize=o.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return y.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},y.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},y.prototype.clean=function(){i.wipe(this._buffer),i.wipe(this._tempHi),i.wipe(this._tempLo),this.reset()},y.prototype.update=function(m,d){if(d===void 0&&(d=m.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var _=0;if(this._bytesHashed+=d,this._bufferLength>0){for(;this._bufferLength<o.BLOCK_SIZE&&d>0;)this._buffer[this._bufferLength++]=m[_++],d--;this._bufferLength===this.blockSize&&(u(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(d>=this.blockSize&&(_=u(this._tempHi,this._tempLo,this._stateHi,this._stateLo,m,_,d),d%=this.blockSize);d>0;)this._buffer[this._bufferLength++]=m[_++],d--;return this},y.prototype.finish=function(m){if(!this._finished){var d=this._bytesHashed,_=this._bufferLength,S=d/536870912|0,R=d<<3,D=d%128<112?128:256;this._buffer[_]=128;for(var A=_+1;A<D-8;A++)this._buffer[A]=0;t.writeUint32BE(S,this._buffer,D-8),t.writeUint32BE(R,this._buffer,D-4),u(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,D),this._finished=!0}for(var A=0;A<this.digestLength/8;A++)t.writeUint32BE(this._stateHi[A],m,A*8),t.writeUint32BE(this._stateLo[A],m,A*8+4);return this},y.prototype.digest=function(){var m=new Uint8Array(this.digestLength);return this.finish(m),m},y.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},y.prototype.restoreState=function(m){return this._stateHi.set(m.stateHi),this._stateLo.set(m.stateLo),this._bufferLength=m.bufferLength,m.buffer&&this._buffer.set(m.buffer),this._bytesHashed=m.bytesHashed,this._finished=!1,this},y.prototype.cleanSavedState=function(m){i.wipe(m.stateHi),i.wipe(m.stateLo),m.buffer&&i.wipe(m.buffer),m.bufferLength=0,m.bytesHashed=0},y}();o.SHA512=s;var a=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function u(y,m,d,_,S,R,D){for(var A=d[0],Q=d[1],te=d[2],ce=d[3],oe=d[4],ne=d[5],re=d[6],fe=d[7],pe=_[0],Y=_[1],xe=_[2],Tt=_[3],yt=_[4],Yt=_[5],Vt=_[6],ur=_[7],M,U,Ge,qe,G,K,H,V;D>=128;){for(var Ot=0;Ot<16;Ot++){var rt=8*Ot+R;y[Ot]=t.readUint32BE(S,rt),m[Ot]=t.readUint32BE(S,rt+4)}for(var Ot=0;Ot<80;Ot++){var xi=A,we=Q,Sr=te,$=ce,T=oe,O=ne,h=re,I=fe,J=pe,ae=Y,ge=xe,Pe=Tt,Oe=yt,_e=Yt,vt=Vt,lt=ur;if(M=fe,U=ur,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=(oe>>>14|yt<<18)^(oe>>>18|yt<<14)^(yt>>>9|oe<<23),U=(yt>>>14|oe<<18)^(yt>>>18|oe<<14)^(oe>>>9|yt<<23),G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,M=oe&ne^~oe&re,U=yt&Yt^~yt&Vt,G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,M=a[Ot*2],U=a[Ot*2+1],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,M=y[Ot%16],U=m[Ot%16],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,Ge=H&65535|V<<16,qe=G&65535|K<<16,M=Ge,U=qe,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=(A>>>28|pe<<4)^(pe>>>2|A<<30)^(pe>>>7|A<<25),U=(pe>>>28|A<<4)^(A>>>2|pe<<30)^(A>>>7|pe<<25),G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,M=A&Q^A&te^Q&te,U=pe&Y^pe&xe^Y&xe,G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,I=H&65535|V<<16,lt=G&65535|K<<16,M=$,U=Pe,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=Ge,U=qe,G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,$=H&65535|V<<16,Pe=G&65535|K<<16,Q=xi,te=we,ce=Sr,oe=$,ne=T,re=O,fe=h,A=I,Y=J,xe=ae,Tt=ge,yt=Pe,Yt=Oe,Vt=_e,ur=vt,pe=lt,Ot%16===15)for(var rt=0;rt<16;rt++)M=y[rt],U=m[rt],G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=y[(rt+9)%16],U=m[(rt+9)%16],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,Ge=y[(rt+1)%16],qe=m[(rt+1)%16],M=(Ge>>>1|qe<<31)^(Ge>>>8|qe<<24)^Ge>>>7,U=(qe>>>1|Ge<<31)^(qe>>>8|Ge<<24)^(qe>>>7|Ge<<25),G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,Ge=y[(rt+14)%16],qe=m[(rt+14)%16],M=(Ge>>>19|qe<<13)^(qe>>>29|Ge<<3)^Ge>>>6,U=(qe>>>19|Ge<<13)^(Ge>>>29|qe<<3)^(qe>>>6|Ge<<26),G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,y[rt]=H&65535|V<<16,m[rt]=G&65535|K<<16}M=A,U=pe,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=d[0],U=_[0],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,d[0]=A=H&65535|V<<16,_[0]=pe=G&65535|K<<16,M=Q,U=Y,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=d[1],U=_[1],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,d[1]=Q=H&65535|V<<16,_[1]=Y=G&65535|K<<16,M=te,U=xe,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=d[2],U=_[2],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,d[2]=te=H&65535|V<<16,_[2]=xe=G&65535|K<<16,M=ce,U=Tt,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=d[3],U=_[3],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,d[3]=ce=H&65535|V<<16,_[3]=Tt=G&65535|K<<16,M=oe,U=yt,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=d[4],U=_[4],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,d[4]=oe=H&65535|V<<16,_[4]=yt=G&65535|K<<16,M=ne,U=Yt,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=d[5],U=_[5],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,d[5]=ne=H&65535|V<<16,_[5]=Yt=G&65535|K<<16,M=re,U=Vt,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=d[6],U=_[6],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,d[6]=re=H&65535|V<<16,_[6]=Vt=G&65535|K<<16,M=fe,U=ur,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=d[7],U=_[7],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,d[7]=fe=H&65535|V<<16,_[7]=ur=G&65535|K<<16,R+=128,D-=128}return R}function f(y){var m=new s;m.update(y);var d=m.digest();return m.clean(),d}o.hash=f})(af);(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.convertSecretKeyToX25519=o.convertPublicKeyToX25519=o.verify=o.sign=o.extractPublicKeyFromSecretKey=o.generateKeyPair=o.generateKeyPairFromSeed=o.SEED_LENGTH=o.SECRET_KEY_LENGTH=o.PUBLIC_KEY_LENGTH=o.SIGNATURE_LENGTH=void 0;const t=Vl,i=af,s=Kl;o.SIGNATURE_LENGTH=64,o.PUBLIC_KEY_LENGTH=32,o.SECRET_KEY_LENGTH=64,o.SEED_LENGTH=32;function a($){const T=new Float64Array(16);if($)for(let O=0;O<$.length;O++)T[O]=$[O];return T}const u=new Uint8Array(32);u[0]=9;const f=a(),y=a([1]),m=a([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),d=a([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),_=a([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),S=a([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),R=a([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function D($,T){for(let O=0;O<16;O++)$[O]=T[O]|0}function A($){let T=1;for(let O=0;O<16;O++){let h=$[O]+T+65535;T=Math.floor(h/65536),$[O]=h-T*65536}$[0]+=T-1+37*(T-1)}function Q($,T,O){const h=~(O-1);for(let I=0;I<16;I++){const J=h&($[I]^T[I]);$[I]^=J,T[I]^=J}}function te($,T){const O=a(),h=a();for(let I=0;I<16;I++)h[I]=T[I];A(h),A(h),A(h);for(let I=0;I<2;I++){O[0]=h[0]-65517;for(let ae=1;ae<15;ae++)O[ae]=h[ae]-65535-(O[ae-1]>>16&1),O[ae-1]&=65535;O[15]=h[15]-32767-(O[14]>>16&1);const J=O[15]>>16&1;O[14]&=65535,Q(h,O,1-J)}for(let I=0;I<16;I++)$[2*I]=h[I]&255,$[2*I+1]=h[I]>>8}function ce($,T){let O=0;for(let h=0;h<32;h++)O|=$[h]^T[h];return(1&O-1>>>8)-1}function oe($,T){const O=new Uint8Array(32),h=new Uint8Array(32);return te(O,$),te(h,T),ce(O,h)}function ne($){const T=new Uint8Array(32);return te(T,$),T[0]&1}function re($,T){for(let O=0;O<16;O++)$[O]=T[2*O]+(T[2*O+1]<<8);$[15]&=32767}function fe($,T,O){for(let h=0;h<16;h++)$[h]=T[h]+O[h]}function pe($,T,O){for(let h=0;h<16;h++)$[h]=T[h]-O[h]}function Y($,T,O){let h,I,J=0,ae=0,ge=0,Pe=0,Oe=0,_e=0,vt=0,lt=0,Ze=0,Ae=0,ke=0,Ke=0,Xe=0,Ne=0,Ve=0,Se=0,je=0,it=0,Te=0,mt=0,Rt=0,jt=0,Lt=0,$t=0,Ft=0,Zt=0,jr=0,Bt=0,Fr=0,oi=0,Pi=0,st=O[0],We=O[1],nt=O[2],at=O[3],et=O[4],Je=O[5],wt=O[6],_t=O[7],ot=O[8],bt=O[9],ct=O[10],ft=O[11],ut=O[12],He=O[13],It=O[14],Et=O[15];h=T[0],J+=h*st,ae+=h*We,ge+=h*nt,Pe+=h*at,Oe+=h*et,_e+=h*Je,vt+=h*wt,lt+=h*_t,Ze+=h*ot,Ae+=h*bt,ke+=h*ct,Ke+=h*ft,Xe+=h*ut,Ne+=h*He,Ve+=h*It,Se+=h*Et,h=T[1],ae+=h*st,ge+=h*We,Pe+=h*nt,Oe+=h*at,_e+=h*et,vt+=h*Je,lt+=h*wt,Ze+=h*_t,Ae+=h*ot,ke+=h*bt,Ke+=h*ct,Xe+=h*ft,Ne+=h*ut,Ve+=h*He,Se+=h*It,je+=h*Et,h=T[2],ge+=h*st,Pe+=h*We,Oe+=h*nt,_e+=h*at,vt+=h*et,lt+=h*Je,Ze+=h*wt,Ae+=h*_t,ke+=h*ot,Ke+=h*bt,Xe+=h*ct,Ne+=h*ft,Ve+=h*ut,Se+=h*He,je+=h*It,it+=h*Et,h=T[3],Pe+=h*st,Oe+=h*We,_e+=h*nt,vt+=h*at,lt+=h*et,Ze+=h*Je,Ae+=h*wt,ke+=h*_t,Ke+=h*ot,Xe+=h*bt,Ne+=h*ct,Ve+=h*ft,Se+=h*ut,je+=h*He,it+=h*It,Te+=h*Et,h=T[4],Oe+=h*st,_e+=h*We,vt+=h*nt,lt+=h*at,Ze+=h*et,Ae+=h*Je,ke+=h*wt,Ke+=h*_t,Xe+=h*ot,Ne+=h*bt,Ve+=h*ct,Se+=h*ft,je+=h*ut,it+=h*He,Te+=h*It,mt+=h*Et,h=T[5],_e+=h*st,vt+=h*We,lt+=h*nt,Ze+=h*at,Ae+=h*et,ke+=h*Je,Ke+=h*wt,Xe+=h*_t,Ne+=h*ot,Ve+=h*bt,Se+=h*ct,je+=h*ft,it+=h*ut,Te+=h*He,mt+=h*It,Rt+=h*Et,h=T[6],vt+=h*st,lt+=h*We,Ze+=h*nt,Ae+=h*at,ke+=h*et,Ke+=h*Je,Xe+=h*wt,Ne+=h*_t,Ve+=h*ot,Se+=h*bt,je+=h*ct,it+=h*ft,Te+=h*ut,mt+=h*He,Rt+=h*It,jt+=h*Et,h=T[7],lt+=h*st,Ze+=h*We,Ae+=h*nt,ke+=h*at,Ke+=h*et,Xe+=h*Je,Ne+=h*wt,Ve+=h*_t,Se+=h*ot,je+=h*bt,it+=h*ct,Te+=h*ft,mt+=h*ut,Rt+=h*He,jt+=h*It,Lt+=h*Et,h=T[8],Ze+=h*st,Ae+=h*We,ke+=h*nt,Ke+=h*at,Xe+=h*et,Ne+=h*Je,Ve+=h*wt,Se+=h*_t,je+=h*ot,it+=h*bt,Te+=h*ct,mt+=h*ft,Rt+=h*ut,jt+=h*He,Lt+=h*It,$t+=h*Et,h=T[9],Ae+=h*st,ke+=h*We,Ke+=h*nt,Xe+=h*at,Ne+=h*et,Ve+=h*Je,Se+=h*wt,je+=h*_t,it+=h*ot,Te+=h*bt,mt+=h*ct,Rt+=h*ft,jt+=h*ut,Lt+=h*He,$t+=h*It,Ft+=h*Et,h=T[10],ke+=h*st,Ke+=h*We,Xe+=h*nt,Ne+=h*at,Ve+=h*et,Se+=h*Je,je+=h*wt,it+=h*_t,Te+=h*ot,mt+=h*bt,Rt+=h*ct,jt+=h*ft,Lt+=h*ut,$t+=h*He,Ft+=h*It,Zt+=h*Et,h=T[11],Ke+=h*st,Xe+=h*We,Ne+=h*nt,Ve+=h*at,Se+=h*et,je+=h*Je,it+=h*wt,Te+=h*_t,mt+=h*ot,Rt+=h*bt,jt+=h*ct,Lt+=h*ft,$t+=h*ut,Ft+=h*He,Zt+=h*It,jr+=h*Et,h=T[12],Xe+=h*st,Ne+=h*We,Ve+=h*nt,Se+=h*at,je+=h*et,it+=h*Je,Te+=h*wt,mt+=h*_t,Rt+=h*ot,jt+=h*bt,Lt+=h*ct,$t+=h*ft,Ft+=h*ut,Zt+=h*He,jr+=h*It,Bt+=h*Et,h=T[13],Ne+=h*st,Ve+=h*We,Se+=h*nt,je+=h*at,it+=h*et,Te+=h*Je,mt+=h*wt,Rt+=h*_t,jt+=h*ot,Lt+=h*bt,$t+=h*ct,Ft+=h*ft,Zt+=h*ut,jr+=h*He,Bt+=h*It,Fr+=h*Et,h=T[14],Ve+=h*st,Se+=h*We,je+=h*nt,it+=h*at,Te+=h*et,mt+=h*Je,Rt+=h*wt,jt+=h*_t,Lt+=h*ot,$t+=h*bt,Ft+=h*ct,Zt+=h*ft,jr+=h*ut,Bt+=h*He,Fr+=h*It,oi+=h*Et,h=T[15],Se+=h*st,je+=h*We,it+=h*nt,Te+=h*at,mt+=h*et,Rt+=h*Je,jt+=h*wt,Lt+=h*_t,$t+=h*ot,Ft+=h*bt,Zt+=h*ct,jr+=h*ft,Bt+=h*ut,Fr+=h*He,oi+=h*It,Pi+=h*Et,J+=38*je,ae+=38*it,ge+=38*Te,Pe+=38*mt,Oe+=38*Rt,_e+=38*jt,vt+=38*Lt,lt+=38*$t,Ze+=38*Ft,Ae+=38*Zt,ke+=38*jr,Ke+=38*Bt,Xe+=38*Fr,Ne+=38*oi,Ve+=38*Pi,I=1,h=J+I+65535,I=Math.floor(h/65536),J=h-I*65536,h=ae+I+65535,I=Math.floor(h/65536),ae=h-I*65536,h=ge+I+65535,I=Math.floor(h/65536),ge=h-I*65536,h=Pe+I+65535,I=Math.floor(h/65536),Pe=h-I*65536,h=Oe+I+65535,I=Math.floor(h/65536),Oe=h-I*65536,h=_e+I+65535,I=Math.floor(h/65536),_e=h-I*65536,h=vt+I+65535,I=Math.floor(h/65536),vt=h-I*65536,h=lt+I+65535,I=Math.floor(h/65536),lt=h-I*65536,h=Ze+I+65535,I=Math.floor(h/65536),Ze=h-I*65536,h=Ae+I+65535,I=Math.floor(h/65536),Ae=h-I*65536,h=ke+I+65535,I=Math.floor(h/65536),ke=h-I*65536,h=Ke+I+65535,I=Math.floor(h/65536),Ke=h-I*65536,h=Xe+I+65535,I=Math.floor(h/65536),Xe=h-I*65536,h=Ne+I+65535,I=Math.floor(h/65536),Ne=h-I*65536,h=Ve+I+65535,I=Math.floor(h/65536),Ve=h-I*65536,h=Se+I+65535,I=Math.floor(h/65536),Se=h-I*65536,J+=I-1+37*(I-1),I=1,h=J+I+65535,I=Math.floor(h/65536),J=h-I*65536,h=ae+I+65535,I=Math.floor(h/65536),ae=h-I*65536,h=ge+I+65535,I=Math.floor(h/65536),ge=h-I*65536,h=Pe+I+65535,I=Math.floor(h/65536),Pe=h-I*65536,h=Oe+I+65535,I=Math.floor(h/65536),Oe=h-I*65536,h=_e+I+65535,I=Math.floor(h/65536),_e=h-I*65536,h=vt+I+65535,I=Math.floor(h/65536),vt=h-I*65536,h=lt+I+65535,I=Math.floor(h/65536),lt=h-I*65536,h=Ze+I+65535,I=Math.floor(h/65536),Ze=h-I*65536,h=Ae+I+65535,I=Math.floor(h/65536),Ae=h-I*65536,h=ke+I+65535,I=Math.floor(h/65536),ke=h-I*65536,h=Ke+I+65535,I=Math.floor(h/65536),Ke=h-I*65536,h=Xe+I+65535,I=Math.floor(h/65536),Xe=h-I*65536,h=Ne+I+65535,I=Math.floor(h/65536),Ne=h-I*65536,h=Ve+I+65535,I=Math.floor(h/65536),Ve=h-I*65536,h=Se+I+65535,I=Math.floor(h/65536),Se=h-I*65536,J+=I-1+37*(I-1),$[0]=J,$[1]=ae,$[2]=ge,$[3]=Pe,$[4]=Oe,$[5]=_e,$[6]=vt,$[7]=lt,$[8]=Ze,$[9]=Ae,$[10]=ke,$[11]=Ke,$[12]=Xe,$[13]=Ne,$[14]=Ve,$[15]=Se}function xe($,T){Y($,T,T)}function Tt($,T){const O=a();let h;for(h=0;h<16;h++)O[h]=T[h];for(h=253;h>=0;h--)xe(O,O),h!==2&&h!==4&&Y(O,O,T);for(h=0;h<16;h++)$[h]=O[h]}function yt($,T){const O=a();let h;for(h=0;h<16;h++)O[h]=T[h];for(h=250;h>=0;h--)xe(O,O),h!==1&&Y(O,O,T);for(h=0;h<16;h++)$[h]=O[h]}function Yt($,T){const O=a(),h=a(),I=a(),J=a(),ae=a(),ge=a(),Pe=a(),Oe=a(),_e=a();pe(O,$[1],$[0]),pe(_e,T[1],T[0]),Y(O,O,_e),fe(h,$[0],$[1]),fe(_e,T[0],T[1]),Y(h,h,_e),Y(I,$[3],T[3]),Y(I,I,d),Y(J,$[2],T[2]),fe(J,J,J),pe(ae,h,O),pe(ge,J,I),fe(Pe,J,I),fe(Oe,h,O),Y($[0],ae,ge),Y($[1],Oe,Pe),Y($[2],Pe,ge),Y($[3],ae,Oe)}function Vt($,T,O){for(let h=0;h<4;h++)Q($[h],T[h],O)}function ur($,T){const O=a(),h=a(),I=a();Tt(I,T[2]),Y(O,T[0],I),Y(h,T[1],I),te($,h),$[31]^=ne(O)<<7}function M($,T,O){D($[0],f),D($[1],y),D($[2],y),D($[3],f);for(let h=255;h>=0;--h){const I=O[h/8|0]>>(h&7)&1;Vt($,T,I),Yt(T,$),Yt($,$),Vt($,T,I)}}function U($,T){const O=[a(),a(),a(),a()];D(O[0],_),D(O[1],S),D(O[2],y),Y(O[3],_,S),M($,O,T)}function Ge($){if($.length!==o.SEED_LENGTH)throw new Error(`ed25519: seed must be ${o.SEED_LENGTH} bytes`);const T=(0,i.hash)($);T[0]&=248,T[31]&=127,T[31]|=64;const O=new Uint8Array(32),h=[a(),a(),a(),a()];U(h,T),ur(O,h);const I=new Uint8Array(64);return I.set($),I.set(O,32),{publicKey:O,secretKey:I}}o.generateKeyPairFromSeed=Ge;function qe($){const T=(0,t.randomBytes)(32,$),O=Ge(T);return(0,s.wipe)(T),O}o.generateKeyPair=qe;function G($){if($.length!==o.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${o.SECRET_KEY_LENGTH} bytes`);return new Uint8Array($.subarray(32))}o.extractPublicKeyFromSecretKey=G;const K=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function H($,T){let O,h,I,J;for(h=63;h>=32;--h){for(O=0,I=h-32,J=h-12;I<J;++I)T[I]+=O-16*T[h]*K[I-(h-32)],O=Math.floor((T[I]+128)/256),T[I]-=O*256;T[I]+=O,T[h]=0}for(O=0,I=0;I<32;I++)T[I]+=O-(T[31]>>4)*K[I],O=T[I]>>8,T[I]&=255;for(I=0;I<32;I++)T[I]-=O*K[I];for(h=0;h<32;h++)T[h+1]+=T[h]>>8,$[h]=T[h]&255}function V($){const T=new Float64Array(64);for(let O=0;O<64;O++)T[O]=$[O];for(let O=0;O<64;O++)$[O]=0;H($,T)}function Ot($,T){const O=new Float64Array(64),h=[a(),a(),a(),a()],I=(0,i.hash)($.subarray(0,32));I[0]&=248,I[31]&=127,I[31]|=64;const J=new Uint8Array(64);J.set(I.subarray(32),32);const ae=new i.SHA512;ae.update(J.subarray(32)),ae.update(T);const ge=ae.digest();ae.clean(),V(ge),U(h,ge),ur(J,h),ae.reset(),ae.update(J.subarray(0,32)),ae.update($.subarray(32)),ae.update(T);const Pe=ae.digest();V(Pe);for(let Oe=0;Oe<32;Oe++)O[Oe]=ge[Oe];for(let Oe=0;Oe<32;Oe++)for(let _e=0;_e<32;_e++)O[Oe+_e]+=Pe[Oe]*I[_e];return H(J.subarray(32),O),J}o.sign=Ot;function rt($,T){const O=a(),h=a(),I=a(),J=a(),ae=a(),ge=a(),Pe=a();return D($[2],y),re($[1],T),xe(I,$[1]),Y(J,I,m),pe(I,I,$[2]),fe(J,$[2],J),xe(ae,J),xe(ge,ae),Y(Pe,ge,ae),Y(O,Pe,I),Y(O,O,J),yt(O,O),Y(O,O,I),Y(O,O,J),Y(O,O,J),Y($[0],O,J),xe(h,$[0]),Y(h,h,J),oe(h,I)&&Y($[0],$[0],R),xe(h,$[0]),Y(h,h,J),oe(h,I)?-1:(ne($[0])===T[31]>>7&&pe($[0],f,$[0]),Y($[3],$[0],$[1]),0)}function xi($,T,O){const h=new Uint8Array(32),I=[a(),a(),a(),a()],J=[a(),a(),a(),a()];if(O.length!==o.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${o.SIGNATURE_LENGTH} bytes`);if(rt(J,$))return!1;const ae=new i.SHA512;ae.update(O.subarray(0,32)),ae.update($),ae.update(T);const ge=ae.digest();return V(ge),M(I,J,ge),U(J,O.subarray(32)),Yt(I,J),ur(h,I),!ce(O,h)}o.verify=xi;function we($){let T=[a(),a(),a(),a()];if(rt(T,$))throw new Error("Ed25519: invalid public key");let O=a(),h=a(),I=T[1];fe(O,y,I),pe(h,y,I),Tt(h,h),Y(O,O,h);let J=new Uint8Array(32);return te(J,O),J}o.convertPublicKeyToX25519=we;function Sr($){const T=(0,i.hash)($.subarray(0,32));T[0]&=248,T[31]&=127,T[31]|=64;const O=new Uint8Array(T.subarray(0,32));return(0,s.wipe)(T),O}o.convertSecretKeyToX25519=Sr})(Lc);const M_="EdDSA",U_="JWT",of=".",cf="base64url",H_="utf8",k_="utf8",K_=":",V_="did",F_="key",ol="base58btc",B_="z",G_="K36",W_=32;function ma(o){return ba(Nc(Ys(o),H_),cf)}function uf(o){const t=Nc(G_,ol),i=B_+ba(u0([t,o]),ol);return[V_,F_,i].join(K_)}function J_(o){return ba(o,cf)}function Q_(o){return Nc([ma(o.header),ma(o.payload)].join(of),k_)}function Y_(o){return[ma(o.header),ma(o.payload),J_(o.signature)].join(of)}function cl(o=Vl.randomBytes(W_)){return Lc.generateKeyPairFromSeed(o)}async function Z_(o,t,i,s,a=X.fromMiliseconds(Date.now())){const u={alg:M_,typ:U_},f=uf(s.publicKey),y=a+i,m={iss:f,sub:o,aud:t,iat:a,exp:y},d=Q_({header:u,payload:m}),_=Lc.sign(s.secretKey,d);return Y_({header:u,payload:m,signature:_})}class ni extends Q0{constructor(t){super(t),this.events=new qr.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,i){this.events.on(t,i)}once(t,i){this.events.once(t,i)}off(t,i){this.events.off(t,i)}removeListener(t,i){this.events.removeListener(t,i)}async request(t,i){return this.requestStrict(gs(t.method,t.params||[],t.id||Yl().toString()),i)}async requestStrict(t,i){return new Promise(async(s,a)=>{if(!this.connection.connected)try{await this.open()}catch(u){a(u)}this.events.on(`${t.id}`,u=>{Kr(u)?a(u.error):s(u.result)});try{await this.connection.send(t,i)}catch(u){a(u)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),Ea(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const X_=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),e1=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",ul=o=>o.split("?")[0],hl=10,t1=X_();let r1=class{constructor(t){if(this.url=t,this.events=new qr.EventEmitter,this.registering=!1,!Wh(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);this.url=t}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(t,i){this.events.on(t,i)}once(t,i){this.events.once(t,i)}off(t,i){this.events.off(t,i)}removeListener(t,i){this.events.removeListener(t,i)}async open(t=this.url){await this.register(t)}async close(){return new Promise((t,i)=>{if(typeof this.socket>"u"){i(new Error("Connection already closed"));return}this.socket.onclose=s=>{this.onClose(s),t()},this.socket.close()})}async send(t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Ys(t))}catch(i){this.onError(t.id,i)}}register(t=this.url){if(!Wh(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);if(this.registering){const i=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=i||this.events.listenerCount("open")>=i)&&this.events.setMaxListeners(i+1),new Promise((s,a)=>{this.events.once("register_error",u=>{this.resetMaxListeners(),a(u)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return a(new Error("WebSocket connection is missing or invalid"));s(this.socket)})})}return this.url=t,this.registering=!0,new Promise((i,s)=>{const a=new URLSearchParams(t).get("origin"),u=Y0.isReactNative()?{headers:{origin:a}}:{rejectUnauthorized:!Z0(t)},f=new t1(t,[],u);e1()?f.onerror=y=>{const m=y;s(this.emitError(m.error))}:f.on("error",y=>{s(this.emitError(y))}),f.onopen=()=>{this.onOpen(f),i(f)}})}onOpen(t){t.onmessage=i=>this.onPayload(i),t.onclose=i=>this.onClose(i),this.socket=t,this.registering=!1,this.events.emit("open")}onClose(t){this.socket=void 0,this.registering=!1,this.events.emit("close",t)}onPayload(t){if(typeof t.data>"u")return;const i=typeof t.data=="string"?Ia(t.data):t.data;this.events.emit("payload",i)}onError(t,i){const s=this.parseError(i),a=s.message||s.toString(),u=qc(t,a);this.events.emit("payload",u)}parseError(t,i=this.url){return X0(t,ul(i),"WS")}resetMaxListeners(){this.events.getMaxListeners()>hl&&this.events.setMaxListeners(hl)}emitError(t){const i=this.parseError(new Error((t==null?void 0:t.message)||`WebSocket connection failed for host: ${ul(this.url)}`));return this.events.emit("register_error",i),i}};var wa={exports:{}};wa.exports;(function(o,t){var i=200,s="__lodash_hash_undefined__",a=1,u=2,f=9007199254740991,y="[object Arguments]",m="[object Array]",d="[object AsyncFunction]",_="[object Boolean]",S="[object Date]",R="[object Error]",D="[object Function]",A="[object GeneratorFunction]",Q="[object Map]",te="[object Number]",ce="[object Null]",oe="[object Object]",ne="[object Promise]",re="[object Proxy]",fe="[object RegExp]",pe="[object Set]",Y="[object String]",xe="[object Symbol]",Tt="[object Undefined]",yt="[object WeakMap]",Yt="[object ArrayBuffer]",Vt="[object DataView]",ur="[object Float32Array]",M="[object Float64Array]",U="[object Int8Array]",Ge="[object Int16Array]",qe="[object Int32Array]",G="[object Uint8Array]",K="[object Uint8ClampedArray]",H="[object Uint16Array]",V="[object Uint32Array]",Ot=/[\\^$.*+?()[\]{}|]/g,rt=/^\[object .+?Constructor\]$/,xi=/^(?:0|[1-9]\d*)$/,we={};we[ur]=we[M]=we[U]=we[Ge]=we[qe]=we[G]=we[K]=we[H]=we[V]=!0,we[y]=we[m]=we[Yt]=we[_]=we[Vt]=we[S]=we[R]=we[D]=we[Q]=we[te]=we[oe]=we[fe]=we[pe]=we[Y]=we[yt]=!1;var Sr=typeof aa=="object"&&aa&&aa.Object===Object&&aa,$=typeof self=="object"&&self&&self.Object===Object&&self,T=Sr||$||Function("return this")(),O=t&&!t.nodeType&&t,h=O&&!0&&o&&!o.nodeType&&o,I=h&&h.exports===O,J=I&&Sr.process,ae=function(){try{return J&&J.binding&&J.binding("util")}catch{}}(),ge=ae&&ae.isTypedArray;function Pe(v,E){for(var L=-1,F=v==null?0:v.length,ze=0,he=[];++L<F;){var Fe=v[L];E(Fe,L,v)&&(he[ze++]=Fe)}return he}function Oe(v,E){for(var L=-1,F=E.length,ze=v.length;++L<F;)v[ze+L]=E[L];return v}function _e(v,E){for(var L=-1,F=v==null?0:v.length;++L<F;)if(E(v[L],L,v))return!0;return!1}function vt(v,E){for(var L=-1,F=Array(v);++L<v;)F[L]=E(L);return F}function lt(v){return function(E){return v(E)}}function Ze(v,E){return v.has(E)}function Ae(v,E){return v==null?void 0:v[E]}function ke(v){var E=-1,L=Array(v.size);return v.forEach(function(F,ze){L[++E]=[ze,F]}),L}function Ke(v,E){return function(L){return v(E(L))}}function Xe(v){var E=-1,L=Array(v.size);return v.forEach(function(F){L[++E]=F}),L}var Ne=Array.prototype,Ve=Function.prototype,Se=Object.prototype,je=T["__core-js_shared__"],it=Ve.toString,Te=Se.hasOwnProperty,mt=function(){var v=/[^.]+$/.exec(je&&je.keys&&je.keys.IE_PROTO||"");return v?"Symbol(src)_1."+v:""}(),Rt=Se.toString,jt=RegExp("^"+it.call(Te).replace(Ot,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Lt=I?T.Buffer:void 0,$t=T.Symbol,Ft=T.Uint8Array,Zt=Se.propertyIsEnumerable,jr=Ne.splice,Bt=$t?$t.toStringTag:void 0,Fr=Object.getOwnPropertySymbols,oi=Lt?Lt.isBuffer:void 0,Pi=Ke(Object.keys,Object),st=hr(T,"DataView"),We=hr(T,"Map"),nt=hr(T,"Promise"),at=hr(T,"Set"),et=hr(T,"WeakMap"),Je=hr(Object,"create"),wt=Gr(st),_t=Gr(We),ot=Gr(nt),bt=Gr(at),ct=Gr(et),ft=$t?$t.prototype:void 0,ut=ft?ft.valueOf:void 0;function He(v){var E=-1,L=v==null?0:v.length;for(this.clear();++E<L;){var F=v[E];this.set(F[0],F[1])}}function It(){this.__data__=Je?Je(null):{},this.size=0}function Et(v){var E=this.has(v)&&delete this.__data__[v];return this.size-=E?1:0,E}function Ta(v){var E=this.__data__;if(Je){var L=E[v];return L===s?void 0:L}return Te.call(E,v)?E[v]:void 0}function $a(v){var E=this.__data__;return Je?E[v]!==void 0:Te.call(E,v)}function Na(v,E){var L=this.__data__;return this.size+=this.has(v)?0:1,L[v]=Je&&E===void 0?s:E,this}He.prototype.clear=It,He.prototype.delete=Et,He.prototype.get=Ta,He.prototype.has=$a,He.prototype.set=Na;function yr(v){var E=-1,L=v==null?0:v.length;for(this.clear();++E<L;){var F=v[E];this.set(F[0],F[1])}}function Da(){this.__data__=[],this.size=0}function qa(v){var E=this.__data__,L=Si(E,v);if(L<0)return!1;var F=E.length-1;return L==F?E.pop():jr.call(E,L,1),--this.size,!0}function ja(v){var E=this.__data__,L=Si(E,v);return L<0?void 0:E[L][1]}function La(v){return Si(this.__data__,v)>-1}function za(v,E){var L=this.__data__,F=Si(L,v);return F<0?(++this.size,L.push([v,E])):L[F][1]=E,this}yr.prototype.clear=Da,yr.prototype.delete=qa,yr.prototype.get=ja,yr.prototype.has=La,yr.prototype.set=za;function Br(v){var E=-1,L=v==null?0:v.length;for(this.clear();++E<L;){var F=v[E];this.set(F[0],F[1])}}function Ki(){this.size=0,this.__data__={hash:new He,map:new(We||yr),string:new He}}function Ma(v){var E=ci(this,v).delete(v);return this.size-=E?1:0,E}function Vi(v){return ci(this,v).get(v)}function Ua(v){return ci(this,v).has(v)}function Ha(v,E){var L=ci(this,v),F=L.size;return L.set(v,E),this.size+=L.size==F?0:1,this}Br.prototype.clear=Ki,Br.prototype.delete=Ma,Br.prototype.get=Vi,Br.prototype.has=Ua,Br.prototype.set=Ha;function Fi(v){var E=-1,L=v==null?0:v.length;for(this.__data__=new Br;++E<L;)this.add(v[E])}function tn(v){return this.__data__.set(v,s),this}function rn(v){return this.__data__.has(v)}Fi.prototype.add=Fi.prototype.push=tn,Fi.prototype.has=rn;function Or(v){var E=this.__data__=new yr(v);this.size=E.size}function ka(){this.__data__=new yr,this.size=0}function Ka(v){var E=this.__data__,L=E.delete(v);return this.size=E.size,L}function Va(v){return this.__data__.get(v)}function Fa(v){return this.__data__.has(v)}function sn(v,E){var L=this.__data__;if(L instanceof yr){var F=L.__data__;if(!We||F.length<i-1)return F.push([v,E]),this.size=++L.size,this;L=this.__data__=new Br(F)}return L.set(v,E),this.size=L.size,this}Or.prototype.clear=ka,Or.prototype.delete=Ka,Or.prototype.get=Va,Or.prototype.has=Fa,Or.prototype.set=sn;function nn(v,E){var L=Wi(v),F=!L&&vn(v),ze=!L&&!F&&_s(v),he=!L&&!F&&!ze&&_n(v),Fe=L||F||ze||he,xt=Fe?vt(v.length,String):[],Ie=xt.length;for(var Me in v)Te.call(v,Me)&&!(Fe&&(Me=="length"||ze&&(Me=="offset"||Me=="parent")||he&&(Me=="buffer"||Me=="byteLength"||Me=="byteOffset")||fn(Me,Ie)))&&xt.push(Me);return xt}function Si(v,E){for(var L=v.length;L--;)if(yn(v[L][0],E))return L;return-1}function ms(v,E,L){var F=E(v);return Wi(v)?F:Oe(F,L(v))}function Oi(v){return v==null?v===void 0?Tt:ce:Bt&&Bt in Object(v)?hn(v):Wa(v)}function ws(v){return Ai(v)&&Oi(v)==y}function Ri(v,E,L,F,ze){return v===E?!0:v==null||E==null||!Ai(v)&&!Ai(E)?v!==v&&E!==E:an(v,E,L,F,Ri,ze)}function an(v,E,L,F,ze,he){var Fe=Wi(v),xt=Wi(E),Ie=Fe?m:Lr(v),Me=xt?m:Lr(E);Ie=Ie==y?oe:Ie,Me=Me==y?oe:Me;var pt=Ie==oe,Xt=Me==oe,Pt=Ie==Me;if(Pt&&_s(v)){if(!_s(E))return!1;Fe=!0,pt=!1}if(Pt&&!pt)return he||(he=new Or),Fe||_n(v)?Bi(v,E,L,F,ze,he):Ga(v,E,Ie,L,F,ze,he);if(!(L&a)){var Be=pt&&Te.call(v,"__wrapped__"),Gt=Xt&&Te.call(E,"__wrapped__");if(Be||Gt){var Rr=Be?v.value():v,vr=Gt?E.value():E;return he||(he=new Or),ze(Rr,vr,L,F,he)}}return Pt?(he||(he=new Or),un(v,E,L,F,ze,he)):!1}function Ba(v){if(!wn(v)||dn(v))return!1;var E=Ji(v)?jt:rt;return E.test(Gr(v))}function on(v){return Ai(v)&&mn(v.length)&&!!we[Oi(v)]}function cn(v){if(!gn(v))return Pi(v);var E=[];for(var L in Object(v))Te.call(v,L)&&L!="constructor"&&E.push(L);return E}function Bi(v,E,L,F,ze,he){var Fe=L&a,xt=v.length,Ie=E.length;if(xt!=Ie&&!(Fe&&Ie>xt))return!1;var Me=he.get(v);if(Me&&he.get(E))return Me==E;var pt=-1,Xt=!0,Pt=L&u?new Fi:void 0;for(he.set(v,E),he.set(E,v);++pt<xt;){var Be=v[pt],Gt=E[pt];if(F)var Rr=Fe?F(Gt,Be,pt,E,v,he):F(Be,Gt,pt,v,E,he);if(Rr!==void 0){if(Rr)continue;Xt=!1;break}if(Pt){if(!_e(E,function(vr,zr){if(!Ze(Pt,zr)&&(Be===vr||ze(Be,vr,L,F,he)))return Pt.push(zr)})){Xt=!1;break}}else if(!(Be===Gt||ze(Be,Gt,L,F,he))){Xt=!1;break}}return he.delete(v),he.delete(E),Xt}function Ga(v,E,L,F,ze,he,Fe){switch(L){case Vt:if(v.byteLength!=E.byteLength||v.byteOffset!=E.byteOffset)return!1;v=v.buffer,E=E.buffer;case Yt:return!(v.byteLength!=E.byteLength||!he(new Ft(v),new Ft(E)));case _:case S:case te:return yn(+v,+E);case R:return v.name==E.name&&v.message==E.message;case fe:case Y:return v==E+"";case Q:var xt=ke;case pe:var Ie=F&a;if(xt||(xt=Xe),v.size!=E.size&&!Ie)return!1;var Me=Fe.get(v);if(Me)return Me==E;F|=u,Fe.set(v,E);var pt=Bi(xt(v),xt(E),F,ze,he,Fe);return Fe.delete(v),pt;case xe:if(ut)return ut.call(v)==ut.call(E)}return!1}function un(v,E,L,F,ze,he){var Fe=L&a,xt=Gi(v),Ie=xt.length,Me=Gi(E),pt=Me.length;if(Ie!=pt&&!Fe)return!1;for(var Xt=Ie;Xt--;){var Pt=xt[Xt];if(!(Fe?Pt in E:Te.call(E,Pt)))return!1}var Be=he.get(v);if(Be&&he.get(E))return Be==E;var Gt=!0;he.set(v,E),he.set(E,v);for(var Rr=Fe;++Xt<Ie;){Pt=xt[Xt];var vr=v[Pt],zr=E[Pt];if(F)var bs=Fe?F(zr,vr,Pt,E,v,he):F(vr,zr,Pt,v,E,he);if(!(bs===void 0?vr===zr||ze(vr,zr,L,F,he):bs)){Gt=!1;break}Rr||(Rr=Pt=="constructor")}if(Gt&&!Rr){var Ci=v.constructor,Nt=E.constructor;Ci!=Nt&&"constructor"in v&&"constructor"in E&&!(typeof Ci=="function"&&Ci instanceof Ci&&typeof Nt=="function"&&Nt instanceof Nt)&&(Gt=!1)}return he.delete(v),he.delete(E),Gt}function Gi(v){return ms(v,Ya,ln)}function ci(v,E){var L=v.__data__;return pn(E)?L[typeof E=="string"?"string":"hash"]:L.map}function hr(v,E){var L=Ae(v,E);return Ba(L)?L:void 0}function hn(v){var E=Te.call(v,Bt),L=v[Bt];try{v[Bt]=void 0;var F=!0}catch{}var ze=Rt.call(v);return F&&(E?v[Bt]=L:delete v[Bt]),ze}var ln=Fr?function(v){return v==null?[]:(v=Object(v),Pe(Fr(v),function(E){return Zt.call(v,E)}))}:Le,Lr=Oi;(st&&Lr(new st(new ArrayBuffer(1)))!=Vt||We&&Lr(new We)!=Q||nt&&Lr(nt.resolve())!=ne||at&&Lr(new at)!=pe||et&&Lr(new et)!=yt)&&(Lr=function(v){var E=Oi(v),L=E==oe?v.constructor:void 0,F=L?Gr(L):"";if(F)switch(F){case wt:return Vt;case _t:return Q;case ot:return ne;case bt:return pe;case ct:return yt}return E});function fn(v,E){return E=E??f,!!E&&(typeof v=="number"||xi.test(v))&&v>-1&&v%1==0&&v<E}function pn(v){var E=typeof v;return E=="string"||E=="number"||E=="symbol"||E=="boolean"?v!=="__proto__":v===null}function dn(v){return!!mt&&mt in v}function gn(v){var E=v&&v.constructor,L=typeof E=="function"&&E.prototype||Se;return v===L}function Wa(v){return Rt.call(v)}function Gr(v){if(v!=null){try{return it.call(v)}catch{}try{return v+""}catch{}}return""}function yn(v,E){return v===E||v!==v&&E!==E}var vn=ws(function(){return arguments}())?ws:function(v){return Ai(v)&&Te.call(v,"callee")&&!Zt.call(v,"callee")},Wi=Array.isArray;function Ja(v){return v!=null&&mn(v.length)&&!Ji(v)}var _s=oi||De;function Qa(v,E){return Ri(v,E)}function Ji(v){if(!wn(v))return!1;var E=Oi(v);return E==D||E==A||E==d||E==re}function mn(v){return typeof v=="number"&&v>-1&&v%1==0&&v<=f}function wn(v){var E=typeof v;return v!=null&&(E=="object"||E=="function")}function Ai(v){return v!=null&&typeof v=="object"}var _n=ge?lt(ge):on;function Ya(v){return Ja(v)?nn(v):cn(v)}function Le(){return[]}function De(){return!1}o.exports=Qa})(wa,wa.exports);var i1=wa.exports;const s1=$c(i1);function n1(o,t){return t=t||{},new Promise(function(i,s){var a=new XMLHttpRequest,u=[],f=[],y={},m=function(){return{ok:(a.status/100|0)==2,statusText:a.statusText,status:a.status,url:a.responseURL,text:function(){return Promise.resolve(a.responseText)},json:function(){return Promise.resolve(a.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([a.response]))},clone:m,headers:{keys:function(){return u},entries:function(){return f},get:function(_){return y[_.toLowerCase()]},has:function(_){return _.toLowerCase()in y}}}};for(var d in a.open(t.method||"get",o,!0),a.onload=function(){a.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(_,S,R){u.push(S=S.toLowerCase()),f.push([S,R]),y[S]=y[S]?y[S]+","+R:R}),i(m())},a.onerror=s,a.withCredentials=t.credentials=="include",t.headers)a.setRequestHeader(d,t.headers[d]);a.send(t.body||null)})}const a1=Object.freeze(Object.defineProperty({__proto__:null,default:n1},Symbol.toStringTag,{value:"Module"})),ll=Tc(a1);var o1=self.fetch||(self.fetch=ll.default||ll);const c1=$c(o1);var u1={};function h1(o,t){if(o.length>=255)throw new TypeError("Alphabet too long");for(var i=new Uint8Array(256),s=0;s<i.length;s++)i[s]=255;for(var a=0;a<o.length;a++){var u=o.charAt(a),f=u.charCodeAt(0);if(i[f]!==255)throw new TypeError(u+" is ambiguous");i[f]=a}var y=o.length,m=o.charAt(0),d=Math.log(y)/Math.log(256),_=Math.log(256)/Math.log(y);function S(A){if(A instanceof Uint8Array||(ArrayBuffer.isView(A)?A=new Uint8Array(A.buffer,A.byteOffset,A.byteLength):Array.isArray(A)&&(A=Uint8Array.from(A))),!(A instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(A.length===0)return"";for(var Q=0,te=0,ce=0,oe=A.length;ce!==oe&&A[ce]===0;)ce++,Q++;for(var ne=(oe-ce)*_+1>>>0,re=new Uint8Array(ne);ce!==oe;){for(var fe=A[ce],pe=0,Y=ne-1;(fe!==0||pe<te)&&Y!==-1;Y--,pe++)fe+=256*re[Y]>>>0,re[Y]=fe%y>>>0,fe=fe/y>>>0;if(fe!==0)throw new Error("Non-zero carry");te=pe,ce++}for(var xe=ne-te;xe!==ne&&re[xe]===0;)xe++;for(var Tt=m.repeat(Q);xe<ne;++xe)Tt+=o.charAt(re[xe]);return Tt}function R(A){if(typeof A!="string")throw new TypeError("Expected String");if(A.length===0)return new Uint8Array;var Q=0;if(A[Q]!==" "){for(var te=0,ce=0;A[Q]===m;)te++,Q++;for(var oe=(A.length-Q)*d+1>>>0,ne=new Uint8Array(oe);A[Q];){var re=i[A.charCodeAt(Q)];if(re===255)return;for(var fe=0,pe=oe-1;(re!==0||fe<ce)&&pe!==-1;pe--,fe++)re+=y*ne[pe]>>>0,ne[pe]=re%256>>>0,re=re/256>>>0;if(re!==0)throw new Error("Non-zero carry");ce=fe,Q++}if(A[Q]!==" "){for(var Y=oe-ce;Y!==oe&&ne[Y]===0;)Y++;for(var xe=new Uint8Array(te+(oe-Y)),Tt=te;Y!==oe;)xe[Tt++]=ne[Y++];return xe}}}function D(A){var Q=R(A);if(Q)return Q;throw new Error(`Non-${t} character`)}return{encode:S,decodeUnsafe:R,decode:D}}var l1=h1,f1=l1;const hf=o=>{if(o instanceof Uint8Array&&o.constructor.name==="Uint8Array")return o;if(o instanceof ArrayBuffer)return new Uint8Array(o);if(ArrayBuffer.isView(o))return new Uint8Array(o.buffer,o.byteOffset,o.byteLength);throw new Error("Unknown type, must be binary type")},p1=o=>new TextEncoder().encode(o),d1=o=>new TextDecoder().decode(o);class g1{constructor(t,i,s){this.name=t,this.prefix=i,this.baseEncode=s}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class y1{constructor(t,i,s){if(this.name=t,this.prefix=i,i.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i.codePointAt(0),this.baseDecode=s}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return lf(this,t)}}class v1{constructor(t){this.decoders=t}or(t){return lf(this,t)}decode(t){const i=t[0],s=this.decoders[i];if(s)return s.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const lf=(o,t)=>new v1({...o.decoders||{[o.prefix]:o},...t.decoders||{[t.prefix]:t}});class m1{constructor(t,i,s,a){this.name=t,this.prefix=i,this.baseEncode=s,this.baseDecode=a,this.encoder=new g1(t,i,s),this.decoder=new y1(t,i,a)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const Aa=({name:o,prefix:t,encode:i,decode:s})=>new m1(o,t,i,s),en=({prefix:o,name:t,alphabet:i})=>{const{encode:s,decode:a}=f1(i,t);return Aa({prefix:o,name:t,encode:s,decode:u=>hf(a(u))})},w1=(o,t,i,s)=>{const a={};for(let _=0;_<t.length;++_)a[t[_]]=_;let u=o.length;for(;o[u-1]==="=";)--u;const f=new Uint8Array(u*i/8|0);let y=0,m=0,d=0;for(let _=0;_<u;++_){const S=a[o[_]];if(S===void 0)throw new SyntaxError(`Non-${s} character`);m=m<<i|S,y+=i,y>=8&&(y-=8,f[d++]=255&m>>y)}if(y>=i||255&m<<8-y)throw new SyntaxError("Unexpected end of data");return f},_1=(o,t,i)=>{const s=t[t.length-1]==="=",a=(1<<i)-1;let u="",f=0,y=0;for(let m=0;m<o.length;++m)for(y=y<<8|o[m],f+=8;f>i;)f-=i,u+=t[a&y>>f];if(f&&(u+=t[a&y<<i-f]),s)for(;u.length*i&7;)u+="=";return u},Mt=({name:o,prefix:t,bitsPerChar:i,alphabet:s})=>Aa({prefix:t,name:o,encode(a){return _1(a,s,i)},decode(a){return w1(a,s,i,o)}}),b1=Aa({prefix:"\0",name:"identity",encode:o=>d1(o),decode:o=>p1(o)});var I1=Object.freeze({__proto__:null,identity:b1});const E1=Mt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var x1=Object.freeze({__proto__:null,base2:E1});const P1=Mt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var S1=Object.freeze({__proto__:null,base8:P1});const O1=en({prefix:"9",name:"base10",alphabet:"0123456789"});var R1=Object.freeze({__proto__:null,base10:O1});const A1=Mt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),C1=Mt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var T1=Object.freeze({__proto__:null,base16:A1,base16upper:C1});const $1=Mt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),N1=Mt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),D1=Mt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),q1=Mt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),j1=Mt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),L1=Mt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),z1=Mt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),M1=Mt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),U1=Mt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var H1=Object.freeze({__proto__:null,base32:$1,base32upper:N1,base32pad:D1,base32padupper:q1,base32hex:j1,base32hexupper:L1,base32hexpad:z1,base32hexpadupper:M1,base32z:U1});const k1=en({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),K1=en({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var V1=Object.freeze({__proto__:null,base36:k1,base36upper:K1});const F1=en({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),B1=en({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var G1=Object.freeze({__proto__:null,base58btc:F1,base58flickr:B1});const W1=Mt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),J1=Mt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Q1=Mt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Y1=Mt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Z1=Object.freeze({__proto__:null,base64:W1,base64pad:J1,base64url:Q1,base64urlpad:Y1});const ff=Array.from(""),X1=ff.reduce((o,t,i)=>(o[i]=t,o),[]),eb=ff.reduce((o,t,i)=>(o[t.codePointAt(0)]=i,o),[]);function tb(o){return o.reduce((t,i)=>(t+=X1[i],t),"")}function rb(o){const t=[];for(const i of o){const s=eb[i.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${i}`);t.push(s)}return new Uint8Array(t)}const ib=Aa({prefix:"",name:"base256emoji",encode:tb,decode:rb});var sb=Object.freeze({__proto__:null,base256emoji:ib}),nb=pf,fl=128,ab=127,ob=~ab,cb=Math.pow(2,31);function pf(o,t,i){t=t||[],i=i||0;for(var s=i;o>=cb;)t[i++]=o&255|fl,o/=128;for(;o&ob;)t[i++]=o&255|fl,o>>>=7;return t[i]=o|0,pf.bytes=i-s+1,t}var ub=Pc,hb=128,pl=127;function Pc(o,s){var i=0,s=s||0,a=0,u=s,f,y=o.length;do{if(u>=y)throw Pc.bytes=0,new RangeError("Could not decode varint");f=o[u++],i+=a<28?(f&pl)<<a:(f&pl)*Math.pow(2,a),a+=7}while(f>=hb);return Pc.bytes=u-s,i}var lb=Math.pow(2,7),fb=Math.pow(2,14),pb=Math.pow(2,21),db=Math.pow(2,28),gb=Math.pow(2,35),yb=Math.pow(2,42),vb=Math.pow(2,49),mb=Math.pow(2,56),wb=Math.pow(2,63),_b=function(o){return o<lb?1:o<fb?2:o<pb?3:o<db?4:o<gb?5:o<yb?6:o<vb?7:o<mb?8:o<wb?9:10},bb={encode:nb,decode:ub,encodingLength:_b},df=bb;const dl=(o,t,i=0)=>(df.encode(o,t,i),t),gl=o=>df.encodingLength(o),Sc=(o,t)=>{const i=t.byteLength,s=gl(o),a=s+gl(i),u=new Uint8Array(a+i);return dl(o,u,0),dl(i,u,s),u.set(t,a),new Ib(o,i,t,u)};class Ib{constructor(t,i,s,a){this.code=t,this.size=i,this.digest=s,this.bytes=a}}const gf=({name:o,code:t,encode:i})=>new Eb(o,t,i);class Eb{constructor(t,i,s){this.name=t,this.code=i,this.encode=s}digest(t){if(t instanceof Uint8Array){const i=this.encode(t);return i instanceof Uint8Array?Sc(this.code,i):i.then(s=>Sc(this.code,s))}else throw Error("Unknown type, must be binary type")}}const yf=o=>async t=>new Uint8Array(await crypto.subtle.digest(o,t)),xb=gf({name:"sha2-256",code:18,encode:yf("SHA-256")}),Pb=gf({name:"sha2-512",code:19,encode:yf("SHA-512")});var Sb=Object.freeze({__proto__:null,sha256:xb,sha512:Pb});const vf=0,Ob="identity",mf=hf,Rb=o=>Sc(vf,mf(o)),Ab={code:vf,name:Ob,encode:mf,digest:Rb};var Cb=Object.freeze({__proto__:null,identity:Ab});new TextEncoder,new TextDecoder;const yl={...I1,...x1,...S1,...R1,...T1,...H1,...V1,...G1,...Z1,...sb};({...Sb,...Cb});function wf(o){return globalThis.Buffer!=null?new Uint8Array(o.buffer,o.byteOffset,o.byteLength):o}function Tb(o=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?wf(globalThis.Buffer.allocUnsafe(o)):new Uint8Array(o)}function _f(o,t,i,s){return{name:o,prefix:t,encoder:{name:o,prefix:t,encode:i},decoder:{decode:s}}}const vl=_f("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),uc=_f("ascii","a",o=>{let t="a";for(let i=0;i<o.length;i++)t+=String.fromCharCode(o[i]);return t},o=>{o=o.substring(1);const t=Tb(o.length);for(let i=0;i<o.length;i++)t[i]=o.charCodeAt(i);return t}),$b={utf8:vl,"utf-8":vl,hex:yl.base16,latin1:uc,ascii:uc,binary:uc,...yl};function Nb(o,t="utf8"){const i=$b[t];if(!i)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?wf(globalThis.Buffer.from(o,"utf-8")):i.decoder.decode(`${i.prefix}${o}`)}const bf="wc",Db=2,zc="core",bi=`${bf}@2:${zc}:`,qb={name:zc,logger:"error"},jb={database:":memory:"},Lb="crypto",ml="client_ed25519_seed",zb=X.ONE_DAY,Mb="keychain",Ub="0.3",Hb="messages",kb="0.3",Kb=X.SIX_HOURS,Vb="publisher",If="irn",Fb="error",Ef="wss://relay.walletconnect.com",wl="wss://relay.walletconnect.org",Bb="relayer",Kt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},Gb="_subscription",ii={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},Wb=X.ONE_SECOND,Jb="2.11.0",Qb=1e4,Yb="0.3",Zb="WALLETCONNECT_CLIENT_ID",Nr={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},Xb="subscription",eI="0.3",tI=X.FIVE_SECONDS*1e3,rI="pairing",iI="0.3",Ms={wc_pairingDelete:{req:{ttl:X.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:X.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:X.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:X.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:X.ONE_DAY,prompt:!1,tag:0},res:{ttl:X.ONE_DAY,prompt:!1,tag:0}}},Fs={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},kr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},sI="history",nI="0.3",aI="expirer",Pr={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},oI="0.3",hc="verify-api",ps="https://verify.walletconnect.com",Oc="https://verify.walletconnect.org",cI=[ps,Oc],uI="echo",hI="https://echo.walletconnect.com";class lI{constructor(t,i){this.core=t,this.logger=i,this.keychain=new Map,this.name=Mb,this.version=Ub,this.initialized=!1,this.storagePrefix=bi,this.init=async()=>{if(!this.initialized){const s=await this.getKeyChain();typeof s<"u"&&(this.keychain=s),this.initialized=!0}},this.has=s=>(this.isInitialized(),this.keychain.has(s)),this.set=async(s,a)=>{this.isInitialized(),this.keychain.set(s,a),await this.persist()},this.get=s=>{this.isInitialized();const a=this.keychain.get(s);if(typeof a>"u"){const{message:u}=B("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(u)}return a},this.del=async s=>{this.isInitialized(),this.keychain.delete(s),await this.persist()},this.core=t,this.logger=cr(i,this.name)}get context(){return or(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(t){await this.core.storage.setItem(this.storageKey,Wl(t))}async getKeyChain(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Jl(t):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}}class fI{constructor(t,i,s){this.core=t,this.logger=i,this.name=Lb,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),u=cl(a);return uf(u.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=f0();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const u=await this.getClientSeed(),f=cl(u),y=mc();return await Z_(y,a,zb,f)},this.generateSharedKey=(a,u,f)=>{this.isInitialized();const y=this.getPrivateKey(a),m=p0(y,u);return this.setSymKey(m,f)},this.setSymKey=async(a,u)=>{this.isInitialized();const f=u||d0(a);return await this.keychain.set(f,a),f},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,u,f)=>{this.isInitialized();const y=g0(f),m=Ys(u);if(kh(y)){const R=y.senderPublicKey,D=y.receiverPublicKey;a=await this.generateSharedKey(R,D)}const d=this.getSymKey(a),{type:_,senderPublicKey:S}=y;return y0({type:_,symKey:d,message:m,senderPublicKey:S})},this.decode=async(a,u,f)=>{this.isInitialized();const y=v0(u,f);if(kh(y)){const m=y.receiverPublicKey,d=y.senderPublicKey;a=await this.generateSharedKey(m,d)}try{const m=this.getSymKey(a),d=m0({symKey:m,encoded:u});return Ia(d)}catch(m){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(m)}},this.getPayloadType=a=>{const u=Kh(a);return w0(u.type)},this.getPayloadSenderPublicKey=a=>{const u=Kh(a);return u.senderPublicKey?ba(u.senderPublicKey,_0):void 0},this.core=t,this.logger=cr(i,this.name),this.keychain=s||new lI(this.core,this.logger)}get context(){return or(this.logger)}async setPrivateKey(t,i){return await this.keychain.set(t,i),t}getPrivateKey(t){return this.keychain.get(t)}async getClientSeed(){let t="";try{t=this.keychain.get(ml)}catch{t=mc(),await this.keychain.set(ml,t)}return Nb(t,"base16")}getSymKey(t){return this.keychain.get(t)}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}}class pI extends A_{constructor(t,i){super(t,i),this.logger=t,this.core=i,this.messages=new Map,this.name=Hb,this.version=kb,this.initialized=!1,this.storagePrefix=bi,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const s=await this.getRelayerMessages();typeof s<"u"&&(this.messages=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}finally{this.initialized=!0}}},this.set=async(s,a)=>{this.isInitialized();const u=ds(a);let f=this.messages.get(s);return typeof f>"u"&&(f={}),typeof f[u]<"u"||(f[u]=a,this.messages.set(s,f),await this.persist()),u},this.get=s=>{this.isInitialized();let a=this.messages.get(s);return typeof a>"u"&&(a={}),a},this.has=(s,a)=>{this.isInitialized();const u=this.get(s),f=ds(a);return typeof u[f]<"u"},this.del=async s=>{this.isInitialized(),this.messages.delete(s),await this.persist()},this.logger=cr(t,this.name),this.core=i}get context(){return or(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(t){await this.core.storage.setItem(this.storageKey,Wl(t))}async getRelayerMessages(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Jl(t):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}}class dI extends C_{constructor(t,i){super(t,i),this.relayer=t,this.logger=i,this.events=new qr.EventEmitter,this.name=Vb,this.queue=new Map,this.publishTimeout=X.toMiliseconds(X.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(s,a,u)=>{var f;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:u}});try{const y=(u==null?void 0:u.ttl)||Kb,m=wc(u),d=(u==null?void 0:u.prompt)||!1,_=(u==null?void 0:u.tag)||0,S=(u==null?void 0:u.id)||Yl().toString(),R={topic:s,message:a,opts:{ttl:y,relay:m,prompt:d,tag:_,id:S}},D=setTimeout(()=>this.queue.set(S,R),this.publishTimeout);try{await await Gs(this.rpcPublish(s,a,y,m,d,_,S),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(S),this.relayer.events.emit(Kt.publish,R)}catch(A){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(f=u==null?void 0:u.internal)!=null&&f.throwOnFailedPublish)throw this.removeRequestFromQueue(S),A;return}finally{clearTimeout(D)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:u}})}catch(y){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(y),y}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.relayer=t,this.logger=cr(i,this.name),this.registerEventListeners()}get context(){return or(this.logger)}rpcPublish(t,i,s,a,u,f,y){var m,d,_,S;const R={method:da(a.protocol).publish,params:{topic:t,message:i,ttl:s,prompt:u,tag:f},id:y};return _i((m=R.params)==null?void 0:m.prompt)&&((d=R.params)==null||delete d.prompt),_i((_=R.params)==null?void 0:_.tag)&&((S=R.params)==null||delete S.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:R}),this.relayer.request(R)}removeRequestFromQueue(t){this.queue.delete(t)}checkQueue(){this.queue.forEach(async t=>{const{topic:i,message:s,opts:a}=t;await this.publish(i,s,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(vs.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Kt.connection_stalled);return}this.checkQueue()}),this.relayer.on(Kt.message_ack,t=>{this.removeRequestFromQueue(t.id.toString())})}}class gI{constructor(){this.map=new Map,this.set=(t,i)=>{const s=this.get(t);this.exists(t,i)||this.map.set(t,[...s,i])},this.get=t=>this.map.get(t)||[],this.exists=(t,i)=>this.get(t).includes(i),this.delete=(t,i)=>{if(typeof i>"u"){this.map.delete(t);return}if(!this.map.has(t))return;const s=this.get(t);if(!this.exists(t,i))return;const a=s.filter(u=>u!==i);if(!a.length){this.map.delete(t);return}this.map.set(t,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var yI=Object.defineProperty,vI=Object.defineProperties,mI=Object.getOwnPropertyDescriptors,_l=Object.getOwnPropertySymbols,wI=Object.prototype.hasOwnProperty,_I=Object.prototype.propertyIsEnumerable,bl=(o,t,i)=>t in o?yI(o,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[t]=i,Us=(o,t)=>{for(var i in t||(t={}))wI.call(t,i)&&bl(o,i,t[i]);if(_l)for(var i of _l(t))_I.call(t,i)&&bl(o,i,t[i]);return o},lc=(o,t)=>vI(o,mI(t));class bI extends N_{constructor(t,i){super(t,i),this.relayer=t,this.logger=i,this.subscriptions=new Map,this.topicMap=new gI,this.events=new qr.EventEmitter,this.name=Xb,this.version=eI,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=bi,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}});try{const u=wc(a),f={topic:s,relay:u};this.pending.set(s,f);const y=await this.rpcSubscribe(s,u);return this.onSubscribe(y,f),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}}),y}catch(u){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(u),u}},this.unsubscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),typeof(a==null?void 0:a.id)<"u"?await this.unsubscribeById(s,a.id,a):await this.unsubscribeByTopic(s,a)},this.isSubscribed=async s=>this.topics.includes(s)?!0:await new Promise((a,u)=>{const f=new X.Watch;f.start(this.pendingSubscriptionWatchLabel);const y=setInterval(()=>{!this.pending.has(s)&&this.topics.includes(s)&&(clearInterval(y),f.stop(this.pendingSubscriptionWatchLabel),a(!0)),f.elapsed(this.pendingSubscriptionWatchLabel)>=tI&&(clearInterval(y),f.stop(this.pendingSubscriptionWatchLabel),u(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=t,this.logger=cr(i,this.name),this.clientId=""}get context(){return or(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(t,i){let s=!1;try{s=this.getSubscription(t).topic===i}catch{}return s}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(t,i){const s=this.topicMap.get(t);await Promise.all(s.map(async a=>await this.unsubscribeById(t,a,i)))}async unsubscribeById(t,i,s){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:i,opts:s}});try{const a=wc(s);await this.rpcUnsubscribe(t,i,a);const u=kt("USER_DISCONNECTED",`${this.name}, ${t}`);await this.onUnsubscribe(t,i,u),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:i,opts:s}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(t,i){const s={method:da(i.protocol).subscribe,params:{topic:t}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{await await Gs(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Kt.connection_stalled)}return ds(t+this.clientId)}async rpcBatchSubscribe(t){if(!t.length)return;const i=t[0].relay,s={method:da(i.protocol).batchSubscribe,params:{topics:t.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{return await await Gs(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Kt.connection_stalled)}}rpcUnsubscribe(t,i,s){const a={method:da(s.protocol).unsubscribe,params:{topic:t,id:i}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(t,i){this.setSubscription(t,lc(Us({},i),{id:t})),this.pending.delete(i.topic)}onBatchSubscribe(t){t.length&&t.forEach(i=>{this.setSubscription(i.id,Us({},i)),this.pending.delete(i.topic)})}async onUnsubscribe(t,i,s){this.events.removeAllListeners(i),this.hasSubscription(i,t)&&this.deleteSubscription(i,s),await this.relayer.messages.del(t)}async setRelayerSubscriptions(t){await this.relayer.core.storage.setItem(this.storageKey,t)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(t,i){this.subscriptions.has(t)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:t,subscription:i}),this.addSubscription(t,i))}addSubscription(t,i){this.subscriptions.set(t,Us({},i)),this.topicMap.set(i.topic,t),this.events.emit(Nr.created,i)}getSubscription(t){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:t});const i=this.subscriptions.get(t);if(!i){const{message:s}=B("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(s)}return i}deleteSubscription(t,i){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:t,reason:i});const s=this.getSubscription(t);this.subscriptions.delete(t),this.topicMap.delete(s.topic,t),this.events.emit(Nr.deleted,lc(Us({},s),{reason:i}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Nr.sync)}async reset(){if(this.cached.length){const t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<t;i++){const s=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(Nr.resubscribed)}async restore(){try{const t=await this.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(this.subscriptions.size){const{message:i}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(i)}this.cached=t,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(t){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(t)}}async batchSubscribe(t){if(!t.length)return;const i=await this.rpcBatchSubscribe(t);ys(i)&&this.onBatchSubscribe(i.map((s,a)=>lc(Us({},t[a]),{id:s})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const t=[];this.pending.forEach(i=>{t.push(i)}),await this.batchSubscribe(t)}registerEventListeners(){this.relayer.core.heartbeat.on(vs.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Kt.connect,async()=>{await this.onConnect()}),this.relayer.on(Kt.disconnect,()=>{this.onDisconnect()}),this.events.on(Nr.created,async t=>{const i=Nr.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:t}),await this.persist()}),this.events.on(Nr.deleted,async t=>{const i=Nr.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:t}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}async restartToComplete(){this.restartInProgress&&await new Promise(t=>{const i=setInterval(()=>{this.restartInProgress||(clearInterval(i),t())},this.pollingInterval)})}}var II=Object.defineProperty,Il=Object.getOwnPropertySymbols,EI=Object.prototype.hasOwnProperty,xI=Object.prototype.propertyIsEnumerable,El=(o,t,i)=>t in o?II(o,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[t]=i,PI=(o,t)=>{for(var i in t||(t={}))EI.call(t,i)&&El(o,i,t[i]);if(Il)for(var i of Il(t))xI.call(t,i)&&El(o,i,t[i]);return o};class SI extends T_{constructor(t){super(t),this.protocol="wc",this.version=2,this.events=new qr.EventEmitter,this.name=Bb,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async i=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(i)}catch(s){throw this.logger.debug("Failed to Publish Request"),this.logger.error(s),s}},this.onPayloadHandler=i=>{this.onProviderPayload(i)},this.onConnectHandler=()=>{this.events.emit(Kt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=i=>{this.logger.error(i),this.events.emit(Kt.error,i),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(ii.payload,this.onPayloadHandler),this.provider.on(ii.connect,this.onConnectHandler),this.provider.on(ii.disconnect,this.onDisconnectHandler),this.provider.on(ii.error,this.onProviderErrorHandler)},this.core=t.core,this.logger=typeof t.logger<"u"&&typeof t.logger!="string"?cr(t.logger,this.name):Oa(Ra({level:t.logger||Fb})),this.messages=new pI(this.logger,t.core),this.subscriber=new bI(this,this.logger),this.publisher=new dI(this,this.logger),this.relayUrl=(t==null?void 0:t.relayUrl)||Ef,this.projectId=t.projectId,this.bundleId=b0(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${wl}...`),await this.restartTransport(wl)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},Qb)}get context(){return or(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(t,i,s){this.isInitialized(),await this.publisher.publish(t,i,s),await this.recordMessageEvent({topic:t,message:i,publishedAt:Date.now()})}async subscribe(t,i){var s;this.isInitialized();let a=((s=this.subscriber.topicMap.get(t))==null?void 0:s[0])||"";if(a)return a;let u;const f=y=>{y.topic===t&&(this.subscriber.off(Nr.created,f),u())};return await Promise.all([new Promise(y=>{u=y,this.subscriber.on(Nr.created,f)}),new Promise(async y=>{a=await this.subscriber.subscribe(t,i),y()})]),a}async unsubscribe(t,i){this.isInitialized(),await this.subscriber.unsubscribe(t,i)}on(t,i){this.events.on(t,i)}once(t,i){this.events.once(t,i)}off(t,i){this.events.off(t,i)}removeListener(t,i){this.events.removeListener(t,i)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await Gs(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(t){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){t&&t!==this.relayUrl&&(this.relayUrl=t,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(i=>{if(!this.initialized)return i();this.subscriber.once(Nr.resubscribed,()=>{i()})}),new Promise(async(i,s)=>{try{await Gs(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(a){s(a);return}i()})])}catch(i){this.logger.error(i);const s=i;if(!this.isConnectionStalled(s.message))throw i;this.provider.events.emit(ii.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(t){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=t||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Vh())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(t){return this.staleConnectionErrors.some(i=>t.includes(i))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const t=await this.core.crypto.signJWT(this.relayUrl);this.provider=new ni(new r1(I0({sdkVersion:Jb,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(t){const{topic:i,message:s}=t;await this.messages.set(i,s)}async shouldIgnoreMessageEvent(t){const{topic:i,message:s}=t;if(!s||s.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${s}`),!0;if(!await this.subscriber.isSubscribed(i))return this.logger.debug(`Ignoring message for non-subscribed topic ${i}`),!0;const a=this.messages.has(i,s);return a&&this.logger.debug(`Ignoring duplicate message: ${s}`),a}async onProviderPayload(t){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),jc(t)){if(!t.method.endsWith(Gb))return;const i=t.params,{topic:s,message:a,publishedAt:u}=i.data,f={topic:s,message:a,publishedAt:u};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(PI({type:"event",event:i.id},f)),this.events.emit(i.id,f),await this.acknowledgePayload(t),await this.onMessageEvent(f)}else Ea(t)&&this.events.emit(Kt.message_ack,t)}async onMessageEvent(t){await this.shouldIgnoreMessageEvent(t)||(this.events.emit(Kt.message,t),await this.recordMessageEvent(t))}async acknowledgePayload(t){const i=xa(t.id,!0);await this.provider.connection.send(i)}unregisterProviderListeners(){this.provider.off(ii.payload,this.onPayloadHandler),this.provider.off(ii.connect,this.onConnectHandler),this.provider.off(ii.disconnect,this.onDisconnectHandler),this.provider.off(ii.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Kt.connection_stalled,()=>{this.restartTransport().catch(i=>this.logger.error(i))});let t=await Vh();E0(async i=>{this.initialized&&t!==i&&(t=i,i?await this.restartTransport().catch(s=>this.logger.error(s)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(s=>this.logger.error(s))))})}onProviderDisconnect(){this.events.emit(Kt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(t=>this.logger.error(t))},X.toMiliseconds(Wb)))}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(t=>{const i=setInterval(()=>{this.connected&&(clearInterval(i),t())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var OI=Object.defineProperty,xl=Object.getOwnPropertySymbols,RI=Object.prototype.hasOwnProperty,AI=Object.prototype.propertyIsEnumerable,Pl=(o,t,i)=>t in o?OI(o,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[t]=i,Sl=(o,t)=>{for(var i in t||(t={}))RI.call(t,i)&&Pl(o,i,t[i]);if(xl)for(var i of xl(t))AI.call(t,i)&&Pl(o,i,t[i]);return o};class Ca extends $_{constructor(t,i,s,a=bi,u=void 0){super(t,i,s,a),this.core=t,this.logger=i,this.name=s,this.map=new Map,this.version=Yb,this.cached=[],this.initialized=!1,this.storagePrefix=bi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(f=>{this.getKey&&f!==null&&!_i(f)?this.map.set(this.getKey(f),f):h0(f)?this.map.set(f.id,f):l0(f)&&this.map.set(f.topic,f)}),this.cached=[],this.initialized=!0)},this.set=async(f,y)=>{this.isInitialized(),this.map.has(f)?await this.update(f,y):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:f,value:y}),this.map.set(f,y),await this.persist())},this.get=f=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:f}),this.getData(f)),this.getAll=f=>(this.isInitialized(),f?this.values.filter(y=>Object.keys(f).every(m=>s1(y[m],f[m]))):this.values),this.update=async(f,y)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:f,update:y});const m=Sl(Sl({},this.getData(f)),y);this.map.set(f,m),await this.persist()},this.delete=async(f,y)=>{this.isInitialized(),this.map.has(f)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:f,reason:y}),this.map.delete(f),await this.persist())},this.logger=cr(i,this.name),this.storagePrefix=a,this.getKey=u}get context(){return or(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(t){await this.core.storage.setItem(this.storageKey,t)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(t){const i=this.map.get(t);if(!i){const{message:s}=B("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(s),new Error(s)}return i}async persist(){await this.setDataStore(this.values)}async restore(){try{const t=await this.getDataStore();if(typeof t>"u"||!t.length)return;if(this.map.size){const{message:i}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=t,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(t){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(t)}}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}}class CI{constructor(t,i){this.core=t,this.logger=i,this.name=rI,this.version=iI,this.events=new Dc,this.initialized=!1,this.storagePrefix=bi,this.ignoredPayloadTypes=[Fl],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]},this.create=async()=>{this.isInitialized();const s=mc(),a=await this.core.crypto.setSymKey(s),u=Dr(X.FIVE_MINUTES),f={protocol:If},y={topic:a,expiry:u,relay:f,active:!1},m=x0({protocol:this.core.protocol,version:this.core.version,topic:a,symKey:s,relay:f});return await this.pairings.set(a,y),await this.core.relayer.subscribe(a),this.core.expirer.set(a,u),{topic:a,uri:m}},this.pair=async s=>{this.isInitialized(),this.isValidPair(s);const{topic:a,symKey:u,relay:f}=Fh(s.uri);let y;if(this.pairings.keys.includes(a)&&(y=this.pairings.get(a),y.active))throw new Error(`Pairing already exists: ${a}. Please try again with a new connection URI.`);const m=Dr(X.FIVE_MINUTES),d={topic:a,relay:f,expiry:m,active:!1};return await this.pairings.set(a,d),this.core.expirer.set(a,m),s.activatePairing&&await this.activate({topic:a}),this.events.emit(Fs.create,d),this.core.crypto.keychain.has(a)||(await this.core.crypto.setSymKey(u,a),await this.core.relayer.subscribe(a,{relay:f})),d},this.activate=async({topic:s})=>{this.isInitialized();const a=Dr(X.THIRTY_DAYS);await this.pairings.update(s,{active:!0,expiry:a}),this.core.expirer.set(s,a)},this.ping=async s=>{this.isInitialized(),await this.isValidPing(s);const{topic:a}=s;if(this.pairings.keys.includes(a)){const u=await this.sendRequest(a,"wc_pairingPing",{}),{done:f,resolve:y,reject:m}=ls();this.events.once(St("pairing_ping",u),({error:d})=>{d?m(d):y()}),await f()}},this.updateExpiry=async({topic:s,expiry:a})=>{this.isInitialized(),await this.pairings.update(s,{expiry:a})},this.updateMetadata=async({topic:s,metadata:a})=>{this.isInitialized(),await this.pairings.update(s,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async s=>{this.isInitialized(),await this.isValidDisconnect(s);const{topic:a}=s;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",kt("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(s,a,u)=>{const f=gs(a,u),y=await this.core.crypto.encode(s,f),m=Ms[a].req;return this.core.history.set(s,f),this.core.relayer.publish(s,y,m),f.id},this.sendResult=async(s,a,u)=>{const f=xa(s,u),y=await this.core.crypto.encode(a,f),m=await this.core.history.get(a,s),d=Ms[m.request.method].res;await this.core.relayer.publish(a,y,d),await this.core.history.resolve(f)},this.sendError=async(s,a,u)=>{const f=qc(s,u),y=await this.core.crypto.encode(a,f),m=await this.core.history.get(a,s),d=Ms[m.request.method]?Ms[m.request.method].res:Ms.unregistered_method.res;await this.core.relayer.publish(a,y,d),await this.core.history.resolve(f)},this.deletePairing=async(s,a)=>{await this.core.relayer.unsubscribe(s),await Promise.all([this.pairings.delete(s,kt("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(s),a?Promise.resolve():this.core.expirer.del(s)])},this.cleanup=async()=>{const s=this.pairings.getAll().filter(a=>wi(a.expiry));await Promise.all(s.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=s=>{const{topic:a,payload:u}=s;switch(u.method){case"wc_pairingPing":return this.onPairingPingRequest(a,u);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,u);default:return this.onUnknownRpcMethodRequest(a,u)}},this.onRelayEventResponse=async s=>{const{topic:a,payload:u}=s,f=(await this.core.history.get(a,u.id)).request.method;switch(f){case"wc_pairingPing":return this.onPairingPingResponse(a,u);default:return this.onUnknownRpcMethodResponse(f)}},this.onPairingPingRequest=async(s,a)=>{const{id:u}=a;try{this.isValidPing({topic:s}),await this.sendResult(u,s,!0),this.events.emit(Fs.ping,{id:u,topic:s})}catch(f){await this.sendError(u,s,f),this.logger.error(f)}},this.onPairingPingResponse=(s,a)=>{const{id:u}=a;setTimeout(()=>{mi(a)?this.events.emit(St("pairing_ping",u),{}):Kr(a)&&this.events.emit(St("pairing_ping",u),{error:a.error})},500)},this.onPairingDeleteRequest=async(s,a)=>{const{id:u}=a;try{this.isValidDisconnect({topic:s}),await this.deletePairing(s),this.events.emit(Fs.delete,{id:u,topic:s})}catch(f){await this.sendError(u,s,f),this.logger.error(f)}},this.onUnknownRpcMethodRequest=async(s,a)=>{const{id:u,method:f}=a;try{if(this.registeredMethods.includes(f))return;const y=kt("WC_METHOD_UNSUPPORTED",f);await this.sendError(u,s,y),this.logger.error(y)}catch(y){await this.sendError(u,s,y),this.logger.error(y)}},this.onUnknownRpcMethodResponse=s=>{this.registeredMethods.includes(s)||this.logger.error(kt("WC_METHOD_UNSUPPORTED",s))},this.isValidPair=s=>{var a;if(!ar(s)){const{message:f}=B("MISSING_OR_INVALID",`pair() params: ${s}`);throw new Error(f)}if(!P0(s.uri)){const{message:f}=B("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw new Error(f)}const u=Fh(s.uri);if(!((a=u==null?void 0:u.relay)!=null&&a.protocol)){const{message:f}=B("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(f)}if(!(u!=null&&u.symKey)){const{message:f}=B("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(f)}},this.isValidPing=async s=>{if(!ar(s)){const{message:u}=B("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(u)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidDisconnect=async s=>{if(!ar(s)){const{message:u}=B("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(u)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async s=>{if(!fs(s,!1)){const{message:a}=B("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(a)}if(!this.pairings.keys.includes(s)){const{message:a}=B("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(a)}if(wi(this.pairings.get(s).expiry)){await this.deletePairing(s);const{message:a}=B("EXPIRED",`pairing topic: ${s}`);throw new Error(a)}},this.core=t,this.logger=cr(i,this.name),this.pairings=new Ca(this.core,this.logger,this.name,this.storagePrefix)}get context(){return or(this.logger)}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.core.relayer.on(Kt.message,async t=>{const{topic:i,message:s}=t;if(!this.pairings.keys.includes(i)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(s)))return;const a=await this.core.crypto.decode(i,s);try{jc(a)?(this.core.history.set(i,a),this.onRelayEventRequest({topic:i,payload:a})):Ea(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:i,payload:a}),this.core.history.delete(i,a.id))}catch(u){this.logger.error(u)}})}registerExpirerEvents(){this.core.expirer.on(Pr.expired,async t=>{const{topic:i}=Bl(t.target);i&&this.pairings.keys.includes(i)&&(await this.deletePairing(i,!0),this.events.emit(Fs.expire,{topic:i}))})}}class TI extends R_{constructor(t,i){super(t,i),this.core=t,this.logger=i,this.records=new Map,this.events=new qr.EventEmitter,this.name=sI,this.version=nI,this.cached=[],this.initialized=!1,this.storagePrefix=bi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.records.set(s.id,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(s,a,u)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:a,chainId:u}),this.records.has(a.id))return;const f={id:a.id,topic:s,request:{method:a.method,params:a.params||null},chainId:u,expiry:Dr(X.THIRTY_DAYS)};this.records.set(f.id,f),this.events.emit(kr.created,f)},this.resolve=async s=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:s}),!this.records.has(s.id))return;const a=await this.getRecord(s.id);typeof a.response>"u"&&(a.response=Kr(s)?{error:s.error}:{result:s.result},this.records.set(a.id,a),this.events.emit(kr.updated,a))},this.get=async(s,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:s,id:a}),await this.getRecord(a)),this.delete=(s,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(u=>{if(u.topic===s){if(typeof a<"u"&&u.id!==a)return;this.records.delete(u.id),this.events.emit(kr.deleted,u)}})},this.exists=async(s,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===s:!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=cr(i,this.name)}get context(){return or(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const t=[];return this.values.forEach(i=>{if(typeof i.response<"u")return;const s={topic:i.topic,request:gs(i.request.method,i.request.params,i.id),chainId:i.chainId};return t.push(s)}),t}async setJsonRpcRecords(t){await this.core.storage.setItem(this.storageKey,t)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(t){this.isInitialized();const i=this.records.get(t);if(!i){const{message:s}=B("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(s)}return i}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(kr.sync)}async restore(){try{const t=await this.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(this.records.size){const{message:i}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=t,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}}registerEventListeners(){this.events.on(kr.created,t=>{const i=kr.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:t}),this.persist()}),this.events.on(kr.updated,t=>{const i=kr.updated;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:t}),this.persist()}),this.events.on(kr.deleted,t=>{const i=kr.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:t}),this.persist()}),this.core.heartbeat.on(vs.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(t=>{X.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.delete(t.topic,t.id))})}catch(t){this.logger.warn(t)}}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}}class $I extends D_{constructor(t,i){super(t,i),this.core=t,this.logger=i,this.expirations=new Map,this.events=new qr.EventEmitter,this.name=aI,this.version=oI,this.cached=[],this.initialized=!1,this.storagePrefix=bi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.expirations.set(s.target,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=s=>{try{const a=this.formatTarget(s);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(s,a)=>{this.isInitialized();const u=this.formatTarget(s),f={target:u,expiry:a};this.expirations.set(u,f),this.checkExpiry(u,f),this.events.emit(Pr.created,{target:u,expiration:f})},this.get=s=>{this.isInitialized();const a=this.formatTarget(s);return this.getExpiration(a)},this.del=s=>{if(this.isInitialized(),this.has(s)){const a=this.formatTarget(s),u=this.getExpiration(a);this.expirations.delete(a),this.events.emit(Pr.deleted,{target:a,expiration:u})}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=cr(i,this.name)}get context(){return or(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(t){if(typeof t=="string")return S0(t);if(typeof t=="number")return O0(t);const{message:i}=B("UNKNOWN_TYPE",`Target type: ${typeof t}`);throw new Error(i)}async setExpirations(t){await this.core.storage.setItem(this.storageKey,t)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Pr.sync)}async restore(){try{const t=await this.getExpirations();if(typeof t>"u"||!t.length)return;if(this.expirations.size){const{message:i}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=t,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(t){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(t)}}getExpiration(t){const i=this.expirations.get(t);if(!i){const{message:s}=B("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(s),new Error(s)}return i}checkExpiry(t,i){const{expiry:s}=i;X.toMiliseconds(s)-Date.now()<=0&&this.expire(t,i)}expire(t,i){this.expirations.delete(t),this.events.emit(Pr.expired,{target:t,expiration:i})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((t,i)=>this.checkExpiry(i,t))}registerEventListeners(){this.core.heartbeat.on(vs.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Pr.created,t=>{const i=Pr.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:t}),this.persist()}),this.events.on(Pr.expired,t=>{const i=Pr.expired;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:t}),this.persist()}),this.events.on(Pr.deleted,t=>{const i=Pr.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:t}),this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}}class NI extends q_{constructor(t,i){super(t,i),this.projectId=t,this.logger=i,this.name=hc,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async s=>{if(this.verifyDisabled||R0()||!Gl())return;const a=this.getVerifyUrl(s==null?void 0:s.verifyUrl);this.verifyUrl!==a&&this.removeIframe(),this.verifyUrl=a;try{await this.createIframe()}catch(u){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(u)}if(!this.initialized){this.removeIframe(),this.verifyUrl=Oc;try{await this.createIframe()}catch(u){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(u),this.verifyDisabled=!0}}},this.register=async s=>{this.initialized?this.sendPost(s.attestationId):(this.addToQueue(s.attestationId),await this.init())},this.resolve=async s=>{if(this.isDevEnv)return"";const a=this.getVerifyUrl(s==null?void 0:s.verifyUrl);let u;try{u=await this.fetchAttestation(s.attestationId,a)}catch(f){this.logger.info(`failed to resolve attestation: ${s.attestationId} from url: ${a}`),this.logger.info(f),u=await this.fetchAttestation(s.attestationId,Oc)}return u},this.fetchAttestation=async(s,a)=>{this.logger.info(`resolving attestation: ${s} from url: ${a}`);const u=this.startAbortTimer(X.ONE_SECOND*2),f=await fetch(`${a}/attestation/${s}`,{signal:this.abortController.signal});return clearTimeout(u),f.status===200?await f.json():void 0},this.addToQueue=s=>{this.queue.push(s)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(s=>this.sendPost(s)),this.queue=[])},this.sendPost=s=>{var a;try{if(!this.iframe)return;(a=this.iframe.contentWindow)==null||a.postMessage(s,"*"),this.logger.info(`postMessage sent: ${s} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let s;const a=u=>{u.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",a),s())};await Promise.race([new Promise(u=>{if(document.getElementById(hc))return u();window.addEventListener("message",a);const f=document.createElement("iframe");f.id=hc,f.src=`${this.verifyUrl}/${this.projectId}`,f.style.display="none",document.body.append(f),this.iframe=f,s=u}),new Promise((u,f)=>setTimeout(()=>{window.removeEventListener("message",a),f("verify iframe load timeout")},X.toMiliseconds(X.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=s=>{let a=s||ps;return cI.includes(a)||(this.logger.info(`verify url: ${a}, not included in trusted list, assigning default: ${ps}`),a=ps),a},this.logger=cr(i,this.name),this.verifyUrl=ps,this.abortController=new AbortController,this.isDevEnv=A0()&&u1.IS_VITEST}get context(){return or(this.logger)}startAbortTimer(t){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),X.toMiliseconds(t))}}class DI extends j_{constructor(t,i){super(t,i),this.projectId=t,this.logger=i,this.context=uI,this.registerDeviceToken=async s=>{const{clientId:a,token:u,notificationType:f,enableEncrypted:y=!1}=s,m=`${hI}/${this.projectId}/clients`;await c1(m,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:a,type:f,token:u,always_raw:y})})},this.logger=cr(i,this.context)}}var qI=Object.defineProperty,Ol=Object.getOwnPropertySymbols,jI=Object.prototype.hasOwnProperty,LI=Object.prototype.propertyIsEnumerable,Rl=(o,t,i)=>t in o?qI(o,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[t]=i,Al=(o,t)=>{for(var i in t||(t={}))jI.call(t,i)&&Rl(o,i,t[i]);if(Ol)for(var i of Ol(t))LI.call(t,i)&&Rl(o,i,t[i]);return o};class Mc extends O_{constructor(t){super(t),this.protocol=bf,this.version=Db,this.name=zc,this.events=new qr.EventEmitter,this.initialized=!1,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.projectId=t==null?void 0:t.projectId,this.relayUrl=(t==null?void 0:t.relayUrl)||Ef,this.customStoragePrefix=t!=null&&t.customStoragePrefix?`:${t.customStoragePrefix}`:"";const i=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Oa(Ra({level:(t==null?void 0:t.logger)||qb.logger}));this.logger=cr(i,this.name),this.heartbeat=new vs.HeartBeat,this.crypto=new fI(this,this.logger,t==null?void 0:t.keychain),this.history=new TI(this,this.logger),this.expirer=new $I(this,this.logger),this.storage=t!=null&&t.storage?t.storage:new Cw(Al(Al({},jb),t==null?void 0:t.storageOptions)),this.relayer=new SI({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new CI(this,this.logger),this.verify=new NI(this.projectId||"",this.logger),this.echoClient=new DI(this.projectId||"",this.logger)}static async init(t){const i=new Mc(t);await i.initialize();const s=await i.crypto.getClientId();return await i.storage.setItem(Zb,s),i}get context(){return or(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(t){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,t),this.logger.error(t.message),t}}}const zI=Mc,xf="wc",Pf=2,Sf="client",Uc=`${xf}@${Pf}:${Sf}:`,fc={name:Sf,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Cl="WALLETCONNECT_DEEPLINK_CHOICE",MI="proposal",Of="Proposal expired",UI="session",la=X.SEVEN_DAYS,HI="engine",Hs={wc_sessionPropose:{req:{ttl:X.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:X.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:X.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:X.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:X.ONE_DAY,prompt:!1,tag:1104},res:{ttl:X.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:X.ONE_DAY,prompt:!1,tag:1106},res:{ttl:X.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:X.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:X.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:X.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:X.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:X.ONE_DAY,prompt:!1,tag:1112},res:{ttl:X.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:X.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:X.THIRTY_SECONDS,prompt:!1,tag:1115}}},pc={min:X.FIVE_MINUTES,max:X.SEVEN_DAYS},si={idle:"IDLE",active:"ACTIVE"},kI="request",KI=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var VI=Object.defineProperty,FI=Object.defineProperties,BI=Object.getOwnPropertyDescriptors,Tl=Object.getOwnPropertySymbols,GI=Object.prototype.hasOwnProperty,WI=Object.prototype.propertyIsEnumerable,$l=(o,t,i)=>t in o?VI(o,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[t]=i,sr=(o,t)=>{for(var i in t||(t={}))GI.call(t,i)&&$l(o,i,t[i]);if(Tl)for(var i of Tl(t))WI.call(t,i)&&$l(o,i,t[i]);return o},ks=(o,t)=>FI(o,BI(t));class JI extends z_{constructor(t){super(t),this.name=HI,this.events=new Dc,this.initialized=!1,this.ignoredPayloadTypes=[Fl],this.requestQueue={state:si.idle,queue:[]},this.sessionRequestQueue={state:si.idle,queue:[]},this.requestQueueDelay=X.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Hs)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},X.toMiliseconds(this.requestQueueDelay)))},this.connect=async i=>{await this.isInitialized();const s=ks(sr({},i),{requiredNamespaces:i.requiredNamespaces||{},optionalNamespaces:i.optionalNamespaces||{}});await this.isValidConnect(s);const{pairingTopic:a,requiredNamespaces:u,optionalNamespaces:f,sessionProperties:y,relays:m}=s;let d=a,_,S=!1;if(d&&(S=this.client.core.pairing.pairings.get(d).active),!d||!S){const{topic:ne,uri:re}=await this.client.core.pairing.create();d=ne,_=re}const R=await this.client.core.crypto.generateKeyPair(),D=sr({requiredNamespaces:u,optionalNamespaces:f,relays:m??[{protocol:If}],proposer:{publicKey:R,metadata:this.client.metadata}},y&&{sessionProperties:y}),{reject:A,resolve:Q,done:te}=ls(X.FIVE_MINUTES,Of);if(this.events.once(St("session_connect"),async({error:ne,session:re})=>{if(ne)A(ne);else if(re){re.self.publicKey=R;const fe=ks(sr({},re),{requiredNamespaces:re.requiredNamespaces,optionalNamespaces:re.optionalNamespaces});await this.client.session.set(re.topic,fe),await this.setExpiry(re.topic,re.expiry),d&&await this.client.core.pairing.updateMetadata({topic:d,metadata:re.peer.metadata}),Q(fe)}}),!d){const{message:ne}=B("NO_MATCHING_KEY",`connect() pairing topic: ${d}`);throw new Error(ne)}const ce=await this.sendRequest({topic:d,method:"wc_sessionPropose",params:D}),oe=Dr(X.FIVE_MINUTES);return await this.setProposal(ce,sr({id:ce,expiry:oe},D)),{uri:_,approval:te}},this.pair=async i=>(await this.isInitialized(),await this.client.core.pairing.pair(i)),this.approve=async i=>{await this.isInitialized(),await this.isValidApprove(i);const{id:s,relayProtocol:a,namespaces:u,sessionProperties:f}=i,y=this.client.proposal.get(s);let{pairingTopic:m,proposer:d,requiredNamespaces:_,optionalNamespaces:S}=y;m=m||"",ga(_)||(_=T0(u,"approve()"));const R=await this.client.core.crypto.generateKeyPair(),D=d.publicKey,A=await this.client.core.crypto.generateSharedKey(R,D);m&&s&&(await this.client.core.pairing.updateMetadata({topic:m,metadata:d.metadata}),await this.sendResult({id:s,topic:m,result:{relay:{protocol:a??"irn"},responderPublicKey:R}}),await this.client.proposal.delete(s,kt("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:m}));const Q=sr({relay:{protocol:a??"irn"},namespaces:u,requiredNamespaces:_,optionalNamespaces:S,pairingTopic:m,controller:{publicKey:R,metadata:this.client.metadata},expiry:Dr(la)},f&&{sessionProperties:f});await this.client.core.relayer.subscribe(A),await this.sendRequest({topic:A,method:"wc_sessionSettle",params:Q,throwOnFailedPublish:!0});const te=ks(sr({},Q),{topic:A,pairingTopic:m,acknowledged:!1,self:Q.controller,peer:{publicKey:d.publicKey,metadata:d.metadata},controller:R});return await this.client.session.set(A,te),await this.setExpiry(A,Dr(la)),{topic:A,acknowledged:()=>new Promise(ce=>setTimeout(()=>ce(this.client.session.get(A)),500))}},this.reject=async i=>{await this.isInitialized(),await this.isValidReject(i);const{id:s,reason:a}=i,{pairingTopic:u}=this.client.proposal.get(s);u&&(await this.sendError(s,u,a),await this.client.proposal.delete(s,kt("USER_DISCONNECTED")))},this.update=async i=>{await this.isInitialized(),await this.isValidUpdate(i);const{topic:s,namespaces:a}=i,u=await this.sendRequest({topic:s,method:"wc_sessionUpdate",params:{namespaces:a}}),{done:f,resolve:y,reject:m}=ls();return this.events.once(St("session_update",u),({error:d})=>{d?m(d):y()}),await this.client.session.update(s,{namespaces:a}),{acknowledged:f}},this.extend=async i=>{await this.isInitialized(),await this.isValidExtend(i);const{topic:s}=i,a=await this.sendRequest({topic:s,method:"wc_sessionExtend",params:{}}),{done:u,resolve:f,reject:y}=ls();return this.events.once(St("session_extend",a),({error:m})=>{m?y(m):f()}),await this.setExpiry(s,Dr(la)),{acknowledged:u}},this.request=async i=>{await this.isInitialized(),await this.isValidRequest(i);const{chainId:s,request:a,topic:u,expiry:f}=i,y=ew(),{done:m,resolve:d,reject:_}=ls(f,"Request expired. Please try again.");return this.events.once(St("session_request",y),({error:S,result:R})=>{S?_(S):d(R)}),await Promise.all([new Promise(async S=>{await this.sendRequest({clientRpcId:y,topic:u,method:"wc_sessionRequest",params:{request:a,chainId:s},expiry:f,throwOnFailedPublish:!0}).catch(R=>_(R)),this.client.events.emit("session_request_sent",{topic:u,request:a,chainId:s,id:y}),S()}),new Promise(async S=>{const R=await $0(this.client.core.storage,Cl);N0({id:y,topic:u,wcDeepLink:R}),S()}),m()]).then(S=>S[2])},this.respond=async i=>{await this.isInitialized(),await this.isValidRespond(i);const{topic:s,response:a}=i,{id:u}=a;mi(a)?await this.sendResult({id:u,topic:s,result:a.result,throwOnFailedPublish:!0}):Kr(a)&&await this.sendError(u,s,a.error),this.cleanupAfterResponse(i)},this.ping=async i=>{await this.isInitialized(),await this.isValidPing(i);const{topic:s}=i;if(this.client.session.keys.includes(s)){const a=await this.sendRequest({topic:s,method:"wc_sessionPing",params:{}}),{done:u,resolve:f,reject:y}=ls();this.events.once(St("session_ping",a),({error:m})=>{m?y(m):f()}),await u()}else this.client.core.pairing.pairings.keys.includes(s)&&await this.client.core.pairing.ping({topic:s})},this.emit=async i=>{await this.isInitialized(),await this.isValidEmit(i);const{topic:s,event:a,chainId:u}=i;await this.sendRequest({topic:s,method:"wc_sessionEvent",params:{event:a,chainId:u}})},this.disconnect=async i=>{await this.isInitialized(),await this.isValidDisconnect(i);const{topic:s}=i;this.client.session.keys.includes(s)?(await this.sendRequest({topic:s,method:"wc_sessionDelete",params:kt("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(s)):await this.client.core.pairing.disconnect({topic:s})},this.find=i=>(this.isInitialized(),this.client.session.getAll().filter(s=>D0(s,i))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async i=>{if(i.pairingTopic)try{const s=this.client.core.pairing.pairings.get(i.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(u=>{var f,y;return((f=u.peerMetadata)==null?void 0:f.url)&&((y=u.peerMetadata)==null?void 0:y.url)===i.peer.metadata.url&&u.topic&&u.topic!==s.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(u=>this.client.core.pairing.disconnect({topic:u.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(s){this.client.logger.error(s)}},this.deleteSession=async(i,s)=>{const{self:a}=this.client.session.get(i);await this.client.core.relayer.unsubscribe(i),this.client.session.delete(i,kt("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(i)&&await this.client.core.crypto.deleteSymKey(i),s||this.client.core.expirer.del(i),this.client.core.storage.removeItem(Cl).catch(u=>this.client.logger.warn(u)),this.getPendingSessionRequests().forEach(u=>{u.topic===i&&this.deletePendingSessionRequest(u.id,kt("USER_DISCONNECTED"))})},this.deleteProposal=async(i,s)=>{await Promise.all([this.client.proposal.delete(i,kt("USER_DISCONNECTED")),s?Promise.resolve():this.client.core.expirer.del(i)])},this.deletePendingSessionRequest=async(i,s,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(i,s),a?Promise.resolve():this.client.core.expirer.del(i)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(u=>u.id!==i),a&&(this.sessionRequestQueue.state=si.idle)},this.setExpiry=async(i,s)=>{this.client.session.keys.includes(i)&&await this.client.session.update(i,{expiry:s}),this.client.core.expirer.set(i,s)},this.setProposal=async(i,s)=>{await this.client.proposal.set(i,s),this.client.core.expirer.set(i,s.expiry)},this.setPendingSessionRequest=async i=>{const s=Hs.wc_sessionRequest.req.ttl,{id:a,topic:u,params:f,verifyContext:y}=i;await this.client.pendingRequest.set(a,{id:a,topic:u,params:f,verifyContext:y}),s&&this.client.core.expirer.set(a,Dr(s))},this.sendRequest=async i=>{const{topic:s,method:a,params:u,expiry:f,relayRpcId:y,clientRpcId:m,throwOnFailedPublish:d}=i,_=gs(a,u,m);if(Gl()&&KI.includes(a)){const D=ds(JSON.stringify(_));this.client.core.verify.register({attestationId:D})}const S=await this.client.core.crypto.encode(s,_),R=Hs[a].req;return f&&(R.ttl=f),y&&(R.id=y),this.client.core.history.set(s,_),d?(R.internal=ks(sr({},R.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,S,R)):this.client.core.relayer.publish(s,S,R).catch(D=>this.client.logger.error(D)),_.id},this.sendResult=async i=>{const{id:s,topic:a,result:u,throwOnFailedPublish:f}=i,y=xa(s,u),m=await this.client.core.crypto.encode(a,y),d=await this.client.core.history.get(a,s),_=Hs[d.request.method].res;f?(_.internal=ks(sr({},_.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(a,m,_)):this.client.core.relayer.publish(a,m,_).catch(S=>this.client.logger.error(S)),await this.client.core.history.resolve(y)},this.sendError=async(i,s,a)=>{const u=qc(i,a),f=await this.client.core.crypto.encode(s,u),y=await this.client.core.history.get(s,i),m=Hs[y.request.method].res;this.client.core.relayer.publish(s,f,m),await this.client.core.history.resolve(u)},this.cleanup=async()=>{const i=[],s=[];this.client.session.getAll().forEach(a=>{wi(a.expiry)&&i.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{wi(a.expiry)&&s.push(a.id)}),await Promise.all([...i.map(a=>this.deleteSession(a)),...s.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=async i=>{this.requestQueue.queue.push(i),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===si.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=si.active;const i=this.requestQueue.queue.shift();if(i)try{this.processRequest(i),await new Promise(s=>setTimeout(s,300))}catch(s){this.client.logger.warn(s)}}this.requestQueue.state=si.idle},this.processRequest=i=>{const{topic:s,payload:a}=i,u=a.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeRequest(s,a);case"wc_sessionSettle":return this.onSessionSettleRequest(s,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(s,a);case"wc_sessionExtend":return this.onSessionExtendRequest(s,a);case"wc_sessionPing":return this.onSessionPingRequest(s,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(s,a);case"wc_sessionRequest":return this.onSessionRequest(s,a);case"wc_sessionEvent":return this.onSessionEventRequest(s,a);default:return this.client.logger.info(`Unsupported request method ${u}`)}},this.onRelayEventResponse=async i=>{const{topic:s,payload:a}=i,u=(await this.client.core.history.get(s,a.id)).request.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeResponse(s,a);case"wc_sessionSettle":return this.onSessionSettleResponse(s,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(s,a);case"wc_sessionExtend":return this.onSessionExtendResponse(s,a);case"wc_sessionPing":return this.onSessionPingResponse(s,a);case"wc_sessionRequest":return this.onSessionRequestResponse(s,a);default:return this.client.logger.info(`Unsupported response method ${u}`)}},this.onRelayEventUnknownPayload=i=>{const{topic:s}=i,{message:a}=B("MISSING_OR_INVALID",`Decoded payload on topic ${s} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.onSessionProposeRequest=async(i,s)=>{const{params:a,id:u}=s;try{this.isValidConnect(sr({},s.params));const f=Dr(X.FIVE_MINUTES),y=sr({id:u,pairingTopic:i,expiry:f},a);await this.setProposal(u,y);const m=ds(JSON.stringify(s)),d=await this.getVerifyContext(m,y.proposer.metadata);this.client.events.emit("session_proposal",{id:u,params:y,verifyContext:d})}catch(f){await this.sendError(u,i,f),this.client.logger.error(f)}},this.onSessionProposeResponse=async(i,s)=>{const{id:a}=s;if(mi(s)){const{result:u}=s;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:u});const f=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:f});const y=f.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:y});const m=u.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:m});const d=await this.client.core.crypto.generateSharedKey(y,m);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:d});const _=await this.client.core.relayer.subscribe(d);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:_}),await this.client.core.pairing.activate({topic:i})}else Kr(s)&&(await this.client.proposal.delete(a,kt("USER_DISCONNECTED")),this.events.emit(St("session_connect"),{error:s.error}))},this.onSessionSettleRequest=async(i,s)=>{const{id:a,params:u}=s;try{this.isValidSessionSettleRequest(u);const{relay:f,controller:y,expiry:m,namespaces:d,requiredNamespaces:_,optionalNamespaces:S,sessionProperties:R,pairingTopic:D}=s.params,A=sr({topic:i,relay:f,expiry:m,namespaces:d,acknowledged:!0,pairingTopic:D,requiredNamespaces:_,optionalNamespaces:S,controller:y.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:y.publicKey,metadata:y.metadata}},R&&{sessionProperties:R});await this.sendResult({id:s.id,topic:i,result:!0}),this.events.emit(St("session_connect"),{session:A}),this.cleanupDuplicatePairings(A)}catch(f){await this.sendError(a,i,f),this.client.logger.error(f)}},this.onSessionSettleResponse=async(i,s)=>{const{id:a}=s;mi(s)?(await this.client.session.update(i,{acknowledged:!0}),this.events.emit(St("session_approve",a),{})):Kr(s)&&(await this.client.session.delete(i,kt("USER_DISCONNECTED")),this.events.emit(St("session_approve",a),{error:s.error}))},this.onSessionUpdateRequest=async(i,s)=>{const{params:a,id:u}=s;try{const f=`${i}_session_update`,y=oa.get(f);if(y&&this.isRequestOutOfSync(y,u)){this.client.logger.info(`Discarding out of sync request - ${u}`);return}this.isValidUpdate(sr({topic:i},a)),await this.client.session.update(i,{namespaces:a.namespaces}),await this.sendResult({id:u,topic:i,result:!0}),this.client.events.emit("session_update",{id:u,topic:i,params:a}),oa.set(f,u)}catch(f){await this.sendError(u,i,f),this.client.logger.error(f)}},this.isRequestOutOfSync=(i,s)=>parseInt(s.toString().slice(0,-3))<=parseInt(i.toString().slice(0,-3)),this.onSessionUpdateResponse=(i,s)=>{const{id:a}=s;mi(s)?this.events.emit(St("session_update",a),{}):Kr(s)&&this.events.emit(St("session_update",a),{error:s.error})},this.onSessionExtendRequest=async(i,s)=>{const{id:a}=s;try{this.isValidExtend({topic:i}),await this.setExpiry(i,Dr(la)),await this.sendResult({id:a,topic:i,result:!0}),this.client.events.emit("session_extend",{id:a,topic:i})}catch(u){await this.sendError(a,i,u),this.client.logger.error(u)}},this.onSessionExtendResponse=(i,s)=>{const{id:a}=s;mi(s)?this.events.emit(St("session_extend",a),{}):Kr(s)&&this.events.emit(St("session_extend",a),{error:s.error})},this.onSessionPingRequest=async(i,s)=>{const{id:a}=s;try{this.isValidPing({topic:i}),await this.sendResult({id:a,topic:i,result:!0}),this.client.events.emit("session_ping",{id:a,topic:i})}catch(u){await this.sendError(a,i,u),this.client.logger.error(u)}},this.onSessionPingResponse=(i,s)=>{const{id:a}=s;setTimeout(()=>{mi(s)?this.events.emit(St("session_ping",a),{}):Kr(s)&&this.events.emit(St("session_ping",a),{error:s.error})},500)},this.onSessionDeleteRequest=async(i,s)=>{const{id:a}=s;try{this.isValidDisconnect({topic:i,reason:s.params}),await Promise.all([new Promise(u=>{this.client.core.relayer.once(Kt.publish,async()=>{u(await this.deleteSession(i))})}),this.sendResult({id:a,topic:i,result:!0})]),this.client.events.emit("session_delete",{id:a,topic:i})}catch(u){this.client.logger.error(u)}},this.onSessionRequest=async(i,s)=>{const{id:a,params:u}=s;try{this.isValidRequest(sr({topic:i},u));const f=ds(JSON.stringify(gs("wc_sessionRequest",u,a))),y=this.client.session.get(i),m=await this.getVerifyContext(f,y.peer.metadata),d={id:a,topic:i,params:u,verifyContext:m};await this.setPendingSessionRequest(d),this.addSessionRequestToSessionRequestQueue(d),this.processSessionRequestQueue()}catch(f){await this.sendError(a,i,f),this.client.logger.error(f)}},this.onSessionRequestResponse=(i,s)=>{const{id:a}=s;mi(s)?this.events.emit(St("session_request",a),{result:s.result}):Kr(s)&&this.events.emit(St("session_request",a),{error:s.error})},this.onSessionEventRequest=async(i,s)=>{const{id:a,params:u}=s;try{const f=`${i}_session_event_${u.event.name}`,y=oa.get(f);if(y&&this.isRequestOutOfSync(y,a)){this.client.logger.info(`Discarding out of sync request - ${a}`);return}this.isValidEmit(sr({topic:i},u)),this.client.events.emit("session_event",{id:a,topic:i,params:u}),oa.set(f,a)}catch(f){await this.sendError(a,i,f),this.client.logger.error(f)}},this.addSessionRequestToSessionRequestQueue=i=>{this.sessionRequestQueue.queue.push(i)},this.cleanupAfterResponse=i=>{this.deletePendingSessionRequest(i.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=si.idle,this.processSessionRequestQueue()},X.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===si.active){this.client.logger.info("session request queue is already active.");return}const i=this.sessionRequestQueue.queue[0];if(!i){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=si.active,this.client.events.emit("session_request",i)}catch(s){this.client.logger.error(s)}},this.onPairingCreated=i=>{if(i.active)return;const s=this.client.proposal.getAll().find(a=>a.pairingTopic===i.topic);s&&this.onSessionProposeRequest(i.topic,gs("wc_sessionPropose",{requiredNamespaces:s.requiredNamespaces,optionalNamespaces:s.optionalNamespaces,relays:s.relays,proposer:s.proposer,sessionProperties:s.sessionProperties},s.id))},this.isValidConnect=async i=>{if(!ar(i)){const{message:m}=B("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(i)}`);throw new Error(m)}const{pairingTopic:s,requiredNamespaces:a,optionalNamespaces:u,sessionProperties:f,relays:y}=i;if(_i(s)||await this.isValidPairingTopic(s),!q0(y)){const{message:m}=B("MISSING_OR_INVALID",`connect() relays: ${y}`);throw new Error(m)}!_i(a)&&ga(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!_i(u)&&ga(u)!==0&&this.validateNamespaces(u,"optionalNamespaces"),_i(f)||this.validateSessionProps(f,"sessionProperties")},this.validateNamespaces=(i,s)=>{const a=j0(i,"connect()",s);if(a)throw new Error(a.message)},this.isValidApprove=async i=>{if(!ar(i))throw new Error(B("MISSING_OR_INVALID",`approve() params: ${i}`).message);const{id:s,namespaces:a,relayProtocol:u,sessionProperties:f}=i;await this.isValidProposalId(s);const y=this.client.proposal.get(s),m=rc(a,"approve()");if(m)throw new Error(m.message);const d=Bh(y.requiredNamespaces,a,"approve()");if(d)throw new Error(d.message);if(!fs(u,!0)){const{message:_}=B("MISSING_OR_INVALID",`approve() relayProtocol: ${u}`);throw new Error(_)}_i(f)||this.validateSessionProps(f,"sessionProperties")},this.isValidReject=async i=>{if(!ar(i)){const{message:u}=B("MISSING_OR_INVALID",`reject() params: ${i}`);throw new Error(u)}const{id:s,reason:a}=i;if(await this.isValidProposalId(s),!L0(a)){const{message:u}=B("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(u)}},this.isValidSessionSettleRequest=i=>{if(!ar(i)){const{message:d}=B("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${i}`);throw new Error(d)}const{relay:s,controller:a,namespaces:u,expiry:f}=i;if(!z0(s)){const{message:d}=B("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(d)}const y=M0(a,"onSessionSettleRequest()");if(y)throw new Error(y.message);const m=rc(u,"onSessionSettleRequest()");if(m)throw new Error(m.message);if(wi(f)){const{message:d}=B("EXPIRED","onSessionSettleRequest()");throw new Error(d)}},this.isValidUpdate=async i=>{if(!ar(i)){const{message:m}=B("MISSING_OR_INVALID",`update() params: ${i}`);throw new Error(m)}const{topic:s,namespaces:a}=i;await this.isValidSessionTopic(s);const u=this.client.session.get(s),f=rc(a,"update()");if(f)throw new Error(f.message);const y=Bh(u.requiredNamespaces,a,"update()");if(y)throw new Error(y.message)},this.isValidExtend=async i=>{if(!ar(i)){const{message:a}=B("MISSING_OR_INVALID",`extend() params: ${i}`);throw new Error(a)}const{topic:s}=i;await this.isValidSessionTopic(s)},this.isValidRequest=async i=>{if(!ar(i)){const{message:m}=B("MISSING_OR_INVALID",`request() params: ${i}`);throw new Error(m)}const{topic:s,request:a,chainId:u,expiry:f}=i;await this.isValidSessionTopic(s);const{namespaces:y}=this.client.session.get(s);if(!Gh(y,u)){const{message:m}=B("MISSING_OR_INVALID",`request() chainId: ${u}`);throw new Error(m)}if(!U0(a)){const{message:m}=B("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(m)}if(!H0(y,u,a.method)){const{message:m}=B("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(m)}if(f&&!k0(f,pc)){const{message:m}=B("MISSING_OR_INVALID",`request() expiry: ${f}. Expiry must be a number (in seconds) between ${pc.min} and ${pc.max}`);throw new Error(m)}},this.isValidRespond=async i=>{var s;if(!ar(i)){const{message:f}=B("MISSING_OR_INVALID",`respond() params: ${i}`);throw new Error(f)}const{topic:a,response:u}=i;try{await this.isValidSessionTopic(a)}catch(f){throw(s=i==null?void 0:i.response)!=null&&s.id&&this.cleanupAfterResponse(i),f}if(!K0(u)){const{message:f}=B("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(u)}`);throw new Error(f)}},this.isValidPing=async i=>{if(!ar(i)){const{message:a}=B("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(a)}const{topic:s}=i;await this.isValidSessionOrPairingTopic(s)},this.isValidEmit=async i=>{if(!ar(i)){const{message:y}=B("MISSING_OR_INVALID",`emit() params: ${i}`);throw new Error(y)}const{topic:s,event:a,chainId:u}=i;await this.isValidSessionTopic(s);const{namespaces:f}=this.client.session.get(s);if(!Gh(f,u)){const{message:y}=B("MISSING_OR_INVALID",`emit() chainId: ${u}`);throw new Error(y)}if(!V0(a)){const{message:y}=B("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(y)}if(!F0(f,u,a.name)){const{message:y}=B("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(y)}},this.isValidDisconnect=async i=>{if(!ar(i)){const{message:a}=B("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(a)}const{topic:s}=i;await this.isValidSessionOrPairingTopic(s)},this.getVerifyContext=async(i,s)=>{const a={verified:{verifyUrl:s.verifyUrl||ps,validation:"UNKNOWN",origin:s.url||""}};try{const u=await this.client.core.verify.resolve({attestationId:i,verifyUrl:s.verifyUrl});u&&(a.verified.origin=u.origin,a.verified.isScam=u.isScam,a.verified.validation=u.origin===new URL(s.url).origin?"VALID":"INVALID")}catch(u){this.client.logger.info(u)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(i,s)=>{Object.values(i).forEach(a=>{if(!fs(a,!1)){const{message:u}=B("MISSING_OR_INVALID",`${s} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(u)}})}}async isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Kt.message,async t=>{const{topic:i,message:s}=t;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(s)))return;const a=await this.client.core.crypto.decode(i,s);try{jc(a)?(this.client.core.history.set(i,a),this.onRelayEventRequest({topic:i,payload:a})):Ea(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:i,payload:a}),this.client.core.history.delete(i,a.id)):this.onRelayEventUnknownPayload({topic:i,payload:a})}catch(u){this.client.logger.error(u)}})}registerExpirerEvents(){this.client.core.expirer.on(Pr.expired,async t=>{const{topic:i,id:s}=Bl(t.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,B("EXPIRED"),!0);i?this.client.session.keys.includes(i)&&(await this.deleteSession(i,!0),this.client.events.emit("session_expire",{topic:i})):s&&(await this.deleteProposal(s,!0),this.client.events.emit("proposal_expire",{id:s}))})}registerPairingEvents(){this.client.core.pairing.events.on(Fs.create,t=>this.onPairingCreated(t))}isValidPairingTopic(t){if(!fs(t,!1)){const{message:i}=B("MISSING_OR_INVALID",`pairing topic should be a string: ${t}`);throw new Error(i)}if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:i}=B("NO_MATCHING_KEY",`pairing topic doesn't exist: ${t}`);throw new Error(i)}if(wi(this.client.core.pairing.pairings.get(t).expiry)){const{message:i}=B("EXPIRED",`pairing topic: ${t}`);throw new Error(i)}}async isValidSessionTopic(t){if(!fs(t,!1)){const{message:i}=B("MISSING_OR_INVALID",`session topic should be a string: ${t}`);throw new Error(i)}if(!this.client.session.keys.includes(t)){const{message:i}=B("NO_MATCHING_KEY",`session topic doesn't exist: ${t}`);throw new Error(i)}if(wi(this.client.session.get(t).expiry)){await this.deleteSession(t);const{message:i}=B("EXPIRED",`session topic: ${t}`);throw new Error(i)}}async isValidSessionOrPairingTopic(t){if(this.client.session.keys.includes(t))await this.isValidSessionTopic(t);else if(this.client.core.pairing.pairings.keys.includes(t))this.isValidPairingTopic(t);else if(fs(t,!1)){const{message:i}=B("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${t}`);throw new Error(i)}else{const{message:i}=B("MISSING_OR_INVALID",`session or pairing topic should be a string: ${t}`);throw new Error(i)}}async isValidProposalId(t){if(!B0(t)){const{message:i}=B("MISSING_OR_INVALID",`proposal id should be a number: ${t}`);throw new Error(i)}if(!this.client.proposal.keys.includes(t)){const{message:i}=B("NO_MATCHING_KEY",`proposal id doesn't exist: ${t}`);throw new Error(i)}if(wi(this.client.proposal.get(t).expiry)){await this.deleteProposal(t);const{message:i}=B("EXPIRED",`proposal id: ${t}`);throw new Error(i)}}}class QI extends Ca{constructor(t,i){super(t,i,MI,Uc),this.core=t,this.logger=i}}class YI extends Ca{constructor(t,i){super(t,i,UI,Uc),this.core=t,this.logger=i}}class ZI extends Ca{constructor(t,i){super(t,i,kI,Uc,s=>s.id),this.core=t,this.logger=i}}let XI=class Rf extends L_{constructor(t){super(t),this.protocol=xf,this.version=Pf,this.name=fc.name,this.events=new qr.EventEmitter,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.removeAllListeners=s=>this.events.removeAllListeners(s),this.connect=async s=>{try{return await this.engine.connect(s)}catch(a){throw this.logger.error(a.message),a}},this.pair=async s=>{try{return await this.engine.pair(s)}catch(a){throw this.logger.error(a.message),a}},this.approve=async s=>{try{return await this.engine.approve(s)}catch(a){throw this.logger.error(a.message),a}},this.reject=async s=>{try{return await this.engine.reject(s)}catch(a){throw this.logger.error(a.message),a}},this.update=async s=>{try{return await this.engine.update(s)}catch(a){throw this.logger.error(a.message),a}},this.extend=async s=>{try{return await this.engine.extend(s)}catch(a){throw this.logger.error(a.message),a}},this.request=async s=>{try{return await this.engine.request(s)}catch(a){throw this.logger.error(a.message),a}},this.respond=async s=>{try{return await this.engine.respond(s)}catch(a){throw this.logger.error(a.message),a}},this.ping=async s=>{try{return await this.engine.ping(s)}catch(a){throw this.logger.error(a.message),a}},this.emit=async s=>{try{return await this.engine.emit(s)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async s=>{try{return await this.engine.disconnect(s)}catch(a){throw this.logger.error(a.message),a}},this.find=s=>{try{return this.engine.find(s)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}},this.name=(t==null?void 0:t.name)||fc.name,this.metadata=(t==null?void 0:t.metadata)||C0();const i=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Oa(Ra({level:(t==null?void 0:t.logger)||fc.logger}));this.core=(t==null?void 0:t.core)||new zI(t),this.logger=cr(i,this.name),this.session=new YI(this.core,this.logger),this.proposal=new QI(this.core,this.logger),this.pendingRequest=new ZI(this.core,this.logger),this.engine=new JI(this)}static async init(t){const i=new Rf(t);return await i.initialize(),i}get context(){return or(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(t){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(t.message),t}}};const Nl="error",eE="wss://relay.walletconnect.com",tE="wc",rE="universal_provider",Dl=`${tE}@2:${rE}:`,iE="https://rpc.walletconnect.com/v1/",ai={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Ks=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Rc={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(o,t){(function(){var i,s="4.17.21",a=200,u="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",f="Expected a function",y="Invalid `variable` option passed into `_.template`",m="__lodash_hash_undefined__",d=500,_="__lodash_placeholder__",S=1,R=2,D=4,A=1,Q=2,te=1,ce=2,oe=4,ne=8,re=16,fe=32,pe=64,Y=128,xe=256,Tt=512,yt=30,Yt="...",Vt=800,ur=16,M=1,U=2,Ge=3,qe=1/0,G=9007199254740991,K=17976931348623157e292,H=NaN,V=4294967295,Ot=V-1,rt=V>>>1,xi=[["ary",Y],["bind",te],["bindKey",ce],["curry",ne],["curryRight",re],["flip",Tt],["partial",fe],["partialRight",pe],["rearg",xe]],we="[object Arguments]",Sr="[object Array]",$="[object AsyncFunction]",T="[object Boolean]",O="[object Date]",h="[object DOMException]",I="[object Error]",J="[object Function]",ae="[object GeneratorFunction]",ge="[object Map]",Pe="[object Number]",Oe="[object Null]",_e="[object Object]",vt="[object Promise]",lt="[object Proxy]",Ze="[object RegExp]",Ae="[object Set]",ke="[object String]",Ke="[object Symbol]",Xe="[object Undefined]",Ne="[object WeakMap]",Ve="[object WeakSet]",Se="[object ArrayBuffer]",je="[object DataView]",it="[object Float32Array]",Te="[object Float64Array]",mt="[object Int8Array]",Rt="[object Int16Array]",jt="[object Int32Array]",Lt="[object Uint8Array]",$t="[object Uint8ClampedArray]",Ft="[object Uint16Array]",Zt="[object Uint32Array]",jr=/\b__p \+= '';/g,Bt=/\b(__p \+=) '' \+/g,Fr=/(__e\(.*?\)|\b__t\)) \+\n'';/g,oi=/&(?:amp|lt|gt|quot|#39);/g,Pi=/[&<>"']/g,st=RegExp(oi.source),We=RegExp(Pi.source),nt=/<%-([\s\S]+?)%>/g,at=/<%([\s\S]+?)%>/g,et=/<%=([\s\S]+?)%>/g,Je=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,wt=/^\w*$/,_t=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ot=/[\\^$.*+?()[\]{}|]/g,bt=RegExp(ot.source),ct=/^\s+/,ft=/\s/,ut=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,He=/\{\n\/\* \[wrapped with (.+)\] \*/,It=/,? & /,Et=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Ta=/[()=,{}\[\]\/\s]/,$a=/\\(\\)?/g,Na=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,yr=/\w*$/,Da=/^[-+]0x[0-9a-f]+$/i,qa=/^0b[01]+$/i,ja=/^\[object .+?Constructor\]$/,La=/^0o[0-7]+$/i,za=/^(?:0|[1-9]\d*)$/,Br=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Ki=/($^)/,Ma=/['\n\r\u2028\u2029\\]/g,Vi="\\ud800-\\udfff",Ua="\\u0300-\\u036f",Ha="\\ufe20-\\ufe2f",Fi="\\u20d0-\\u20ff",tn=Ua+Ha+Fi,rn="\\u2700-\\u27bf",Or="a-z\\xdf-\\xf6\\xf8-\\xff",ka="\\xac\\xb1\\xd7\\xf7",Ka="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Va="\\u2000-\\u206f",Fa=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",sn="A-Z\\xc0-\\xd6\\xd8-\\xde",nn="\\ufe0e\\ufe0f",Si=ka+Ka+Va+Fa,ms="[']",Oi="["+Vi+"]",ws="["+Si+"]",Ri="["+tn+"]",an="\\d+",Ba="["+rn+"]",on="["+Or+"]",cn="[^"+Vi+Si+an+rn+Or+sn+"]",Bi="\\ud83c[\\udffb-\\udfff]",Ga="(?:"+Ri+"|"+Bi+")",un="[^"+Vi+"]",Gi="(?:\\ud83c[\\udde6-\\uddff]){2}",ci="[\\ud800-\\udbff][\\udc00-\\udfff]",hr="["+sn+"]",hn="\\u200d",ln="(?:"+on+"|"+cn+")",Lr="(?:"+hr+"|"+cn+")",fn="(?:"+ms+"(?:d|ll|m|re|s|t|ve))?",pn="(?:"+ms+"(?:D|LL|M|RE|S|T|VE))?",dn=Ga+"?",gn="["+nn+"]?",Wa="(?:"+hn+"(?:"+[un,Gi,ci].join("|")+")"+gn+dn+")*",Gr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",yn="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",vn=gn+dn+Wa,Wi="(?:"+[Ba,Gi,ci].join("|")+")"+vn,Ja="(?:"+[un+Ri+"?",Ri,Gi,ci,Oi].join("|")+")",_s=RegExp(ms,"g"),Qa=RegExp(Ri,"g"),Ji=RegExp(Bi+"(?="+Bi+")|"+Ja+vn,"g"),mn=RegExp([hr+"?"+on+"+"+fn+"(?="+[ws,hr,"$"].join("|")+")",Lr+"+"+pn+"(?="+[ws,hr+ln,"$"].join("|")+")",hr+"?"+ln+"+"+fn,hr+"+"+pn,yn,Gr,an,Wi].join("|"),"g"),wn=RegExp("["+hn+Vi+tn+nn+"]"),Ai=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,_n=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Ya=-1,Le={};Le[it]=Le[Te]=Le[mt]=Le[Rt]=Le[jt]=Le[Lt]=Le[$t]=Le[Ft]=Le[Zt]=!0,Le[we]=Le[Sr]=Le[Se]=Le[T]=Le[je]=Le[O]=Le[I]=Le[J]=Le[ge]=Le[Pe]=Le[_e]=Le[Ze]=Le[Ae]=Le[ke]=Le[Ne]=!1;var De={};De[we]=De[Sr]=De[Se]=De[je]=De[T]=De[O]=De[it]=De[Te]=De[mt]=De[Rt]=De[jt]=De[ge]=De[Pe]=De[_e]=De[Ze]=De[Ae]=De[ke]=De[Ke]=De[Lt]=De[$t]=De[Ft]=De[Zt]=!0,De[I]=De[J]=De[Ne]=!1;var v={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},E={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},L={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},F={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ze=parseFloat,he=parseInt,Fe=typeof Ks=="object"&&Ks&&Ks.Object===Object&&Ks,xt=typeof self=="object"&&self&&self.Object===Object&&self,Ie=Fe||xt||Function("return this")(),Me=t&&!t.nodeType&&t,pt=Me&&!0&&o&&!o.nodeType&&o,Xt=pt&&pt.exports===Me,Pt=Xt&&Fe.process,Be=function(){try{var x=pt&&pt.require&&pt.require("util").types;return x||Pt&&Pt.binding&&Pt.binding("util")}catch{}}(),Gt=Be&&Be.isArrayBuffer,Rr=Be&&Be.isDate,vr=Be&&Be.isMap,zr=Be&&Be.isRegExp,bs=Be&&Be.isSet,Ci=Be&&Be.isTypedArray;function Nt(x,N,C){switch(C.length){case 0:return x.call(N);case 1:return x.call(N,C[0]);case 2:return x.call(N,C[0],C[1]);case 3:return x.call(N,C[0],C[1],C[2])}return x.apply(N,C)}function Tf(x,N,C,W){for(var ue=-1,Re=x==null?0:x.length;++ue<Re;){var At=x[ue];N(W,At,C(At),x)}return W}function mr(x,N){for(var C=-1,W=x==null?0:x.length;++C<W&&N(x[C],C,x)!==!1;);return x}function $f(x,N){for(var C=x==null?0:x.length;C--&&N(x[C],C,x)!==!1;);return x}function Kc(x,N){for(var C=-1,W=x==null?0:x.length;++C<W;)if(!N(x[C],C,x))return!1;return!0}function ui(x,N){for(var C=-1,W=x==null?0:x.length,ue=0,Re=[];++C<W;){var At=x[C];N(At,C,x)&&(Re[ue++]=At)}return Re}function bn(x,N){var C=x==null?0:x.length;return!!C&&Qi(x,N,0)>-1}function Za(x,N,C){for(var W=-1,ue=x==null?0:x.length;++W<ue;)if(C(N,x[W]))return!0;return!1}function Qe(x,N){for(var C=-1,W=x==null?0:x.length,ue=Array(W);++C<W;)ue[C]=N(x[C],C,x);return ue}function hi(x,N){for(var C=-1,W=N.length,ue=x.length;++C<W;)x[ue+C]=N[C];return x}function Xa(x,N,C,W){var ue=-1,Re=x==null?0:x.length;for(W&&Re&&(C=x[++ue]);++ue<Re;)C=N(C,x[ue],ue,x);return C}function Nf(x,N,C,W){var ue=x==null?0:x.length;for(W&&ue&&(C=x[--ue]);ue--;)C=N(C,x[ue],ue,x);return C}function eo(x,N){for(var C=-1,W=x==null?0:x.length;++C<W;)if(N(x[C],C,x))return!0;return!1}var Df=to("length");function qf(x){return x.split("")}function jf(x){return x.match(Et)||[]}function Vc(x,N,C){var W;return C(x,function(ue,Re,At){if(N(ue,Re,At))return W=Re,!1}),W}function In(x,N,C,W){for(var ue=x.length,Re=C+(W?1:-1);W?Re--:++Re<ue;)if(N(x[Re],Re,x))return Re;return-1}function Qi(x,N,C){return N===N?Wf(x,N,C):In(x,Fc,C)}function Lf(x,N,C,W){for(var ue=C-1,Re=x.length;++ue<Re;)if(W(x[ue],N))return ue;return-1}function Fc(x){return x!==x}function Bc(x,N){var C=x==null?0:x.length;return C?io(x,N)/C:H}function to(x){return function(N){return N==null?i:N[x]}}function ro(x){return function(N){return x==null?i:x[N]}}function Gc(x,N,C,W,ue){return ue(x,function(Re,At,Ue){C=W?(W=!1,Re):N(C,Re,At,Ue)}),C}function zf(x,N){var C=x.length;for(x.sort(N);C--;)x[C]=x[C].value;return x}function io(x,N){for(var C,W=-1,ue=x.length;++W<ue;){var Re=N(x[W]);Re!==i&&(C=C===i?Re:C+Re)}return C}function so(x,N){for(var C=-1,W=Array(x);++C<x;)W[C]=N(C);return W}function Mf(x,N){return Qe(N,function(C){return[C,x[C]]})}function Wc(x){return x&&x.slice(0,Zc(x)+1).replace(ct,"")}function lr(x){return function(N){return x(N)}}function no(x,N){return Qe(N,function(C){return x[C]})}function Is(x,N){return x.has(N)}function Jc(x,N){for(var C=-1,W=x.length;++C<W&&Qi(N,x[C],0)>-1;);return C}function Qc(x,N){for(var C=x.length;C--&&Qi(N,x[C],0)>-1;);return C}function Uf(x,N){for(var C=x.length,W=0;C--;)x[C]===N&&++W;return W}var Hf=ro(v),kf=ro(E);function Kf(x){return"\\"+F[x]}function Vf(x,N){return x==null?i:x[N]}function Yi(x){return wn.test(x)}function Ff(x){return Ai.test(x)}function Bf(x){for(var N,C=[];!(N=x.next()).done;)C.push(N.value);return C}function ao(x){var N=-1,C=Array(x.size);return x.forEach(function(W,ue){C[++N]=[ue,W]}),C}function Yc(x,N){return function(C){return x(N(C))}}function li(x,N){for(var C=-1,W=x.length,ue=0,Re=[];++C<W;){var At=x[C];(At===N||At===_)&&(x[C]=_,Re[ue++]=C)}return Re}function En(x){var N=-1,C=Array(x.size);return x.forEach(function(W){C[++N]=W}),C}function Gf(x){var N=-1,C=Array(x.size);return x.forEach(function(W){C[++N]=[W,W]}),C}function Wf(x,N,C){for(var W=C-1,ue=x.length;++W<ue;)if(x[W]===N)return W;return-1}function Jf(x,N,C){for(var W=C+1;W--;)if(x[W]===N)return W;return W}function Zi(x){return Yi(x)?Yf(x):Df(x)}function Ar(x){return Yi(x)?Zf(x):qf(x)}function Zc(x){for(var N=x.length;N--&&ft.test(x.charAt(N)););return N}var Qf=ro(L);function Yf(x){for(var N=Ji.lastIndex=0;Ji.test(x);)++N;return N}function Zf(x){return x.match(Ji)||[]}function Xf(x){return x.match(mn)||[]}var ep=function x(N){N=N==null?Ie:Xi.defaults(Ie.Object(),N,Xi.pick(Ie,_n));var C=N.Array,W=N.Date,ue=N.Error,Re=N.Function,At=N.Math,Ue=N.Object,oo=N.RegExp,tp=N.String,wr=N.TypeError,xn=C.prototype,rp=Re.prototype,es=Ue.prototype,Pn=N["__core-js_shared__"],Sn=rp.toString,$e=es.hasOwnProperty,ip=0,Xc=function(){var e=/[^.]+$/.exec(Pn&&Pn.keys&&Pn.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),On=es.toString,sp=Sn.call(Ue),np=Ie._,ap=oo("^"+Sn.call($e).replace(ot,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Rn=Xt?N.Buffer:i,fi=N.Symbol,An=N.Uint8Array,eu=Rn?Rn.allocUnsafe:i,Cn=Yc(Ue.getPrototypeOf,Ue),tu=Ue.create,ru=es.propertyIsEnumerable,Tn=xn.splice,iu=fi?fi.isConcatSpreadable:i,Es=fi?fi.iterator:i,Ti=fi?fi.toStringTag:i,$n=function(){try{var e=ji(Ue,"defineProperty");return e({},"",{}),e}catch{}}(),op=N.clearTimeout!==Ie.clearTimeout&&N.clearTimeout,cp=W&&W.now!==Ie.Date.now&&W.now,up=N.setTimeout!==Ie.setTimeout&&N.setTimeout,Nn=At.ceil,Dn=At.floor,co=Ue.getOwnPropertySymbols,hp=Rn?Rn.isBuffer:i,su=N.isFinite,lp=xn.join,fp=Yc(Ue.keys,Ue),Ct=At.max,Ut=At.min,pp=W.now,dp=N.parseInt,nu=At.random,gp=xn.reverse,uo=ji(N,"DataView"),xs=ji(N,"Map"),ho=ji(N,"Promise"),ts=ji(N,"Set"),Ps=ji(N,"WeakMap"),Ss=ji(Ue,"create"),qn=Ps&&new Ps,rs={},yp=Li(uo),vp=Li(xs),mp=Li(ho),wp=Li(ts),_p=Li(Ps),jn=fi?fi.prototype:i,Os=jn?jn.valueOf:i,au=jn?jn.toString:i;function p(e){if(ht(e)&&!le(e)&&!(e instanceof be)){if(e instanceof _r)return e;if($e.call(e,"__wrapped__"))return oh(e)}return new _r(e)}var is=function(){function e(){}return function(r){if(!tt(r))return{};if(tu)return tu(r);e.prototype=r;var n=new e;return e.prototype=i,n}}();function Ln(){}function _r(e,r){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!r,this.__index__=0,this.__values__=i}p.templateSettings={escape:nt,evaluate:at,interpolate:et,variable:"",imports:{_:p}},p.prototype=Ln.prototype,p.prototype.constructor=p,_r.prototype=is(Ln.prototype),_r.prototype.constructor=_r;function be(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=V,this.__views__=[]}function bp(){var e=new be(this.__wrapped__);return e.__actions__=er(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=er(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=er(this.__views__),e}function Ip(){if(this.__filtered__){var e=new be(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Ep(){var e=this.__wrapped__.value(),r=this.__dir__,n=le(e),c=r<0,l=n?e.length:0,g=qd(0,l,this.__views__),w=g.start,b=g.end,P=b-w,q=c?b:w-1,j=this.__iteratees__,z=j.length,k=0,Z=Ut(P,this.__takeCount__);if(!n||!c&&l==P&&Z==P)return Cu(e,this.__actions__);var ie=[];e:for(;P--&&k<Z;){q+=r;for(var ye=-1,se=e[q];++ye<z;){var me=j[ye],Ee=me.iteratee,dr=me.type,Qt=Ee(se);if(dr==U)se=Qt;else if(!Qt){if(dr==M)continue e;break e}}ie[k++]=se}return ie}be.prototype=is(Ln.prototype),be.prototype.constructor=be;function $i(e){var r=-1,n=e==null?0:e.length;for(this.clear();++r<n;){var c=e[r];this.set(c[0],c[1])}}function xp(){this.__data__=Ss?Ss(null):{},this.size=0}function Pp(e){var r=this.has(e)&&delete this.__data__[e];return this.size-=r?1:0,r}function Sp(e){var r=this.__data__;if(Ss){var n=r[e];return n===m?i:n}return $e.call(r,e)?r[e]:i}function Op(e){var r=this.__data__;return Ss?r[e]!==i:$e.call(r,e)}function Rp(e,r){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Ss&&r===i?m:r,this}$i.prototype.clear=xp,$i.prototype.delete=Pp,$i.prototype.get=Sp,$i.prototype.has=Op,$i.prototype.set=Rp;function Wr(e){var r=-1,n=e==null?0:e.length;for(this.clear();++r<n;){var c=e[r];this.set(c[0],c[1])}}function Ap(){this.__data__=[],this.size=0}function Cp(e){var r=this.__data__,n=zn(r,e);if(n<0)return!1;var c=r.length-1;return n==c?r.pop():Tn.call(r,n,1),--this.size,!0}function Tp(e){var r=this.__data__,n=zn(r,e);return n<0?i:r[n][1]}function $p(e){return zn(this.__data__,e)>-1}function Np(e,r){var n=this.__data__,c=zn(n,e);return c<0?(++this.size,n.push([e,r])):n[c][1]=r,this}Wr.prototype.clear=Ap,Wr.prototype.delete=Cp,Wr.prototype.get=Tp,Wr.prototype.has=$p,Wr.prototype.set=Np;function Jr(e){var r=-1,n=e==null?0:e.length;for(this.clear();++r<n;){var c=e[r];this.set(c[0],c[1])}}function Dp(){this.size=0,this.__data__={hash:new $i,map:new(xs||Wr),string:new $i}}function qp(e){var r=Qn(this,e).delete(e);return this.size-=r?1:0,r}function jp(e){return Qn(this,e).get(e)}function Lp(e){return Qn(this,e).has(e)}function zp(e,r){var n=Qn(this,e),c=n.size;return n.set(e,r),this.size+=n.size==c?0:1,this}Jr.prototype.clear=Dp,Jr.prototype.delete=qp,Jr.prototype.get=jp,Jr.prototype.has=Lp,Jr.prototype.set=zp;function Ni(e){var r=-1,n=e==null?0:e.length;for(this.__data__=new Jr;++r<n;)this.add(e[r])}function Mp(e){return this.__data__.set(e,m),this}function Up(e){return this.__data__.has(e)}Ni.prototype.add=Ni.prototype.push=Mp,Ni.prototype.has=Up;function Cr(e){var r=this.__data__=new Wr(e);this.size=r.size}function Hp(){this.__data__=new Wr,this.size=0}function kp(e){var r=this.__data__,n=r.delete(e);return this.size=r.size,n}function Kp(e){return this.__data__.get(e)}function Vp(e){return this.__data__.has(e)}function Fp(e,r){var n=this.__data__;if(n instanceof Wr){var c=n.__data__;if(!xs||c.length<a-1)return c.push([e,r]),this.size=++n.size,this;n=this.__data__=new Jr(c)}return n.set(e,r),this.size=n.size,this}Cr.prototype.clear=Hp,Cr.prototype.delete=kp,Cr.prototype.get=Kp,Cr.prototype.has=Vp,Cr.prototype.set=Fp;function ou(e,r){var n=le(e),c=!n&&zi(e),l=!n&&!c&&vi(e),g=!n&&!c&&!l&&os(e),w=n||c||l||g,b=w?so(e.length,tp):[],P=b.length;for(var q in e)(r||$e.call(e,q))&&!(w&&(q=="length"||l&&(q=="offset"||q=="parent")||g&&(q=="buffer"||q=="byteLength"||q=="byteOffset")||Xr(q,P)))&&b.push(q);return b}function cu(e){var r=e.length;return r?e[Io(0,r-1)]:i}function Bp(e,r){return Yn(er(e),Di(r,0,e.length))}function Gp(e){return Yn(er(e))}function lo(e,r,n){(n!==i&&!Tr(e[r],n)||n===i&&!(r in e))&&Qr(e,r,n)}function Rs(e,r,n){var c=e[r];(!($e.call(e,r)&&Tr(c,n))||n===i&&!(r in e))&&Qr(e,r,n)}function zn(e,r){for(var n=e.length;n--;)if(Tr(e[n][0],r))return n;return-1}function Wp(e,r,n,c){return pi(e,function(l,g,w){r(c,l,n(l),w)}),c}function uu(e,r){return e&&Ur(r,Dt(r),e)}function Jp(e,r){return e&&Ur(r,rr(r),e)}function Qr(e,r,n){r=="__proto__"&&$n?$n(e,r,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[r]=n}function fo(e,r){for(var n=-1,c=r.length,l=C(c),g=e==null;++n<c;)l[n]=g?i:Go(e,r[n]);return l}function Di(e,r,n){return e===e&&(n!==i&&(e=e<=n?e:n),r!==i&&(e=e>=r?e:r)),e}function br(e,r,n,c,l,g){var w,b=r&S,P=r&R,q=r&D;if(n&&(w=l?n(e,c,l,g):n(e)),w!==i)return w;if(!tt(e))return e;var j=le(e);if(j){if(w=Ld(e),!b)return er(e,w)}else{var z=Ht(e),k=z==J||z==ae;if(vi(e))return Nu(e,b);if(z==_e||z==we||k&&!l){if(w=P||k?{}:Zu(e),!b)return P?Sd(e,Jp(w,e)):Pd(e,uu(w,e))}else{if(!De[z])return l?e:{};w=zd(e,z,b)}}g||(g=new Cr);var Z=g.get(e);if(Z)return Z;g.set(e,w),Oh(e)?e.forEach(function(se){w.add(br(se,r,n,se,e,g))}):Ph(e)&&e.forEach(function(se,me){w.set(me,br(se,r,n,me,e,g))});var ie=q?P?No:$o:P?rr:Dt,ye=j?i:ie(e);return mr(ye||e,function(se,me){ye&&(me=se,se=e[me]),Rs(w,me,br(se,r,n,me,e,g))}),w}function Qp(e){var r=Dt(e);return function(n){return hu(n,e,r)}}function hu(e,r,n){var c=n.length;if(e==null)return!c;for(e=Ue(e);c--;){var l=n[c],g=r[l],w=e[l];if(w===i&&!(l in e)||!g(w))return!1}return!0}function lu(e,r,n){if(typeof e!="function")throw new wr(f);return qs(function(){e.apply(i,n)},r)}function As(e,r,n,c){var l=-1,g=bn,w=!0,b=e.length,P=[],q=r.length;if(!b)return P;n&&(r=Qe(r,lr(n))),c?(g=Za,w=!1):r.length>=a&&(g=Is,w=!1,r=new Ni(r));e:for(;++l<b;){var j=e[l],z=n==null?j:n(j);if(j=c||j!==0?j:0,w&&z===z){for(var k=q;k--;)if(r[k]===z)continue e;P.push(j)}else g(r,z,c)||P.push(j)}return P}var pi=zu(Mr),fu=zu(go,!0);function Yp(e,r){var n=!0;return pi(e,function(c,l,g){return n=!!r(c,l,g),n}),n}function Mn(e,r,n){for(var c=-1,l=e.length;++c<l;){var g=e[c],w=r(g);if(w!=null&&(b===i?w===w&&!pr(w):n(w,b)))var b=w,P=g}return P}function Zp(e,r,n,c){var l=e.length;for(n=de(n),n<0&&(n=-n>l?0:l+n),c=c===i||c>l?l:de(c),c<0&&(c+=l),c=n>c?0:Ah(c);n<c;)e[n++]=r;return e}function pu(e,r){var n=[];return pi(e,function(c,l,g){r(c,l,g)&&n.push(c)}),n}function zt(e,r,n,c,l){var g=-1,w=e.length;for(n||(n=Ud),l||(l=[]);++g<w;){var b=e[g];r>0&&n(b)?r>1?zt(b,r-1,n,c,l):hi(l,b):c||(l[l.length]=b)}return l}var po=Mu(),du=Mu(!0);function Mr(e,r){return e&&po(e,r,Dt)}function go(e,r){return e&&du(e,r,Dt)}function Un(e,r){return ui(r,function(n){return ei(e[n])})}function qi(e,r){r=gi(r,e);for(var n=0,c=r.length;e!=null&&n<c;)e=e[Hr(r[n++])];return n&&n==c?e:i}function gu(e,r,n){var c=r(e);return le(e)?c:hi(c,n(e))}function Wt(e){return e==null?e===i?Xe:Oe:Ti&&Ti in Ue(e)?Dd(e):Gd(e)}function yo(e,r){return e>r}function Xp(e,r){return e!=null&&$e.call(e,r)}function ed(e,r){return e!=null&&r in Ue(e)}function td(e,r,n){return e>=Ut(r,n)&&e<Ct(r,n)}function vo(e,r,n){for(var c=n?Za:bn,l=e[0].length,g=e.length,w=g,b=C(g),P=1/0,q=[];w--;){var j=e[w];w&&r&&(j=Qe(j,lr(r))),P=Ut(j.length,P),b[w]=!n&&(r||l>=120&&j.length>=120)?new Ni(w&&j):i}j=e[0];var z=-1,k=b[0];e:for(;++z<l&&q.length<P;){var Z=j[z],ie=r?r(Z):Z;if(Z=n||Z!==0?Z:0,!(k?Is(k,ie):c(q,ie,n))){for(w=g;--w;){var ye=b[w];if(!(ye?Is(ye,ie):c(e[w],ie,n)))continue e}k&&k.push(ie),q.push(Z)}}return q}function rd(e,r,n,c){return Mr(e,function(l,g,w){r(c,n(l),g,w)}),c}function Cs(e,r,n){r=gi(r,e),e=rh(e,r);var c=e==null?e:e[Hr(Er(r))];return c==null?i:Nt(c,e,n)}function yu(e){return ht(e)&&Wt(e)==we}function id(e){return ht(e)&&Wt(e)==Se}function sd(e){return ht(e)&&Wt(e)==O}function Ts(e,r,n,c,l){return e===r?!0:e==null||r==null||!ht(e)&&!ht(r)?e!==e&&r!==r:nd(e,r,n,c,Ts,l)}function nd(e,r,n,c,l,g){var w=le(e),b=le(r),P=w?Sr:Ht(e),q=b?Sr:Ht(r);P=P==we?_e:P,q=q==we?_e:q;var j=P==_e,z=q==_e,k=P==q;if(k&&vi(e)){if(!vi(r))return!1;w=!0,j=!1}if(k&&!j)return g||(g=new Cr),w||os(e)?Ju(e,r,n,c,l,g):$d(e,r,P,n,c,l,g);if(!(n&A)){var Z=j&&$e.call(e,"__wrapped__"),ie=z&&$e.call(r,"__wrapped__");if(Z||ie){var ye=Z?e.value():e,se=ie?r.value():r;return g||(g=new Cr),l(ye,se,n,c,g)}}return k?(g||(g=new Cr),Nd(e,r,n,c,l,g)):!1}function ad(e){return ht(e)&&Ht(e)==ge}function mo(e,r,n,c){var l=n.length,g=l,w=!c;if(e==null)return!g;for(e=Ue(e);l--;){var b=n[l];if(w&&b[2]?b[1]!==e[b[0]]:!(b[0]in e))return!1}for(;++l<g;){b=n[l];var P=b[0],q=e[P],j=b[1];if(w&&b[2]){if(q===i&&!(P in e))return!1}else{var z=new Cr;if(c)var k=c(q,j,P,e,r,z);if(!(k===i?Ts(j,q,A|Q,c,z):k))return!1}}return!0}function vu(e){if(!tt(e)||kd(e))return!1;var r=ei(e)?ap:ja;return r.test(Li(e))}function od(e){return ht(e)&&Wt(e)==Ze}function cd(e){return ht(e)&&Ht(e)==Ae}function ud(e){return ht(e)&&ia(e.length)&&!!Le[Wt(e)]}function mu(e){return typeof e=="function"?e:e==null?ir:typeof e=="object"?le(e)?bu(e[0],e[1]):_u(e):Uh(e)}function wo(e){if(!Ds(e))return fp(e);var r=[];for(var n in Ue(e))$e.call(e,n)&&n!="constructor"&&r.push(n);return r}function hd(e){if(!tt(e))return Bd(e);var r=Ds(e),n=[];for(var c in e)c=="constructor"&&(r||!$e.call(e,c))||n.push(c);return n}function _o(e,r){return e<r}function wu(e,r){var n=-1,c=tr(e)?C(e.length):[];return pi(e,function(l,g,w){c[++n]=r(l,g,w)}),c}function _u(e){var r=qo(e);return r.length==1&&r[0][2]?eh(r[0][0],r[0][1]):function(n){return n===e||mo(n,e,r)}}function bu(e,r){return Lo(e)&&Xu(r)?eh(Hr(e),r):function(n){var c=Go(n,e);return c===i&&c===r?Wo(n,e):Ts(r,c,A|Q)}}function Hn(e,r,n,c,l){e!==r&&po(r,function(g,w){if(l||(l=new Cr),tt(g))ld(e,r,w,n,Hn,c,l);else{var b=c?c(Mo(e,w),g,w+"",e,r,l):i;b===i&&(b=g),lo(e,w,b)}},rr)}function ld(e,r,n,c,l,g,w){var b=Mo(e,n),P=Mo(r,n),q=w.get(P);if(q){lo(e,n,q);return}var j=g?g(b,P,n+"",e,r,w):i,z=j===i;if(z){var k=le(P),Z=!k&&vi(P),ie=!k&&!Z&&os(P);j=P,k||Z||ie?le(b)?j=b:dt(b)?j=er(b):Z?(z=!1,j=Nu(P,!0)):ie?(z=!1,j=Du(P,!0)):j=[]:js(P)||zi(P)?(j=b,zi(b)?j=Ch(b):(!tt(b)||ei(b))&&(j=Zu(P))):z=!1}z&&(w.set(P,j),l(j,P,c,g,w),w.delete(P)),lo(e,n,j)}function Iu(e,r){var n=e.length;if(n)return r+=r<0?n:0,Xr(r,n)?e[r]:i}function Eu(e,r,n){r.length?r=Qe(r,function(g){return le(g)?function(w){return qi(w,g.length===1?g[0]:g)}:g}):r=[ir];var c=-1;r=Qe(r,lr(ee()));var l=wu(e,function(g,w,b){var P=Qe(r,function(q){return q(g)});return{criteria:P,index:++c,value:g}});return zf(l,function(g,w){return xd(g,w,n)})}function fd(e,r){return xu(e,r,function(n,c){return Wo(e,c)})}function xu(e,r,n){for(var c=-1,l=r.length,g={};++c<l;){var w=r[c],b=qi(e,w);n(b,w)&&$s(g,gi(w,e),b)}return g}function pd(e){return function(r){return qi(r,e)}}function bo(e,r,n,c){var l=c?Lf:Qi,g=-1,w=r.length,b=e;for(e===r&&(r=er(r)),n&&(b=Qe(e,lr(n)));++g<w;)for(var P=0,q=r[g],j=n?n(q):q;(P=l(b,j,P,c))>-1;)b!==e&&Tn.call(b,P,1),Tn.call(e,P,1);return e}function Pu(e,r){for(var n=e?r.length:0,c=n-1;n--;){var l=r[n];if(n==c||l!==g){var g=l;Xr(l)?Tn.call(e,l,1):Po(e,l)}}return e}function Io(e,r){return e+Dn(nu()*(r-e+1))}function dd(e,r,n,c){for(var l=-1,g=Ct(Nn((r-e)/(n||1)),0),w=C(g);g--;)w[c?g:++l]=e,e+=n;return w}function Eo(e,r){var n="";if(!e||r<1||r>G)return n;do r%2&&(n+=e),r=Dn(r/2),r&&(e+=e);while(r);return n}function ve(e,r){return Uo(th(e,r,ir),e+"")}function gd(e){return cu(cs(e))}function yd(e,r){var n=cs(e);return Yn(n,Di(r,0,n.length))}function $s(e,r,n,c){if(!tt(e))return e;r=gi(r,e);for(var l=-1,g=r.length,w=g-1,b=e;b!=null&&++l<g;){var P=Hr(r[l]),q=n;if(P==="__proto__"||P==="constructor"||P==="prototype")return e;if(l!=w){var j=b[P];q=c?c(j,P,b):i,q===i&&(q=tt(j)?j:Xr(r[l+1])?[]:{})}Rs(b,P,q),b=b[P]}return e}var Su=qn?function(e,r){return qn.set(e,r),e}:ir,vd=$n?function(e,r){return $n(e,"toString",{configurable:!0,enumerable:!1,value:Qo(r),writable:!0})}:ir;function md(e){return Yn(cs(e))}function Ir(e,r,n){var c=-1,l=e.length;r<0&&(r=-r>l?0:l+r),n=n>l?l:n,n<0&&(n+=l),l=r>n?0:n-r>>>0,r>>>=0;for(var g=C(l);++c<l;)g[c]=e[c+r];return g}function wd(e,r){var n;return pi(e,function(c,l,g){return n=r(c,l,g),!n}),!!n}function kn(e,r,n){var c=0,l=e==null?c:e.length;if(typeof r=="number"&&r===r&&l<=rt){for(;c<l;){var g=c+l>>>1,w=e[g];w!==null&&!pr(w)&&(n?w<=r:w<r)?c=g+1:l=g}return l}return xo(e,r,ir,n)}function xo(e,r,n,c){var l=0,g=e==null?0:e.length;if(g===0)return 0;r=n(r);for(var w=r!==r,b=r===null,P=pr(r),q=r===i;l<g;){var j=Dn((l+g)/2),z=n(e[j]),k=z!==i,Z=z===null,ie=z===z,ye=pr(z);if(w)var se=c||ie;else q?se=ie&&(c||k):b?se=ie&&k&&(c||!Z):P?se=ie&&k&&!Z&&(c||!ye):Z||ye?se=!1:se=c?z<=r:z<r;se?l=j+1:g=j}return Ut(g,Ot)}function Ou(e,r){for(var n=-1,c=e.length,l=0,g=[];++n<c;){var w=e[n],b=r?r(w):w;if(!n||!Tr(b,P)){var P=b;g[l++]=w===0?0:w}}return g}function Ru(e){return typeof e=="number"?e:pr(e)?H:+e}function fr(e){if(typeof e=="string")return e;if(le(e))return Qe(e,fr)+"";if(pr(e))return au?au.call(e):"";var r=e+"";return r=="0"&&1/e==-qe?"-0":r}function di(e,r,n){var c=-1,l=bn,g=e.length,w=!0,b=[],P=b;if(n)w=!1,l=Za;else if(g>=a){var q=r?null:Cd(e);if(q)return En(q);w=!1,l=Is,P=new Ni}else P=r?[]:b;e:for(;++c<g;){var j=e[c],z=r?r(j):j;if(j=n||j!==0?j:0,w&&z===z){for(var k=P.length;k--;)if(P[k]===z)continue e;r&&P.push(z),b.push(j)}else l(P,z,n)||(P!==b&&P.push(z),b.push(j))}return b}function Po(e,r){return r=gi(r,e),e=rh(e,r),e==null||delete e[Hr(Er(r))]}function Au(e,r,n,c){return $s(e,r,n(qi(e,r)),c)}function Kn(e,r,n,c){for(var l=e.length,g=c?l:-1;(c?g--:++g<l)&&r(e[g],g,e););return n?Ir(e,c?0:g,c?g+1:l):Ir(e,c?g+1:0,c?l:g)}function Cu(e,r){var n=e;return n instanceof be&&(n=n.value()),Xa(r,function(c,l){return l.func.apply(l.thisArg,hi([c],l.args))},n)}function So(e,r,n){var c=e.length;if(c<2)return c?di(e[0]):[];for(var l=-1,g=C(c);++l<c;)for(var w=e[l],b=-1;++b<c;)b!=l&&(g[l]=As(g[l]||w,e[b],r,n));return di(zt(g,1),r,n)}function Tu(e,r,n){for(var c=-1,l=e.length,g=r.length,w={};++c<l;){var b=c<g?r[c]:i;n(w,e[c],b)}return w}function Oo(e){return dt(e)?e:[]}function Ro(e){return typeof e=="function"?e:ir}function gi(e,r){return le(e)?e:Lo(e,r)?[e]:ah(Ce(e))}var _d=ve;function yi(e,r,n){var c=e.length;return n=n===i?c:n,!r&&n>=c?e:Ir(e,r,n)}var $u=op||function(e){return Ie.clearTimeout(e)};function Nu(e,r){if(r)return e.slice();var n=e.length,c=eu?eu(n):new e.constructor(n);return e.copy(c),c}function Ao(e){var r=new e.constructor(e.byteLength);return new An(r).set(new An(e)),r}function bd(e,r){var n=r?Ao(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function Id(e){var r=new e.constructor(e.source,yr.exec(e));return r.lastIndex=e.lastIndex,r}function Ed(e){return Os?Ue(Os.call(e)):{}}function Du(e,r){var n=r?Ao(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function qu(e,r){if(e!==r){var n=e!==i,c=e===null,l=e===e,g=pr(e),w=r!==i,b=r===null,P=r===r,q=pr(r);if(!b&&!q&&!g&&e>r||g&&w&&P&&!b&&!q||c&&w&&P||!n&&P||!l)return 1;if(!c&&!g&&!q&&e<r||q&&n&&l&&!c&&!g||b&&n&&l||!w&&l||!P)return-1}return 0}function xd(e,r,n){for(var c=-1,l=e.criteria,g=r.criteria,w=l.length,b=n.length;++c<w;){var P=qu(l[c],g[c]);if(P){if(c>=b)return P;var q=n[c];return P*(q=="desc"?-1:1)}}return e.index-r.index}function ju(e,r,n,c){for(var l=-1,g=e.length,w=n.length,b=-1,P=r.length,q=Ct(g-w,0),j=C(P+q),z=!c;++b<P;)j[b]=r[b];for(;++l<w;)(z||l<g)&&(j[n[l]]=e[l]);for(;q--;)j[b++]=e[l++];return j}function Lu(e,r,n,c){for(var l=-1,g=e.length,w=-1,b=n.length,P=-1,q=r.length,j=Ct(g-b,0),z=C(j+q),k=!c;++l<j;)z[l]=e[l];for(var Z=l;++P<q;)z[Z+P]=r[P];for(;++w<b;)(k||l<g)&&(z[Z+n[w]]=e[l++]);return z}function er(e,r){var n=-1,c=e.length;for(r||(r=C(c));++n<c;)r[n]=e[n];return r}function Ur(e,r,n,c){var l=!n;n||(n={});for(var g=-1,w=r.length;++g<w;){var b=r[g],P=c?c(n[b],e[b],b,n,e):i;P===i&&(P=e[b]),l?Qr(n,b,P):Rs(n,b,P)}return n}function Pd(e,r){return Ur(e,jo(e),r)}function Sd(e,r){return Ur(e,Qu(e),r)}function Vn(e,r){return function(n,c){var l=le(n)?Tf:Wp,g=r?r():{};return l(n,e,ee(c,2),g)}}function ss(e){return ve(function(r,n){var c=-1,l=n.length,g=l>1?n[l-1]:i,w=l>2?n[2]:i;for(g=e.length>3&&typeof g=="function"?(l--,g):i,w&&Jt(n[0],n[1],w)&&(g=l<3?i:g,l=1),r=Ue(r);++c<l;){var b=n[c];b&&e(r,b,c,g)}return r})}function zu(e,r){return function(n,c){if(n==null)return n;if(!tr(n))return e(n,c);for(var l=n.length,g=r?l:-1,w=Ue(n);(r?g--:++g<l)&&c(w[g],g,w)!==!1;);return n}}function Mu(e){return function(r,n,c){for(var l=-1,g=Ue(r),w=c(r),b=w.length;b--;){var P=w[e?b:++l];if(n(g[P],P,g)===!1)break}return r}}function Od(e,r,n){var c=r&te,l=Ns(e);function g(){var w=this&&this!==Ie&&this instanceof g?l:e;return w.apply(c?n:this,arguments)}return g}function Uu(e){return function(r){r=Ce(r);var n=Yi(r)?Ar(r):i,c=n?n[0]:r.charAt(0),l=n?yi(n,1).join(""):r.slice(1);return c[e]()+l}}function ns(e){return function(r){return Xa(zh(Lh(r).replace(_s,"")),e,"")}}function Ns(e){return function(){var r=arguments;switch(r.length){case 0:return new e;case 1:return new e(r[0]);case 2:return new e(r[0],r[1]);case 3:return new e(r[0],r[1],r[2]);case 4:return new e(r[0],r[1],r[2],r[3]);case 5:return new e(r[0],r[1],r[2],r[3],r[4]);case 6:return new e(r[0],r[1],r[2],r[3],r[4],r[5]);case 7:return new e(r[0],r[1],r[2],r[3],r[4],r[5],r[6])}var n=is(e.prototype),c=e.apply(n,r);return tt(c)?c:n}}function Rd(e,r,n){var c=Ns(e);function l(){for(var g=arguments.length,w=C(g),b=g,P=as(l);b--;)w[b]=arguments[b];var q=g<3&&w[0]!==P&&w[g-1]!==P?[]:li(w,P);if(g-=q.length,g<n)return Fu(e,r,Fn,l.placeholder,i,w,q,i,i,n-g);var j=this&&this!==Ie&&this instanceof l?c:e;return Nt(j,this,w)}return l}function Hu(e){return function(r,n,c){var l=Ue(r);if(!tr(r)){var g=ee(n,3);r=Dt(r),n=function(b){return g(l[b],b,l)}}var w=e(r,n,c);return w>-1?l[g?r[w]:w]:i}}function ku(e){return Zr(function(r){var n=r.length,c=n,l=_r.prototype.thru;for(e&&r.reverse();c--;){var g=r[c];if(typeof g!="function")throw new wr(f);if(l&&!w&&Jn(g)=="wrapper")var w=new _r([],!0)}for(c=w?c:n;++c<n;){g=r[c];var b=Jn(g),P=b=="wrapper"?Do(g):i;P&&zo(P[0])&&P[1]==(Y|ne|fe|xe)&&!P[4].length&&P[9]==1?w=w[Jn(P[0])].apply(w,P[3]):w=g.length==1&&zo(g)?w[b]():w.thru(g)}return function(){var q=arguments,j=q[0];if(w&&q.length==1&&le(j))return w.plant(j).value();for(var z=0,k=n?r[z].apply(this,q):j;++z<n;)k=r[z].call(this,k);return k}})}function Fn(e,r,n,c,l,g,w,b,P,q){var j=r&Y,z=r&te,k=r&ce,Z=r&(ne|re),ie=r&Tt,ye=k?i:Ns(e);function se(){for(var me=arguments.length,Ee=C(me),dr=me;dr--;)Ee[dr]=arguments[dr];if(Z)var Qt=as(se),gr=Uf(Ee,Qt);if(c&&(Ee=ju(Ee,c,l,Z)),g&&(Ee=Lu(Ee,g,w,Z)),me-=gr,Z&&me<q){var gt=li(Ee,Qt);return Fu(e,r,Fn,se.placeholder,n,Ee,gt,b,P,q-me)}var $r=z?n:this,ri=k?$r[e]:e;return me=Ee.length,b?Ee=Wd(Ee,b):ie&&me>1&&Ee.reverse(),j&&P<me&&(Ee.length=P),this&&this!==Ie&&this instanceof se&&(ri=ye||Ns(ri)),ri.apply($r,Ee)}return se}function Ku(e,r){return function(n,c){return rd(n,e,r(c),{})}}function Bn(e,r){return function(n,c){var l;if(n===i&&c===i)return r;if(n!==i&&(l=n),c!==i){if(l===i)return c;typeof n=="string"||typeof c=="string"?(n=fr(n),c=fr(c)):(n=Ru(n),c=Ru(c)),l=e(n,c)}return l}}function Co(e){return Zr(function(r){return r=Qe(r,lr(ee())),ve(function(n){var c=this;return e(r,function(l){return Nt(l,c,n)})})})}function Gn(e,r){r=r===i?" ":fr(r);var n=r.length;if(n<2)return n?Eo(r,e):r;var c=Eo(r,Nn(e/Zi(r)));return Yi(r)?yi(Ar(c),0,e).join(""):c.slice(0,e)}function Ad(e,r,n,c){var l=r&te,g=Ns(e);function w(){for(var b=-1,P=arguments.length,q=-1,j=c.length,z=C(j+P),k=this&&this!==Ie&&this instanceof w?g:e;++q<j;)z[q]=c[q];for(;P--;)z[q++]=arguments[++b];return Nt(k,l?n:this,z)}return w}function Vu(e){return function(r,n,c){return c&&typeof c!="number"&&Jt(r,n,c)&&(n=c=i),r=ti(r),n===i?(n=r,r=0):n=ti(n),c=c===i?r<n?1:-1:ti(c),dd(r,n,c,e)}}function Wn(e){return function(r,n){return typeof r=="string"&&typeof n=="string"||(r=xr(r),n=xr(n)),e(r,n)}}function Fu(e,r,n,c,l,g,w,b,P,q){var j=r&ne,z=j?w:i,k=j?i:w,Z=j?g:i,ie=j?i:g;r|=j?fe:pe,r&=~(j?pe:fe),r&oe||(r&=~(te|ce));var ye=[e,r,l,Z,z,ie,k,b,P,q],se=n.apply(i,ye);return zo(e)&&ih(se,ye),se.placeholder=c,sh(se,e,r)}function To(e){var r=At[e];return function(n,c){if(n=xr(n),c=c==null?0:Ut(de(c),292),c&&su(n)){var l=(Ce(n)+"e").split("e"),g=r(l[0]+"e"+(+l[1]+c));return l=(Ce(g)+"e").split("e"),+(l[0]+"e"+(+l[1]-c))}return r(n)}}var Cd=ts&&1/En(new ts([,-0]))[1]==qe?function(e){return new ts(e)}:Xo;function Bu(e){return function(r){var n=Ht(r);return n==ge?ao(r):n==Ae?Gf(r):Mf(r,e(r))}}function Yr(e,r,n,c,l,g,w,b){var P=r&ce;if(!P&&typeof e!="function")throw new wr(f);var q=c?c.length:0;if(q||(r&=~(fe|pe),c=l=i),w=w===i?w:Ct(de(w),0),b=b===i?b:de(b),q-=l?l.length:0,r&pe){var j=c,z=l;c=l=i}var k=P?i:Do(e),Z=[e,r,n,c,l,j,z,g,w,b];if(k&&Fd(Z,k),e=Z[0],r=Z[1],n=Z[2],c=Z[3],l=Z[4],b=Z[9]=Z[9]===i?P?0:e.length:Ct(Z[9]-q,0),!b&&r&(ne|re)&&(r&=~(ne|re)),!r||r==te)var ie=Od(e,r,n);else r==ne||r==re?ie=Rd(e,r,b):(r==fe||r==(te|fe))&&!l.length?ie=Ad(e,r,n,c):ie=Fn.apply(i,Z);var ye=k?Su:ih;return sh(ye(ie,Z),e,r)}function Gu(e,r,n,c){return e===i||Tr(e,es[n])&&!$e.call(c,n)?r:e}function Wu(e,r,n,c,l,g){return tt(e)&&tt(r)&&(g.set(r,e),Hn(e,r,i,Wu,g),g.delete(r)),e}function Td(e){return js(e)?i:e}function Ju(e,r,n,c,l,g){var w=n&A,b=e.length,P=r.length;if(b!=P&&!(w&&P>b))return!1;var q=g.get(e),j=g.get(r);if(q&&j)return q==r&&j==e;var z=-1,k=!0,Z=n&Q?new Ni:i;for(g.set(e,r),g.set(r,e);++z<b;){var ie=e[z],ye=r[z];if(c)var se=w?c(ye,ie,z,r,e,g):c(ie,ye,z,e,r,g);if(se!==i){if(se)continue;k=!1;break}if(Z){if(!eo(r,function(me,Ee){if(!Is(Z,Ee)&&(ie===me||l(ie,me,n,c,g)))return Z.push(Ee)})){k=!1;break}}else if(!(ie===ye||l(ie,ye,n,c,g))){k=!1;break}}return g.delete(e),g.delete(r),k}function $d(e,r,n,c,l,g,w){switch(n){case je:if(e.byteLength!=r.byteLength||e.byteOffset!=r.byteOffset)return!1;e=e.buffer,r=r.buffer;case Se:return!(e.byteLength!=r.byteLength||!g(new An(e),new An(r)));case T:case O:case Pe:return Tr(+e,+r);case I:return e.name==r.name&&e.message==r.message;case Ze:case ke:return e==r+"";case ge:var b=ao;case Ae:var P=c&A;if(b||(b=En),e.size!=r.size&&!P)return!1;var q=w.get(e);if(q)return q==r;c|=Q,w.set(e,r);var j=Ju(b(e),b(r),c,l,g,w);return w.delete(e),j;case Ke:if(Os)return Os.call(e)==Os.call(r)}return!1}function Nd(e,r,n,c,l,g){var w=n&A,b=$o(e),P=b.length,q=$o(r),j=q.length;if(P!=j&&!w)return!1;for(var z=P;z--;){var k=b[z];if(!(w?k in r:$e.call(r,k)))return!1}var Z=g.get(e),ie=g.get(r);if(Z&&ie)return Z==r&&ie==e;var ye=!0;g.set(e,r),g.set(r,e);for(var se=w;++z<P;){k=b[z];var me=e[k],Ee=r[k];if(c)var dr=w?c(Ee,me,k,r,e,g):c(me,Ee,k,e,r,g);if(!(dr===i?me===Ee||l(me,Ee,n,c,g):dr)){ye=!1;break}se||(se=k=="constructor")}if(ye&&!se){var Qt=e.constructor,gr=r.constructor;Qt!=gr&&"constructor"in e&&"constructor"in r&&!(typeof Qt=="function"&&Qt instanceof Qt&&typeof gr=="function"&&gr instanceof gr)&&(ye=!1)}return g.delete(e),g.delete(r),ye}function Zr(e){return Uo(th(e,i,hh),e+"")}function $o(e){return gu(e,Dt,jo)}function No(e){return gu(e,rr,Qu)}var Do=qn?function(e){return qn.get(e)}:Xo;function Jn(e){for(var r=e.name+"",n=rs[r],c=$e.call(rs,r)?n.length:0;c--;){var l=n[c],g=l.func;if(g==null||g==e)return l.name}return r}function as(e){var r=$e.call(p,"placeholder")?p:e;return r.placeholder}function ee(){var e=p.iteratee||Yo;return e=e===Yo?mu:e,arguments.length?e(arguments[0],arguments[1]):e}function Qn(e,r){var n=e.__data__;return Hd(r)?n[typeof r=="string"?"string":"hash"]:n.map}function qo(e){for(var r=Dt(e),n=r.length;n--;){var c=r[n],l=e[c];r[n]=[c,l,Xu(l)]}return r}function ji(e,r){var n=Vf(e,r);return vu(n)?n:i}function Dd(e){var r=$e.call(e,Ti),n=e[Ti];try{e[Ti]=i;var c=!0}catch{}var l=On.call(e);return c&&(r?e[Ti]=n:delete e[Ti]),l}var jo=co?function(e){return e==null?[]:(e=Ue(e),ui(co(e),function(r){return ru.call(e,r)}))}:ec,Qu=co?function(e){for(var r=[];e;)hi(r,jo(e)),e=Cn(e);return r}:ec,Ht=Wt;(uo&&Ht(new uo(new ArrayBuffer(1)))!=je||xs&&Ht(new xs)!=ge||ho&&Ht(ho.resolve())!=vt||ts&&Ht(new ts)!=Ae||Ps&&Ht(new Ps)!=Ne)&&(Ht=function(e){var r=Wt(e),n=r==_e?e.constructor:i,c=n?Li(n):"";if(c)switch(c){case yp:return je;case vp:return ge;case mp:return vt;case wp:return Ae;case _p:return Ne}return r});function qd(e,r,n){for(var c=-1,l=n.length;++c<l;){var g=n[c],w=g.size;switch(g.type){case"drop":e+=w;break;case"dropRight":r-=w;break;case"take":r=Ut(r,e+w);break;case"takeRight":e=Ct(e,r-w);break}}return{start:e,end:r}}function jd(e){var r=e.match(He);return r?r[1].split(It):[]}function Yu(e,r,n){r=gi(r,e);for(var c=-1,l=r.length,g=!1;++c<l;){var w=Hr(r[c]);if(!(g=e!=null&&n(e,w)))break;e=e[w]}return g||++c!=l?g:(l=e==null?0:e.length,!!l&&ia(l)&&Xr(w,l)&&(le(e)||zi(e)))}function Ld(e){var r=e.length,n=new e.constructor(r);return r&&typeof e[0]=="string"&&$e.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function Zu(e){return typeof e.constructor=="function"&&!Ds(e)?is(Cn(e)):{}}function zd(e,r,n){var c=e.constructor;switch(r){case Se:return Ao(e);case T:case O:return new c(+e);case je:return bd(e,n);case it:case Te:case mt:case Rt:case jt:case Lt:case $t:case Ft:case Zt:return Du(e,n);case ge:return new c;case Pe:case ke:return new c(e);case Ze:return Id(e);case Ae:return new c;case Ke:return Ed(e)}}function Md(e,r){var n=r.length;if(!n)return e;var c=n-1;return r[c]=(n>1?"& ":"")+r[c],r=r.join(n>2?", ":" "),e.replace(ut,`{
/* [wrapped with `+r+`] */
`)}function Ud(e){return le(e)||zi(e)||!!(iu&&e&&e[iu])}function Xr(e,r){var n=typeof e;return r=r??G,!!r&&(n=="number"||n!="symbol"&&za.test(e))&&e>-1&&e%1==0&&e<r}function Jt(e,r,n){if(!tt(n))return!1;var c=typeof r;return(c=="number"?tr(n)&&Xr(r,n.length):c=="string"&&r in n)?Tr(n[r],e):!1}function Lo(e,r){if(le(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||pr(e)?!0:wt.test(e)||!Je.test(e)||r!=null&&e in Ue(r)}function Hd(e){var r=typeof e;return r=="string"||r=="number"||r=="symbol"||r=="boolean"?e!=="__proto__":e===null}function zo(e){var r=Jn(e),n=p[r];if(typeof n!="function"||!(r in be.prototype))return!1;if(e===n)return!0;var c=Do(n);return!!c&&e===c[0]}function kd(e){return!!Xc&&Xc in e}var Kd=Pn?ei:tc;function Ds(e){var r=e&&e.constructor,n=typeof r=="function"&&r.prototype||es;return e===n}function Xu(e){return e===e&&!tt(e)}function eh(e,r){return function(n){return n==null?!1:n[e]===r&&(r!==i||e in Ue(n))}}function Vd(e){var r=ta(e,function(c){return n.size===d&&n.clear(),c}),n=r.cache;return r}function Fd(e,r){var n=e[1],c=r[1],l=n|c,g=l<(te|ce|Y),w=c==Y&&n==ne||c==Y&&n==xe&&e[7].length<=r[8]||c==(Y|xe)&&r[7].length<=r[8]&&n==ne;if(!(g||w))return e;c&te&&(e[2]=r[2],l|=n&te?0:oe);var b=r[3];if(b){var P=e[3];e[3]=P?ju(P,b,r[4]):b,e[4]=P?li(e[3],_):r[4]}return b=r[5],b&&(P=e[5],e[5]=P?Lu(P,b,r[6]):b,e[6]=P?li(e[5],_):r[6]),b=r[7],b&&(e[7]=b),c&Y&&(e[8]=e[8]==null?r[8]:Ut(e[8],r[8])),e[9]==null&&(e[9]=r[9]),e[0]=r[0],e[1]=l,e}function Bd(e){var r=[];if(e!=null)for(var n in Ue(e))r.push(n);return r}function Gd(e){return On.call(e)}function th(e,r,n){return r=Ct(r===i?e.length-1:r,0),function(){for(var c=arguments,l=-1,g=Ct(c.length-r,0),w=C(g);++l<g;)w[l]=c[r+l];l=-1;for(var b=C(r+1);++l<r;)b[l]=c[l];return b[r]=n(w),Nt(e,this,b)}}function rh(e,r){return r.length<2?e:qi(e,Ir(r,0,-1))}function Wd(e,r){for(var n=e.length,c=Ut(r.length,n),l=er(e);c--;){var g=r[c];e[c]=Xr(g,n)?l[g]:i}return e}function Mo(e,r){if(!(r==="constructor"&&typeof e[r]=="function")&&r!="__proto__")return e[r]}var ih=nh(Su),qs=up||function(e,r){return Ie.setTimeout(e,r)},Uo=nh(vd);function sh(e,r,n){var c=r+"";return Uo(e,Md(c,Jd(jd(c),n)))}function nh(e){var r=0,n=0;return function(){var c=pp(),l=ur-(c-n);if(n=c,l>0){if(++r>=Vt)return arguments[0]}else r=0;return e.apply(i,arguments)}}function Yn(e,r){var n=-1,c=e.length,l=c-1;for(r=r===i?c:r;++n<r;){var g=Io(n,l),w=e[g];e[g]=e[n],e[n]=w}return e.length=r,e}var ah=Vd(function(e){var r=[];return e.charCodeAt(0)===46&&r.push(""),e.replace(_t,function(n,c,l,g){r.push(l?g.replace($a,"$1"):c||n)}),r});function Hr(e){if(typeof e=="string"||pr(e))return e;var r=e+"";return r=="0"&&1/e==-qe?"-0":r}function Li(e){if(e!=null){try{return Sn.call(e)}catch{}try{return e+""}catch{}}return""}function Jd(e,r){return mr(xi,function(n){var c="_."+n[0];r&n[1]&&!bn(e,c)&&e.push(c)}),e.sort()}function oh(e){if(e instanceof be)return e.clone();var r=new _r(e.__wrapped__,e.__chain__);return r.__actions__=er(e.__actions__),r.__index__=e.__index__,r.__values__=e.__values__,r}function Qd(e,r,n){(n?Jt(e,r,n):r===i)?r=1:r=Ct(de(r),0);var c=e==null?0:e.length;if(!c||r<1)return[];for(var l=0,g=0,w=C(Nn(c/r));l<c;)w[g++]=Ir(e,l,l+=r);return w}function Yd(e){for(var r=-1,n=e==null?0:e.length,c=0,l=[];++r<n;){var g=e[r];g&&(l[c++]=g)}return l}function Zd(){var e=arguments.length;if(!e)return[];for(var r=C(e-1),n=arguments[0],c=e;c--;)r[c-1]=arguments[c];return hi(le(n)?er(n):[n],zt(r,1))}var Xd=ve(function(e,r){return dt(e)?As(e,zt(r,1,dt,!0)):[]}),eg=ve(function(e,r){var n=Er(r);return dt(n)&&(n=i),dt(e)?As(e,zt(r,1,dt,!0),ee(n,2)):[]}),tg=ve(function(e,r){var n=Er(r);return dt(n)&&(n=i),dt(e)?As(e,zt(r,1,dt,!0),i,n):[]});function rg(e,r,n){var c=e==null?0:e.length;return c?(r=n||r===i?1:de(r),Ir(e,r<0?0:r,c)):[]}function ig(e,r,n){var c=e==null?0:e.length;return c?(r=n||r===i?1:de(r),r=c-r,Ir(e,0,r<0?0:r)):[]}function sg(e,r){return e&&e.length?Kn(e,ee(r,3),!0,!0):[]}function ng(e,r){return e&&e.length?Kn(e,ee(r,3),!0):[]}function ag(e,r,n,c){var l=e==null?0:e.length;return l?(n&&typeof n!="number"&&Jt(e,r,n)&&(n=0,c=l),Zp(e,r,n,c)):[]}function ch(e,r,n){var c=e==null?0:e.length;if(!c)return-1;var l=n==null?0:de(n);return l<0&&(l=Ct(c+l,0)),In(e,ee(r,3),l)}function uh(e,r,n){var c=e==null?0:e.length;if(!c)return-1;var l=c-1;return n!==i&&(l=de(n),l=n<0?Ct(c+l,0):Ut(l,c-1)),In(e,ee(r,3),l,!0)}function hh(e){var r=e==null?0:e.length;return r?zt(e,1):[]}function og(e){var r=e==null?0:e.length;return r?zt(e,qe):[]}function cg(e,r){var n=e==null?0:e.length;return n?(r=r===i?1:de(r),zt(e,r)):[]}function ug(e){for(var r=-1,n=e==null?0:e.length,c={};++r<n;){var l=e[r];c[l[0]]=l[1]}return c}function lh(e){return e&&e.length?e[0]:i}function hg(e,r,n){var c=e==null?0:e.length;if(!c)return-1;var l=n==null?0:de(n);return l<0&&(l=Ct(c+l,0)),Qi(e,r,l)}function lg(e){var r=e==null?0:e.length;return r?Ir(e,0,-1):[]}var fg=ve(function(e){var r=Qe(e,Oo);return r.length&&r[0]===e[0]?vo(r):[]}),pg=ve(function(e){var r=Er(e),n=Qe(e,Oo);return r===Er(n)?r=i:n.pop(),n.length&&n[0]===e[0]?vo(n,ee(r,2)):[]}),dg=ve(function(e){var r=Er(e),n=Qe(e,Oo);return r=typeof r=="function"?r:i,r&&n.pop(),n.length&&n[0]===e[0]?vo(n,i,r):[]});function gg(e,r){return e==null?"":lp.call(e,r)}function Er(e){var r=e==null?0:e.length;return r?e[r-1]:i}function yg(e,r,n){var c=e==null?0:e.length;if(!c)return-1;var l=c;return n!==i&&(l=de(n),l=l<0?Ct(c+l,0):Ut(l,c-1)),r===r?Jf(e,r,l):In(e,Fc,l,!0)}function vg(e,r){return e&&e.length?Iu(e,de(r)):i}var mg=ve(fh);function fh(e,r){return e&&e.length&&r&&r.length?bo(e,r):e}function wg(e,r,n){return e&&e.length&&r&&r.length?bo(e,r,ee(n,2)):e}function _g(e,r,n){return e&&e.length&&r&&r.length?bo(e,r,i,n):e}var bg=Zr(function(e,r){var n=e==null?0:e.length,c=fo(e,r);return Pu(e,Qe(r,function(l){return Xr(l,n)?+l:l}).sort(qu)),c});function Ig(e,r){var n=[];if(!(e&&e.length))return n;var c=-1,l=[],g=e.length;for(r=ee(r,3);++c<g;){var w=e[c];r(w,c,e)&&(n.push(w),l.push(c))}return Pu(e,l),n}function Ho(e){return e==null?e:gp.call(e)}function Eg(e,r,n){var c=e==null?0:e.length;return c?(n&&typeof n!="number"&&Jt(e,r,n)?(r=0,n=c):(r=r==null?0:de(r),n=n===i?c:de(n)),Ir(e,r,n)):[]}function xg(e,r){return kn(e,r)}function Pg(e,r,n){return xo(e,r,ee(n,2))}function Sg(e,r){var n=e==null?0:e.length;if(n){var c=kn(e,r);if(c<n&&Tr(e[c],r))return c}return-1}function Og(e,r){return kn(e,r,!0)}function Rg(e,r,n){return xo(e,r,ee(n,2),!0)}function Ag(e,r){var n=e==null?0:e.length;if(n){var c=kn(e,r,!0)-1;if(Tr(e[c],r))return c}return-1}function Cg(e){return e&&e.length?Ou(e):[]}function Tg(e,r){return e&&e.length?Ou(e,ee(r,2)):[]}function $g(e){var r=e==null?0:e.length;return r?Ir(e,1,r):[]}function Ng(e,r,n){return e&&e.length?(r=n||r===i?1:de(r),Ir(e,0,r<0?0:r)):[]}function Dg(e,r,n){var c=e==null?0:e.length;return c?(r=n||r===i?1:de(r),r=c-r,Ir(e,r<0?0:r,c)):[]}function qg(e,r){return e&&e.length?Kn(e,ee(r,3),!1,!0):[]}function jg(e,r){return e&&e.length?Kn(e,ee(r,3)):[]}var Lg=ve(function(e){return di(zt(e,1,dt,!0))}),zg=ve(function(e){var r=Er(e);return dt(r)&&(r=i),di(zt(e,1,dt,!0),ee(r,2))}),Mg=ve(function(e){var r=Er(e);return r=typeof r=="function"?r:i,di(zt(e,1,dt,!0),i,r)});function Ug(e){return e&&e.length?di(e):[]}function Hg(e,r){return e&&e.length?di(e,ee(r,2)):[]}function kg(e,r){return r=typeof r=="function"?r:i,e&&e.length?di(e,i,r):[]}function ko(e){if(!(e&&e.length))return[];var r=0;return e=ui(e,function(n){if(dt(n))return r=Ct(n.length,r),!0}),so(r,function(n){return Qe(e,to(n))})}function ph(e,r){if(!(e&&e.length))return[];var n=ko(e);return r==null?n:Qe(n,function(c){return Nt(r,i,c)})}var Kg=ve(function(e,r){return dt(e)?As(e,r):[]}),Vg=ve(function(e){return So(ui(e,dt))}),Fg=ve(function(e){var r=Er(e);return dt(r)&&(r=i),So(ui(e,dt),ee(r,2))}),Bg=ve(function(e){var r=Er(e);return r=typeof r=="function"?r:i,So(ui(e,dt),i,r)}),Gg=ve(ko);function Wg(e,r){return Tu(e||[],r||[],Rs)}function Jg(e,r){return Tu(e||[],r||[],$s)}var Qg=ve(function(e){var r=e.length,n=r>1?e[r-1]:i;return n=typeof n=="function"?(e.pop(),n):i,ph(e,n)});function dh(e){var r=p(e);return r.__chain__=!0,r}function Yg(e,r){return r(e),e}function Zn(e,r){return r(e)}var Zg=Zr(function(e){var r=e.length,n=r?e[0]:0,c=this.__wrapped__,l=function(g){return fo(g,e)};return r>1||this.__actions__.length||!(c instanceof be)||!Xr(n)?this.thru(l):(c=c.slice(n,+n+(r?1:0)),c.__actions__.push({func:Zn,args:[l],thisArg:i}),new _r(c,this.__chain__).thru(function(g){return r&&!g.length&&g.push(i),g}))});function Xg(){return dh(this)}function ey(){return new _r(this.value(),this.__chain__)}function ty(){this.__values__===i&&(this.__values__=Rh(this.value()));var e=this.__index__>=this.__values__.length,r=e?i:this.__values__[this.__index__++];return{done:e,value:r}}function ry(){return this}function iy(e){for(var r,n=this;n instanceof Ln;){var c=oh(n);c.__index__=0,c.__values__=i,r?l.__wrapped__=c:r=c;var l=c;n=n.__wrapped__}return l.__wrapped__=e,r}function sy(){var e=this.__wrapped__;if(e instanceof be){var r=e;return this.__actions__.length&&(r=new be(this)),r=r.reverse(),r.__actions__.push({func:Zn,args:[Ho],thisArg:i}),new _r(r,this.__chain__)}return this.thru(Ho)}function ny(){return Cu(this.__wrapped__,this.__actions__)}var ay=Vn(function(e,r,n){$e.call(e,n)?++e[n]:Qr(e,n,1)});function oy(e,r,n){var c=le(e)?Kc:Yp;return n&&Jt(e,r,n)&&(r=i),c(e,ee(r,3))}function cy(e,r){var n=le(e)?ui:pu;return n(e,ee(r,3))}var uy=Hu(ch),hy=Hu(uh);function ly(e,r){return zt(Xn(e,r),1)}function fy(e,r){return zt(Xn(e,r),qe)}function py(e,r,n){return n=n===i?1:de(n),zt(Xn(e,r),n)}function gh(e,r){var n=le(e)?mr:pi;return n(e,ee(r,3))}function yh(e,r){var n=le(e)?$f:fu;return n(e,ee(r,3))}var dy=Vn(function(e,r,n){$e.call(e,n)?e[n].push(r):Qr(e,n,[r])});function gy(e,r,n,c){e=tr(e)?e:cs(e),n=n&&!c?de(n):0;var l=e.length;return n<0&&(n=Ct(l+n,0)),sa(e)?n<=l&&e.indexOf(r,n)>-1:!!l&&Qi(e,r,n)>-1}var yy=ve(function(e,r,n){var c=-1,l=typeof r=="function",g=tr(e)?C(e.length):[];return pi(e,function(w){g[++c]=l?Nt(r,w,n):Cs(w,r,n)}),g}),vy=Vn(function(e,r,n){Qr(e,n,r)});function Xn(e,r){var n=le(e)?Qe:wu;return n(e,ee(r,3))}function my(e,r,n,c){return e==null?[]:(le(r)||(r=r==null?[]:[r]),n=c?i:n,le(n)||(n=n==null?[]:[n]),Eu(e,r,n))}var wy=Vn(function(e,r,n){e[n?0:1].push(r)},function(){return[[],[]]});function _y(e,r,n){var c=le(e)?Xa:Gc,l=arguments.length<3;return c(e,ee(r,4),n,l,pi)}function by(e,r,n){var c=le(e)?Nf:Gc,l=arguments.length<3;return c(e,ee(r,4),n,l,fu)}function Iy(e,r){var n=le(e)?ui:pu;return n(e,ra(ee(r,3)))}function Ey(e){var r=le(e)?cu:gd;return r(e)}function xy(e,r,n){(n?Jt(e,r,n):r===i)?r=1:r=de(r);var c=le(e)?Bp:yd;return c(e,r)}function Py(e){var r=le(e)?Gp:md;return r(e)}function Sy(e){if(e==null)return 0;if(tr(e))return sa(e)?Zi(e):e.length;var r=Ht(e);return r==ge||r==Ae?e.size:wo(e).length}function Oy(e,r,n){var c=le(e)?eo:wd;return n&&Jt(e,r,n)&&(r=i),c(e,ee(r,3))}var Ry=ve(function(e,r){if(e==null)return[];var n=r.length;return n>1&&Jt(e,r[0],r[1])?r=[]:n>2&&Jt(r[0],r[1],r[2])&&(r=[r[0]]),Eu(e,zt(r,1),[])}),ea=cp||function(){return Ie.Date.now()};function Ay(e,r){if(typeof r!="function")throw new wr(f);return e=de(e),function(){if(--e<1)return r.apply(this,arguments)}}function vh(e,r,n){return r=n?i:r,r=e&&r==null?e.length:r,Yr(e,Y,i,i,i,i,r)}function mh(e,r){var n;if(typeof r!="function")throw new wr(f);return e=de(e),function(){return--e>0&&(n=r.apply(this,arguments)),e<=1&&(r=i),n}}var Ko=ve(function(e,r,n){var c=te;if(n.length){var l=li(n,as(Ko));c|=fe}return Yr(e,c,r,n,l)}),wh=ve(function(e,r,n){var c=te|ce;if(n.length){var l=li(n,as(wh));c|=fe}return Yr(r,c,e,n,l)});function _h(e,r,n){r=n?i:r;var c=Yr(e,ne,i,i,i,i,i,r);return c.placeholder=_h.placeholder,c}function bh(e,r,n){r=n?i:r;var c=Yr(e,re,i,i,i,i,i,r);return c.placeholder=bh.placeholder,c}function Ih(e,r,n){var c,l,g,w,b,P,q=0,j=!1,z=!1,k=!0;if(typeof e!="function")throw new wr(f);r=xr(r)||0,tt(n)&&(j=!!n.leading,z="maxWait"in n,g=z?Ct(xr(n.maxWait)||0,r):g,k="trailing"in n?!!n.trailing:k);function Z(gt){var $r=c,ri=l;return c=l=i,q=gt,w=e.apply(ri,$r),w}function ie(gt){return q=gt,b=qs(me,r),j?Z(gt):w}function ye(gt){var $r=gt-P,ri=gt-q,Hh=r-$r;return z?Ut(Hh,g-ri):Hh}function se(gt){var $r=gt-P,ri=gt-q;return P===i||$r>=r||$r<0||z&&ri>=g}function me(){var gt=ea();if(se(gt))return Ee(gt);b=qs(me,ye(gt))}function Ee(gt){return b=i,k&&c?Z(gt):(c=l=i,w)}function dr(){b!==i&&$u(b),q=0,c=P=l=b=i}function Qt(){return b===i?w:Ee(ea())}function gr(){var gt=ea(),$r=se(gt);if(c=arguments,l=this,P=gt,$r){if(b===i)return ie(P);if(z)return $u(b),b=qs(me,r),Z(P)}return b===i&&(b=qs(me,r)),w}return gr.cancel=dr,gr.flush=Qt,gr}var Cy=ve(function(e,r){return lu(e,1,r)}),Ty=ve(function(e,r,n){return lu(e,xr(r)||0,n)});function $y(e){return Yr(e,Tt)}function ta(e,r){if(typeof e!="function"||r!=null&&typeof r!="function")throw new wr(f);var n=function(){var c=arguments,l=r?r.apply(this,c):c[0],g=n.cache;if(g.has(l))return g.get(l);var w=e.apply(this,c);return n.cache=g.set(l,w)||g,w};return n.cache=new(ta.Cache||Jr),n}ta.Cache=Jr;function ra(e){if(typeof e!="function")throw new wr(f);return function(){var r=arguments;switch(r.length){case 0:return!e.call(this);case 1:return!e.call(this,r[0]);case 2:return!e.call(this,r[0],r[1]);case 3:return!e.call(this,r[0],r[1],r[2])}return!e.apply(this,r)}}function Ny(e){return mh(2,e)}var Dy=_d(function(e,r){r=r.length==1&&le(r[0])?Qe(r[0],lr(ee())):Qe(zt(r,1),lr(ee()));var n=r.length;return ve(function(c){for(var l=-1,g=Ut(c.length,n);++l<g;)c[l]=r[l].call(this,c[l]);return Nt(e,this,c)})}),Vo=ve(function(e,r){var n=li(r,as(Vo));return Yr(e,fe,i,r,n)}),Eh=ve(function(e,r){var n=li(r,as(Eh));return Yr(e,pe,i,r,n)}),qy=Zr(function(e,r){return Yr(e,xe,i,i,i,r)});function jy(e,r){if(typeof e!="function")throw new wr(f);return r=r===i?r:de(r),ve(e,r)}function Ly(e,r){if(typeof e!="function")throw new wr(f);return r=r==null?0:Ct(de(r),0),ve(function(n){var c=n[r],l=yi(n,0,r);return c&&hi(l,c),Nt(e,this,l)})}function zy(e,r,n){var c=!0,l=!0;if(typeof e!="function")throw new wr(f);return tt(n)&&(c="leading"in n?!!n.leading:c,l="trailing"in n?!!n.trailing:l),Ih(e,r,{leading:c,maxWait:r,trailing:l})}function My(e){return vh(e,1)}function Uy(e,r){return Vo(Ro(r),e)}function Hy(){if(!arguments.length)return[];var e=arguments[0];return le(e)?e:[e]}function ky(e){return br(e,D)}function Ky(e,r){return r=typeof r=="function"?r:i,br(e,D,r)}function Vy(e){return br(e,S|D)}function Fy(e,r){return r=typeof r=="function"?r:i,br(e,S|D,r)}function By(e,r){return r==null||hu(e,r,Dt(r))}function Tr(e,r){return e===r||e!==e&&r!==r}var Gy=Wn(yo),Wy=Wn(function(e,r){return e>=r}),zi=yu(function(){return arguments}())?yu:function(e){return ht(e)&&$e.call(e,"callee")&&!ru.call(e,"callee")},le=C.isArray,Jy=Gt?lr(Gt):id;function tr(e){return e!=null&&ia(e.length)&&!ei(e)}function dt(e){return ht(e)&&tr(e)}function Qy(e){return e===!0||e===!1||ht(e)&&Wt(e)==T}var vi=hp||tc,Yy=Rr?lr(Rr):sd;function Zy(e){return ht(e)&&e.nodeType===1&&!js(e)}function Xy(e){if(e==null)return!0;if(tr(e)&&(le(e)||typeof e=="string"||typeof e.splice=="function"||vi(e)||os(e)||zi(e)))return!e.length;var r=Ht(e);if(r==ge||r==Ae)return!e.size;if(Ds(e))return!wo(e).length;for(var n in e)if($e.call(e,n))return!1;return!0}function ev(e,r){return Ts(e,r)}function tv(e,r,n){n=typeof n=="function"?n:i;var c=n?n(e,r):i;return c===i?Ts(e,r,i,n):!!c}function Fo(e){if(!ht(e))return!1;var r=Wt(e);return r==I||r==h||typeof e.message=="string"&&typeof e.name=="string"&&!js(e)}function rv(e){return typeof e=="number"&&su(e)}function ei(e){if(!tt(e))return!1;var r=Wt(e);return r==J||r==ae||r==$||r==lt}function xh(e){return typeof e=="number"&&e==de(e)}function ia(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=G}function tt(e){var r=typeof e;return e!=null&&(r=="object"||r=="function")}function ht(e){return e!=null&&typeof e=="object"}var Ph=vr?lr(vr):ad;function iv(e,r){return e===r||mo(e,r,qo(r))}function sv(e,r,n){return n=typeof n=="function"?n:i,mo(e,r,qo(r),n)}function nv(e){return Sh(e)&&e!=+e}function av(e){if(Kd(e))throw new ue(u);return vu(e)}function ov(e){return e===null}function cv(e){return e==null}function Sh(e){return typeof e=="number"||ht(e)&&Wt(e)==Pe}function js(e){if(!ht(e)||Wt(e)!=_e)return!1;var r=Cn(e);if(r===null)return!0;var n=$e.call(r,"constructor")&&r.constructor;return typeof n=="function"&&n instanceof n&&Sn.call(n)==sp}var Bo=zr?lr(zr):od;function uv(e){return xh(e)&&e>=-G&&e<=G}var Oh=bs?lr(bs):cd;function sa(e){return typeof e=="string"||!le(e)&&ht(e)&&Wt(e)==ke}function pr(e){return typeof e=="symbol"||ht(e)&&Wt(e)==Ke}var os=Ci?lr(Ci):ud;function hv(e){return e===i}function lv(e){return ht(e)&&Ht(e)==Ne}function fv(e){return ht(e)&&Wt(e)==Ve}var pv=Wn(_o),dv=Wn(function(e,r){return e<=r});function Rh(e){if(!e)return[];if(tr(e))return sa(e)?Ar(e):er(e);if(Es&&e[Es])return Bf(e[Es]());var r=Ht(e),n=r==ge?ao:r==Ae?En:cs;return n(e)}function ti(e){if(!e)return e===0?e:0;if(e=xr(e),e===qe||e===-qe){var r=e<0?-1:1;return r*K}return e===e?e:0}function de(e){var r=ti(e),n=r%1;return r===r?n?r-n:r:0}function Ah(e){return e?Di(de(e),0,V):0}function xr(e){if(typeof e=="number")return e;if(pr(e))return H;if(tt(e)){var r=typeof e.valueOf=="function"?e.valueOf():e;e=tt(r)?r+"":r}if(typeof e!="string")return e===0?e:+e;e=Wc(e);var n=qa.test(e);return n||La.test(e)?he(e.slice(2),n?2:8):Da.test(e)?H:+e}function Ch(e){return Ur(e,rr(e))}function gv(e){return e?Di(de(e),-G,G):e===0?e:0}function Ce(e){return e==null?"":fr(e)}var yv=ss(function(e,r){if(Ds(r)||tr(r)){Ur(r,Dt(r),e);return}for(var n in r)$e.call(r,n)&&Rs(e,n,r[n])}),Th=ss(function(e,r){Ur(r,rr(r),e)}),na=ss(function(e,r,n,c){Ur(r,rr(r),e,c)}),vv=ss(function(e,r,n,c){Ur(r,Dt(r),e,c)}),mv=Zr(fo);function wv(e,r){var n=is(e);return r==null?n:uu(n,r)}var _v=ve(function(e,r){e=Ue(e);var n=-1,c=r.length,l=c>2?r[2]:i;for(l&&Jt(r[0],r[1],l)&&(c=1);++n<c;)for(var g=r[n],w=rr(g),b=-1,P=w.length;++b<P;){var q=w[b],j=e[q];(j===i||Tr(j,es[q])&&!$e.call(e,q))&&(e[q]=g[q])}return e}),bv=ve(function(e){return e.push(i,Wu),Nt($h,i,e)});function Iv(e,r){return Vc(e,ee(r,3),Mr)}function Ev(e,r){return Vc(e,ee(r,3),go)}function xv(e,r){return e==null?e:po(e,ee(r,3),rr)}function Pv(e,r){return e==null?e:du(e,ee(r,3),rr)}function Sv(e,r){return e&&Mr(e,ee(r,3))}function Ov(e,r){return e&&go(e,ee(r,3))}function Rv(e){return e==null?[]:Un(e,Dt(e))}function Av(e){return e==null?[]:Un(e,rr(e))}function Go(e,r,n){var c=e==null?i:qi(e,r);return c===i?n:c}function Cv(e,r){return e!=null&&Yu(e,r,Xp)}function Wo(e,r){return e!=null&&Yu(e,r,ed)}var Tv=Ku(function(e,r,n){r!=null&&typeof r.toString!="function"&&(r=On.call(r)),e[r]=n},Qo(ir)),$v=Ku(function(e,r,n){r!=null&&typeof r.toString!="function"&&(r=On.call(r)),$e.call(e,r)?e[r].push(n):e[r]=[n]},ee),Nv=ve(Cs);function Dt(e){return tr(e)?ou(e):wo(e)}function rr(e){return tr(e)?ou(e,!0):hd(e)}function Dv(e,r){var n={};return r=ee(r,3),Mr(e,function(c,l,g){Qr(n,r(c,l,g),c)}),n}function qv(e,r){var n={};return r=ee(r,3),Mr(e,function(c,l,g){Qr(n,l,r(c,l,g))}),n}var jv=ss(function(e,r,n){Hn(e,r,n)}),$h=ss(function(e,r,n,c){Hn(e,r,n,c)}),Lv=Zr(function(e,r){var n={};if(e==null)return n;var c=!1;r=Qe(r,function(g){return g=gi(g,e),c||(c=g.length>1),g}),Ur(e,No(e),n),c&&(n=br(n,S|R|D,Td));for(var l=r.length;l--;)Po(n,r[l]);return n});function zv(e,r){return Nh(e,ra(ee(r)))}var Mv=Zr(function(e,r){return e==null?{}:fd(e,r)});function Nh(e,r){if(e==null)return{};var n=Qe(No(e),function(c){return[c]});return r=ee(r),xu(e,n,function(c,l){return r(c,l[0])})}function Uv(e,r,n){r=gi(r,e);var c=-1,l=r.length;for(l||(l=1,e=i);++c<l;){var g=e==null?i:e[Hr(r[c])];g===i&&(c=l,g=n),e=ei(g)?g.call(e):g}return e}function Hv(e,r,n){return e==null?e:$s(e,r,n)}function kv(e,r,n,c){return c=typeof c=="function"?c:i,e==null?e:$s(e,r,n,c)}var Dh=Bu(Dt),qh=Bu(rr);function Kv(e,r,n){var c=le(e),l=c||vi(e)||os(e);if(r=ee(r,4),n==null){var g=e&&e.constructor;l?n=c?new g:[]:tt(e)?n=ei(g)?is(Cn(e)):{}:n={}}return(l?mr:Mr)(e,function(w,b,P){return r(n,w,b,P)}),n}function Vv(e,r){return e==null?!0:Po(e,r)}function Fv(e,r,n){return e==null?e:Au(e,r,Ro(n))}function Bv(e,r,n,c){return c=typeof c=="function"?c:i,e==null?e:Au(e,r,Ro(n),c)}function cs(e){return e==null?[]:no(e,Dt(e))}function Gv(e){return e==null?[]:no(e,rr(e))}function Wv(e,r,n){return n===i&&(n=r,r=i),n!==i&&(n=xr(n),n=n===n?n:0),r!==i&&(r=xr(r),r=r===r?r:0),Di(xr(e),r,n)}function Jv(e,r,n){return r=ti(r),n===i?(n=r,r=0):n=ti(n),e=xr(e),td(e,r,n)}function Qv(e,r,n){if(n&&typeof n!="boolean"&&Jt(e,r,n)&&(r=n=i),n===i&&(typeof r=="boolean"?(n=r,r=i):typeof e=="boolean"&&(n=e,e=i)),e===i&&r===i?(e=0,r=1):(e=ti(e),r===i?(r=e,e=0):r=ti(r)),e>r){var c=e;e=r,r=c}if(n||e%1||r%1){var l=nu();return Ut(e+l*(r-e+ze("1e-"+((l+"").length-1))),r)}return Io(e,r)}var Yv=ns(function(e,r,n){return r=r.toLowerCase(),e+(n?jh(r):r)});function jh(e){return Jo(Ce(e).toLowerCase())}function Lh(e){return e=Ce(e),e&&e.replace(Br,Hf).replace(Qa,"")}function Zv(e,r,n){e=Ce(e),r=fr(r);var c=e.length;n=n===i?c:Di(de(n),0,c);var l=n;return n-=r.length,n>=0&&e.slice(n,l)==r}function Xv(e){return e=Ce(e),e&&We.test(e)?e.replace(Pi,kf):e}function em(e){return e=Ce(e),e&&bt.test(e)?e.replace(ot,"\\$&"):e}var tm=ns(function(e,r,n){return e+(n?"-":"")+r.toLowerCase()}),rm=ns(function(e,r,n){return e+(n?" ":"")+r.toLowerCase()}),im=Uu("toLowerCase");function sm(e,r,n){e=Ce(e),r=de(r);var c=r?Zi(e):0;if(!r||c>=r)return e;var l=(r-c)/2;return Gn(Dn(l),n)+e+Gn(Nn(l),n)}function nm(e,r,n){e=Ce(e),r=de(r);var c=r?Zi(e):0;return r&&c<r?e+Gn(r-c,n):e}function am(e,r,n){e=Ce(e),r=de(r);var c=r?Zi(e):0;return r&&c<r?Gn(r-c,n)+e:e}function om(e,r,n){return n||r==null?r=0:r&&(r=+r),dp(Ce(e).replace(ct,""),r||0)}function cm(e,r,n){return(n?Jt(e,r,n):r===i)?r=1:r=de(r),Eo(Ce(e),r)}function um(){var e=arguments,r=Ce(e[0]);return e.length<3?r:r.replace(e[1],e[2])}var hm=ns(function(e,r,n){return e+(n?"_":"")+r.toLowerCase()});function lm(e,r,n){return n&&typeof n!="number"&&Jt(e,r,n)&&(r=n=i),n=n===i?V:n>>>0,n?(e=Ce(e),e&&(typeof r=="string"||r!=null&&!Bo(r))&&(r=fr(r),!r&&Yi(e))?yi(Ar(e),0,n):e.split(r,n)):[]}var fm=ns(function(e,r,n){return e+(n?" ":"")+Jo(r)});function pm(e,r,n){return e=Ce(e),n=n==null?0:Di(de(n),0,e.length),r=fr(r),e.slice(n,n+r.length)==r}function dm(e,r,n){var c=p.templateSettings;n&&Jt(e,r,n)&&(r=i),e=Ce(e),r=na({},r,c,Gu);var l=na({},r.imports,c.imports,Gu),g=Dt(l),w=no(l,g),b,P,q=0,j=r.interpolate||Ki,z="__p += '",k=oo((r.escape||Ki).source+"|"+j.source+"|"+(j===et?Na:Ki).source+"|"+(r.evaluate||Ki).source+"|$","g"),Z="//# sourceURL="+($e.call(r,"sourceURL")?(r.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Ya+"]")+`
`;e.replace(k,function(se,me,Ee,dr,Qt,gr){return Ee||(Ee=dr),z+=e.slice(q,gr).replace(Ma,Kf),me&&(b=!0,z+=`' +
__e(`+me+`) +
'`),Qt&&(P=!0,z+=`';
`+Qt+`;
__p += '`),Ee&&(z+=`' +
((__t = (`+Ee+`)) == null ? '' : __t) +
'`),q=gr+se.length,se}),z+=`';
`;var ie=$e.call(r,"variable")&&r.variable;if(!ie)z=`with (obj) {
`+z+`
}
`;else if(Ta.test(ie))throw new ue(y);z=(P?z.replace(jr,""):z).replace(Bt,"$1").replace(Fr,"$1;"),z="function("+(ie||"obj")+`) {
`+(ie?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(b?", __e = _.escape":"")+(P?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+z+`return __p
}`;var ye=Mh(function(){return Re(g,Z+"return "+z).apply(i,w)});if(ye.source=z,Fo(ye))throw ye;return ye}function gm(e){return Ce(e).toLowerCase()}function ym(e){return Ce(e).toUpperCase()}function vm(e,r,n){if(e=Ce(e),e&&(n||r===i))return Wc(e);if(!e||!(r=fr(r)))return e;var c=Ar(e),l=Ar(r),g=Jc(c,l),w=Qc(c,l)+1;return yi(c,g,w).join("")}function mm(e,r,n){if(e=Ce(e),e&&(n||r===i))return e.slice(0,Zc(e)+1);if(!e||!(r=fr(r)))return e;var c=Ar(e),l=Qc(c,Ar(r))+1;return yi(c,0,l).join("")}function wm(e,r,n){if(e=Ce(e),e&&(n||r===i))return e.replace(ct,"");if(!e||!(r=fr(r)))return e;var c=Ar(e),l=Jc(c,Ar(r));return yi(c,l).join("")}function _m(e,r){var n=yt,c=Yt;if(tt(r)){var l="separator"in r?r.separator:l;n="length"in r?de(r.length):n,c="omission"in r?fr(r.omission):c}e=Ce(e);var g=e.length;if(Yi(e)){var w=Ar(e);g=w.length}if(n>=g)return e;var b=n-Zi(c);if(b<1)return c;var P=w?yi(w,0,b).join(""):e.slice(0,b);if(l===i)return P+c;if(w&&(b+=P.length-b),Bo(l)){if(e.slice(b).search(l)){var q,j=P;for(l.global||(l=oo(l.source,Ce(yr.exec(l))+"g")),l.lastIndex=0;q=l.exec(j);)var z=q.index;P=P.slice(0,z===i?b:z)}}else if(e.indexOf(fr(l),b)!=b){var k=P.lastIndexOf(l);k>-1&&(P=P.slice(0,k))}return P+c}function bm(e){return e=Ce(e),e&&st.test(e)?e.replace(oi,Qf):e}var Im=ns(function(e,r,n){return e+(n?" ":"")+r.toUpperCase()}),Jo=Uu("toUpperCase");function zh(e,r,n){return e=Ce(e),r=n?i:r,r===i?Ff(e)?Xf(e):jf(e):e.match(r)||[]}var Mh=ve(function(e,r){try{return Nt(e,i,r)}catch(n){return Fo(n)?n:new ue(n)}}),Em=Zr(function(e,r){return mr(r,function(n){n=Hr(n),Qr(e,n,Ko(e[n],e))}),e});function xm(e){var r=e==null?0:e.length,n=ee();return e=r?Qe(e,function(c){if(typeof c[1]!="function")throw new wr(f);return[n(c[0]),c[1]]}):[],ve(function(c){for(var l=-1;++l<r;){var g=e[l];if(Nt(g[0],this,c))return Nt(g[1],this,c)}})}function Pm(e){return Qp(br(e,S))}function Qo(e){return function(){return e}}function Sm(e,r){return e==null||e!==e?r:e}var Om=ku(),Rm=ku(!0);function ir(e){return e}function Yo(e){return mu(typeof e=="function"?e:br(e,S))}function Am(e){return _u(br(e,S))}function Cm(e,r){return bu(e,br(r,S))}var Tm=ve(function(e,r){return function(n){return Cs(n,e,r)}}),$m=ve(function(e,r){return function(n){return Cs(e,n,r)}});function Zo(e,r,n){var c=Dt(r),l=Un(r,c);n==null&&!(tt(r)&&(l.length||!c.length))&&(n=r,r=e,e=this,l=Un(r,Dt(r)));var g=!(tt(n)&&"chain"in n)||!!n.chain,w=ei(e);return mr(l,function(b){var P=r[b];e[b]=P,w&&(e.prototype[b]=function(){var q=this.__chain__;if(g||q){var j=e(this.__wrapped__),z=j.__actions__=er(this.__actions__);return z.push({func:P,args:arguments,thisArg:e}),j.__chain__=q,j}return P.apply(e,hi([this.value()],arguments))})}),e}function Nm(){return Ie._===this&&(Ie._=np),this}function Xo(){}function Dm(e){return e=de(e),ve(function(r){return Iu(r,e)})}var qm=Co(Qe),jm=Co(Kc),Lm=Co(eo);function Uh(e){return Lo(e)?to(Hr(e)):pd(e)}function zm(e){return function(r){return e==null?i:qi(e,r)}}var Mm=Vu(),Um=Vu(!0);function ec(){return[]}function tc(){return!1}function Hm(){return{}}function km(){return""}function Km(){return!0}function Vm(e,r){if(e=de(e),e<1||e>G)return[];var n=V,c=Ut(e,V);r=ee(r),e-=V;for(var l=so(c,r);++n<e;)r(n);return l}function Fm(e){return le(e)?Qe(e,Hr):pr(e)?[e]:er(ah(Ce(e)))}function Bm(e){var r=++ip;return Ce(e)+r}var Gm=Bn(function(e,r){return e+r},0),Wm=To("ceil"),Jm=Bn(function(e,r){return e/r},1),Qm=To("floor");function Ym(e){return e&&e.length?Mn(e,ir,yo):i}function Zm(e,r){return e&&e.length?Mn(e,ee(r,2),yo):i}function Xm(e){return Bc(e,ir)}function e0(e,r){return Bc(e,ee(r,2))}function t0(e){return e&&e.length?Mn(e,ir,_o):i}function r0(e,r){return e&&e.length?Mn(e,ee(r,2),_o):i}var i0=Bn(function(e,r){return e*r},1),s0=To("round"),n0=Bn(function(e,r){return e-r},0);function a0(e){return e&&e.length?io(e,ir):0}function o0(e,r){return e&&e.length?io(e,ee(r,2)):0}return p.after=Ay,p.ary=vh,p.assign=yv,p.assignIn=Th,p.assignInWith=na,p.assignWith=vv,p.at=mv,p.before=mh,p.bind=Ko,p.bindAll=Em,p.bindKey=wh,p.castArray=Hy,p.chain=dh,p.chunk=Qd,p.compact=Yd,p.concat=Zd,p.cond=xm,p.conforms=Pm,p.constant=Qo,p.countBy=ay,p.create=wv,p.curry=_h,p.curryRight=bh,p.debounce=Ih,p.defaults=_v,p.defaultsDeep=bv,p.defer=Cy,p.delay=Ty,p.difference=Xd,p.differenceBy=eg,p.differenceWith=tg,p.drop=rg,p.dropRight=ig,p.dropRightWhile=sg,p.dropWhile=ng,p.fill=ag,p.filter=cy,p.flatMap=ly,p.flatMapDeep=fy,p.flatMapDepth=py,p.flatten=hh,p.flattenDeep=og,p.flattenDepth=cg,p.flip=$y,p.flow=Om,p.flowRight=Rm,p.fromPairs=ug,p.functions=Rv,p.functionsIn=Av,p.groupBy=dy,p.initial=lg,p.intersection=fg,p.intersectionBy=pg,p.intersectionWith=dg,p.invert=Tv,p.invertBy=$v,p.invokeMap=yy,p.iteratee=Yo,p.keyBy=vy,p.keys=Dt,p.keysIn=rr,p.map=Xn,p.mapKeys=Dv,p.mapValues=qv,p.matches=Am,p.matchesProperty=Cm,p.memoize=ta,p.merge=jv,p.mergeWith=$h,p.method=Tm,p.methodOf=$m,p.mixin=Zo,p.negate=ra,p.nthArg=Dm,p.omit=Lv,p.omitBy=zv,p.once=Ny,p.orderBy=my,p.over=qm,p.overArgs=Dy,p.overEvery=jm,p.overSome=Lm,p.partial=Vo,p.partialRight=Eh,p.partition=wy,p.pick=Mv,p.pickBy=Nh,p.property=Uh,p.propertyOf=zm,p.pull=mg,p.pullAll=fh,p.pullAllBy=wg,p.pullAllWith=_g,p.pullAt=bg,p.range=Mm,p.rangeRight=Um,p.rearg=qy,p.reject=Iy,p.remove=Ig,p.rest=jy,p.reverse=Ho,p.sampleSize=xy,p.set=Hv,p.setWith=kv,p.shuffle=Py,p.slice=Eg,p.sortBy=Ry,p.sortedUniq=Cg,p.sortedUniqBy=Tg,p.split=lm,p.spread=Ly,p.tail=$g,p.take=Ng,p.takeRight=Dg,p.takeRightWhile=qg,p.takeWhile=jg,p.tap=Yg,p.throttle=zy,p.thru=Zn,p.toArray=Rh,p.toPairs=Dh,p.toPairsIn=qh,p.toPath=Fm,p.toPlainObject=Ch,p.transform=Kv,p.unary=My,p.union=Lg,p.unionBy=zg,p.unionWith=Mg,p.uniq=Ug,p.uniqBy=Hg,p.uniqWith=kg,p.unset=Vv,p.unzip=ko,p.unzipWith=ph,p.update=Fv,p.updateWith=Bv,p.values=cs,p.valuesIn=Gv,p.without=Kg,p.words=zh,p.wrap=Uy,p.xor=Vg,p.xorBy=Fg,p.xorWith=Bg,p.zip=Gg,p.zipObject=Wg,p.zipObjectDeep=Jg,p.zipWith=Qg,p.entries=Dh,p.entriesIn=qh,p.extend=Th,p.extendWith=na,Zo(p,p),p.add=Gm,p.attempt=Mh,p.camelCase=Yv,p.capitalize=jh,p.ceil=Wm,p.clamp=Wv,p.clone=ky,p.cloneDeep=Vy,p.cloneDeepWith=Fy,p.cloneWith=Ky,p.conformsTo=By,p.deburr=Lh,p.defaultTo=Sm,p.divide=Jm,p.endsWith=Zv,p.eq=Tr,p.escape=Xv,p.escapeRegExp=em,p.every=oy,p.find=uy,p.findIndex=ch,p.findKey=Iv,p.findLast=hy,p.findLastIndex=uh,p.findLastKey=Ev,p.floor=Qm,p.forEach=gh,p.forEachRight=yh,p.forIn=xv,p.forInRight=Pv,p.forOwn=Sv,p.forOwnRight=Ov,p.get=Go,p.gt=Gy,p.gte=Wy,p.has=Cv,p.hasIn=Wo,p.head=lh,p.identity=ir,p.includes=gy,p.indexOf=hg,p.inRange=Jv,p.invoke=Nv,p.isArguments=zi,p.isArray=le,p.isArrayBuffer=Jy,p.isArrayLike=tr,p.isArrayLikeObject=dt,p.isBoolean=Qy,p.isBuffer=vi,p.isDate=Yy,p.isElement=Zy,p.isEmpty=Xy,p.isEqual=ev,p.isEqualWith=tv,p.isError=Fo,p.isFinite=rv,p.isFunction=ei,p.isInteger=xh,p.isLength=ia,p.isMap=Ph,p.isMatch=iv,p.isMatchWith=sv,p.isNaN=nv,p.isNative=av,p.isNil=cv,p.isNull=ov,p.isNumber=Sh,p.isObject=tt,p.isObjectLike=ht,p.isPlainObject=js,p.isRegExp=Bo,p.isSafeInteger=uv,p.isSet=Oh,p.isString=sa,p.isSymbol=pr,p.isTypedArray=os,p.isUndefined=hv,p.isWeakMap=lv,p.isWeakSet=fv,p.join=gg,p.kebabCase=tm,p.last=Er,p.lastIndexOf=yg,p.lowerCase=rm,p.lowerFirst=im,p.lt=pv,p.lte=dv,p.max=Ym,p.maxBy=Zm,p.mean=Xm,p.meanBy=e0,p.min=t0,p.minBy=r0,p.stubArray=ec,p.stubFalse=tc,p.stubObject=Hm,p.stubString=km,p.stubTrue=Km,p.multiply=i0,p.nth=vg,p.noConflict=Nm,p.noop=Xo,p.now=ea,p.pad=sm,p.padEnd=nm,p.padStart=am,p.parseInt=om,p.random=Qv,p.reduce=_y,p.reduceRight=by,p.repeat=cm,p.replace=um,p.result=Uv,p.round=s0,p.runInContext=x,p.sample=Ey,p.size=Sy,p.snakeCase=hm,p.some=Oy,p.sortedIndex=xg,p.sortedIndexBy=Pg,p.sortedIndexOf=Sg,p.sortedLastIndex=Og,p.sortedLastIndexBy=Rg,p.sortedLastIndexOf=Ag,p.startCase=fm,p.startsWith=pm,p.subtract=n0,p.sum=a0,p.sumBy=o0,p.template=dm,p.times=Vm,p.toFinite=ti,p.toInteger=de,p.toLength=Ah,p.toLower=gm,p.toNumber=xr,p.toSafeInteger=gv,p.toString=Ce,p.toUpper=ym,p.trim=vm,p.trimEnd=mm,p.trimStart=wm,p.truncate=_m,p.unescape=bm,p.uniqueId=Bm,p.upperCase=Im,p.upperFirst=Jo,p.each=gh,p.eachRight=yh,p.first=lh,Zo(p,function(){var e={};return Mr(p,function(r,n){$e.call(p.prototype,n)||(e[n]=r)}),e}(),{chain:!1}),p.VERSION=s,mr(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){p[e].placeholder=p}),mr(["drop","take"],function(e,r){be.prototype[e]=function(n){n=n===i?1:Ct(de(n),0);var c=this.__filtered__&&!r?new be(this):this.clone();return c.__filtered__?c.__takeCount__=Ut(n,c.__takeCount__):c.__views__.push({size:Ut(n,V),type:e+(c.__dir__<0?"Right":"")}),c},be.prototype[e+"Right"]=function(n){return this.reverse()[e](n).reverse()}}),mr(["filter","map","takeWhile"],function(e,r){var n=r+1,c=n==M||n==Ge;be.prototype[e]=function(l){var g=this.clone();return g.__iteratees__.push({iteratee:ee(l,3),type:n}),g.__filtered__=g.__filtered__||c,g}}),mr(["head","last"],function(e,r){var n="take"+(r?"Right":"");be.prototype[e]=function(){return this[n](1).value()[0]}}),mr(["initial","tail"],function(e,r){var n="drop"+(r?"":"Right");be.prototype[e]=function(){return this.__filtered__?new be(this):this[n](1)}}),be.prototype.compact=function(){return this.filter(ir)},be.prototype.find=function(e){return this.filter(e).head()},be.prototype.findLast=function(e){return this.reverse().find(e)},be.prototype.invokeMap=ve(function(e,r){return typeof e=="function"?new be(this):this.map(function(n){return Cs(n,e,r)})}),be.prototype.reject=function(e){return this.filter(ra(ee(e)))},be.prototype.slice=function(e,r){e=de(e);var n=this;return n.__filtered__&&(e>0||r<0)?new be(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),r!==i&&(r=de(r),n=r<0?n.dropRight(-r):n.take(r-e)),n)},be.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},be.prototype.toArray=function(){return this.take(V)},Mr(be.prototype,function(e,r){var n=/^(?:filter|find|map|reject)|While$/.test(r),c=/^(?:head|last)$/.test(r),l=p[c?"take"+(r=="last"?"Right":""):r],g=c||/^find/.test(r);l&&(p.prototype[r]=function(){var w=this.__wrapped__,b=c?[1]:arguments,P=w instanceof be,q=b[0],j=P||le(w),z=function(me){var Ee=l.apply(p,hi([me],b));return c&&k?Ee[0]:Ee};j&&n&&typeof q=="function"&&q.length!=1&&(P=j=!1);var k=this.__chain__,Z=!!this.__actions__.length,ie=g&&!k,ye=P&&!Z;if(!g&&j){w=ye?w:new be(this);var se=e.apply(w,b);return se.__actions__.push({func:Zn,args:[z],thisArg:i}),new _r(se,k)}return ie&&ye?e.apply(this,b):(se=this.thru(z),ie?c?se.value()[0]:se.value():se)})}),mr(["pop","push","shift","sort","splice","unshift"],function(e){var r=xn[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",c=/^(?:pop|shift)$/.test(e);p.prototype[e]=function(){var l=arguments;if(c&&!this.__chain__){var g=this.value();return r.apply(le(g)?g:[],l)}return this[n](function(w){return r.apply(le(w)?w:[],l)})}}),Mr(be.prototype,function(e,r){var n=p[r];if(n){var c=n.name+"";$e.call(rs,c)||(rs[c]=[]),rs[c].push({name:r,func:n})}}),rs[Fn(i,ce).name]=[{name:"wrapper",func:i}],be.prototype.clone=bp,be.prototype.reverse=Ip,be.prototype.value=Ep,p.prototype.at=Zg,p.prototype.chain=Xg,p.prototype.commit=ey,p.prototype.next=ty,p.prototype.plant=iy,p.prototype.reverse=sy,p.prototype.toJSON=p.prototype.valueOf=p.prototype.value=ny,p.prototype.first=p.prototype.head,Es&&(p.prototype[Es]=ry),p},Xi=ep();pt?((pt.exports=Xi)._=Xi,Me._=Xi):Ie._=Xi}).call(Ks)})(Rc,Rc.exports);var sE=Object.defineProperty,nE=Object.defineProperties,aE=Object.getOwnPropertyDescriptors,ql=Object.getOwnPropertySymbols,oE=Object.prototype.hasOwnProperty,cE=Object.prototype.propertyIsEnumerable,jl=(o,t,i)=>t in o?sE(o,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[t]=i,fa=(o,t)=>{for(var i in t||(t={}))oE.call(t,i)&&jl(o,i,t[i]);if(ql)for(var i of ql(t))cE.call(t,i)&&jl(o,i,t[i]);return o},uE=(o,t)=>nE(o,aE(t));function Ii(o,t,i){var s;const a=G0(o);return((s=t.rpcMap)==null?void 0:s[a.reference])||`${iE}?chainId=${a.namespace}:${a.reference}&projectId=${i}`}function ki(o){return o.includes(":")?o.split(":")[1]:o}function Af(o){return o.map(t=>`${t.split(":")[0]}:${t.split(":")[1]}`)}function hE(o,t){const i=Object.keys(t.namespaces).filter(a=>a.includes(o));if(!i.length)return[];const s=[];return i.forEach(a=>{const u=t.namespaces[a].accounts;s.push(...u)}),s}function lE(o={},t={}){const i=Ll(o),s=Ll(t);return Rc.exports.merge(i,s)}function Ll(o){var t,i,s,a;const u={};if(!ga(o))return u;for(const[f,y]of Object.entries(o)){const m=Ql(f)?[f]:y.chains,d=y.methods||[],_=y.events||[],S=y.rpcMap||{},R=Vs(f);u[R]=uE(fa(fa({},u[R]),y),{chains:ic(m,(t=u[R])==null?void 0:t.chains),methods:ic(d,(i=u[R])==null?void 0:i.methods),events:ic(_,(s=u[R])==null?void 0:s.events),rpcMap:fa(fa({},S),(a=u[R])==null?void 0:a.rpcMap)})}return u}function fE(o){return o.includes(":")?o.split(":")[2]:o}function pE(o){const t={};for(const[i,s]of Object.entries(o)){const a=s.methods||[],u=s.events||[],f=s.accounts||[],y=Ql(i)?[i]:s.chains?s.chains:Af(s.accounts);t[i]={chains:y,methods:a,events:u,accounts:f}}return t}function dc(o){return typeof o=="number"?o:o.includes("0x")?parseInt(o,16):o.includes(":")?Number(o.split(":")[1]):Number(o)}const Cf={},Ye=o=>Cf[o],gc=(o,t)=>{Cf[o]=t};class dE{constructor(t){this.name="polkadot",this.namespace=t.namespace,this.events=Ye("events"),this.client=Ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,i){this.httpProviders[t]||this.setHttpProvider(t,i),this.chainId=t,this.events.emit(ai.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(i=>{var s;const a=ki(i);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[i])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,i=this.httpProviders[t];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return i}setHttpProvider(t,i){const s=this.createHttpProvider(t,i);s&&(this.httpProviders[t]=s)}createHttpProvider(t,i){const s=i||Ii(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new ni(new Ei(s,Ye("disableProviderPing")))}}class gE{constructor(t){this.name="eip155",this.namespace=t.namespace,this.events=Ye("events"),this.client=Ye("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(t){switch(t.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(t);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(t.request.method)?await this.client.request(t):this.getHttpProvider().request(t.request)}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}setDefaultChain(t,i){this.httpProviders[t]||this.setHttpProvider(parseInt(t),i),this.chainId=parseInt(t),this.events.emit(ai.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}createHttpProvider(t,i){const s=i||Ii(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new ni(new Ei(s,Ye("disableProviderPing")))}setHttpProvider(t,i){const s=this.createHttpProvider(t,i);s&&(this.httpProviders[t]=s)}createHttpProviders(){const t={};return this.namespace.chains.forEach(i=>{var s;const a=parseInt(ki(i));t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[i])}),t}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}getHttpProvider(){const t=this.chainId,i=this.httpProviders[t];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return i}async handleSwitchChain(t){var i,s;let a=t.request.params?(i=t.request.params[0])==null?void 0:i.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const u=parseInt(a,16);if(this.isChainApproved(u))this.setDefaultChain(`${u}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:t.topic,request:{method:t.request.method,params:[{chainId:a}]},chainId:(s=this.namespace.chains)==null?void 0:s[0]}),this.setDefaultChain(`${u}`);else throw new Error(`Failed to switch to chain 'eip155:${u}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(t){return this.namespace.chains.includes(`${this.name}:${t}`)}}class yE{constructor(t){this.name="solana",this.namespace=t.namespace,this.events=Ye("events"),this.client=Ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,i){this.httpProviders[t]||this.setHttpProvider(t,i),this.chainId=t,this.events.emit(ai.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(i=>{var s;const a=ki(i);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[i])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,i=this.httpProviders[t];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return i}setHttpProvider(t,i){const s=this.createHttpProvider(t,i);s&&(this.httpProviders[t]=s)}createHttpProvider(t,i){const s=i||Ii(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new ni(new Ei(s,Ye("disableProviderPing")))}}class vE{constructor(t){this.name="cosmos",this.namespace=t.namespace,this.events=Ye("events"),this.client=Ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,i){this.httpProviders[t]||this.setHttpProvider(t,i),this.chainId=t,this.events.emit(ai.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(i=>{var s;const a=ki(i);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[i])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,i=this.httpProviders[t];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return i}setHttpProvider(t,i){const s=this.createHttpProvider(t,i);s&&(this.httpProviders[t]=s)}createHttpProvider(t,i){const s=i||Ii(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new ni(new Ei(s,Ye("disableProviderPing")))}}class mE{constructor(t){this.name="cip34",this.namespace=t.namespace,this.events=Ye("events"),this.client=Ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,i){this.httpProviders[t]||this.setHttpProvider(t,i),this.chainId=t,this.events.emit(ai.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(i=>{const s=this.getCardanoRPCUrl(i),a=ki(i);t[a]=this.createHttpProvider(a,s)}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,i=this.httpProviders[t];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return i}getCardanoRPCUrl(t){const i=this.namespace.rpcMap;if(i)return i[t]}setHttpProvider(t,i){const s=this.createHttpProvider(t,i);s&&(this.httpProviders[t]=s)}createHttpProvider(t,i){const s=i||this.getCardanoRPCUrl(t);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new ni(new Ei(s,Ye("disableProviderPing")))}}class wE{constructor(t){this.name="elrond",this.namespace=t.namespace,this.events=Ye("events"),this.client=Ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,i){this.httpProviders[t]||this.setHttpProvider(t,i),this.chainId=t,this.events.emit(ai.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(i=>{var s;const a=ki(i);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[i])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,i=this.httpProviders[t];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return i}setHttpProvider(t,i){const s=this.createHttpProvider(t,i);s&&(this.httpProviders[t]=s)}createHttpProvider(t,i){const s=i||Ii(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new ni(new Ei(s,Ye("disableProviderPing")))}}class _E{constructor(t){this.name="multiversx",this.namespace=t.namespace,this.events=Ye("events"),this.client=Ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,i){this.httpProviders[t]||this.setHttpProvider(t,i),this.chainId=t,this.events.emit(ai.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(i=>{var s;const a=ki(i);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[i])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,i=this.httpProviders[t];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return i}setHttpProvider(t,i){const s=this.createHttpProvider(t,i);s&&(this.httpProviders[t]=s)}createHttpProvider(t,i){const s=i||Ii(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new ni(new Ei(s,Ye("disableProviderPing")))}}class bE{constructor(t){this.name="near",this.namespace=t.namespace,this.events=Ye("events"),this.client=Ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,i){if(this.chainId=t,!this.httpProviders[t]){const s=i||Ii(`${this.name}:${t}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.events.emit(ai.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(i=>{var s;t[i]=this.createHttpProvider(i,(s=this.namespace.rpcMap)==null?void 0:s[i])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,i=this.httpProviders[t];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return i}setHttpProvider(t,i){const s=this.createHttpProvider(t,i);s&&(this.httpProviders[t]=s)}createHttpProvider(t,i){const s=i||Ii(t,this.namespace);return typeof s>"u"?void 0:new ni(new Ei(s,Ye("disableProviderPing")))}}var IE=Object.defineProperty,EE=Object.defineProperties,xE=Object.getOwnPropertyDescriptors,zl=Object.getOwnPropertySymbols,PE=Object.prototype.hasOwnProperty,SE=Object.prototype.propertyIsEnumerable,Ml=(o,t,i)=>t in o?IE(o,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[t]=i,pa=(o,t)=>{for(var i in t||(t={}))PE.call(t,i)&&Ml(o,i,t[i]);if(zl)for(var i of zl(t))SE.call(t,i)&&Ml(o,i,t[i]);return o},yc=(o,t)=>EE(o,xE(t));class Hc{constructor(t){this.events=new Dc,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=t,this.logger=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Oa(Ra({level:(t==null?void 0:t.logger)||Nl})),this.disableProviderPing=(t==null?void 0:t.disableProviderPing)||!1}static async init(t){const i=new Hc(t);return await i.initialize(),i}async request(t,i){const[s,a]=this.validateChain(i);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:pa({},t),chainId:`${s}:${a}`,topic:this.session.topic})}sendAsync(t,i,s){const a=new Date().getTime();this.request(t,s).then(u=>i(null,xa(a,u))).catch(u=>i(u,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var t;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(t=this.session)==null?void 0:t.topic,reason:kt("USER_DISCONNECTED")}),await this.cleanup()}async connect(t){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(t),await this.cleanupPendingPairings(),!t.skipPairing)return await this.pair(t.pairingTopic)}on(t,i){this.events.on(t,i)}once(t,i){this.events.once(t,i)}removeListener(t,i){this.events.removeListener(t,i)}off(t,i){this.events.off(t,i)}get isWalletConnect(){return!0}async pair(t){this.shouldAbortPairingAttempt=!1;let i=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(i>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:s,approval:a}=await this.client.connect({pairingTopic:t,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});s&&(this.uri=s,this.events.emit("display_uri",s)),await a().then(u=>{this.session=u,this.namespaces||(this.namespaces=pE(u.namespaces),this.persist("namespaces",this.namespaces))}).catch(u=>{if(u.message!==Of)throw u;i++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(t,i){try{if(!this.session)return;const[s,a]=this.validateChain(t);this.getProvider(s).setDefaultChain(a,i)}catch(s){if(!/Please call connect/.test(s.message))throw s}}async cleanupPendingPairings(t={}){this.logger.info("Cleaning up inactive pairings...");const i=this.client.pairing.getAll();if(ys(i)){for(const s of i)t.deletePairings?this.client.core.expirer.set(s.topic,0):await this.client.core.relayer.subscriber.unsubscribe(s.topic);this.logger.info(`Inactive pairings cleared: ${i.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const t=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[t]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await XI.init({logger:this.providerOpts.logger||Nl,relayUrl:this.providerOpts.relayUrl||eE,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const t=[...new Set(Object.keys(this.session.namespaces).map(i=>Vs(i)))];gc("client",this.client),gc("events",this.events),gc("disableProviderPing",this.disableProviderPing),t.forEach(i=>{if(!this.session)return;const s=hE(i,this.session),a=Af(s),u=lE(this.namespaces,this.optionalNamespaces),f=yc(pa({},u[i]),{accounts:s,chains:a});switch(i){case"eip155":this.rpcProviders[i]=new gE({namespace:f});break;case"solana":this.rpcProviders[i]=new yE({namespace:f});break;case"cosmos":this.rpcProviders[i]=new vE({namespace:f});break;case"polkadot":this.rpcProviders[i]=new dE({namespace:f});break;case"cip34":this.rpcProviders[i]=new mE({namespace:f});break;case"elrond":this.rpcProviders[i]=new wE({namespace:f});break;case"multiversx":this.rpcProviders[i]=new _E({namespace:f});break;case"near":this.rpcProviders[i]=new bE({namespace:f});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",t=>{this.events.emit("session_ping",t)}),this.client.on("session_event",t=>{const{params:i}=t,{event:s}=i;if(s.name==="accountsChanged"){const a=s.data;a&&ys(a)&&this.events.emit("accountsChanged",a.map(fE))}else if(s.name==="chainChanged"){const a=i.chainId,u=i.event.data,f=Vs(a),y=dc(a)!==dc(u)?`${f}:${dc(u)}`:a;this.onChainChanged(y)}else this.events.emit(s.name,s.data);this.events.emit("session_event",t)}),this.client.on("session_update",({topic:t,params:i})=>{var s;const{namespaces:a}=i,u=(s=this.client)==null?void 0:s.session.get(t);this.session=yc(pa({},u),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:t,params:i})}),this.client.on("session_delete",async t=>{await this.cleanup(),this.events.emit("session_delete",t),this.events.emit("disconnect",yc(pa({},kt("USER_DISCONNECTED")),{data:t.topic}))}),this.on(ai.DEFAULT_CHAIN_CHANGED,t=>{this.onChainChanged(t,!0)})}getProvider(t){if(!this.rpcProviders[t])throw new Error(`Provider not found: ${t}`);return this.rpcProviders[t]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(t=>{var i;this.getProvider(t).updateNamespace((i=this.session)==null?void 0:i.namespaces[t])})}setNamespaces(t){const{namespaces:i,optionalNamespaces:s,sessionProperties:a}=t;i&&Object.keys(i).length&&(this.namespaces=i),s&&Object.keys(s).length&&(this.optionalNamespaces=s),this.sessionProperties=a,this.persist("namespaces",i),this.persist("optionalNamespaces",s)}validateChain(t){const[i,s]=(t==null?void 0:t.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[i,s];if(i&&!Object.keys(this.namespaces||{}).map(f=>Vs(f)).includes(i))throw new Error(`Namespace '${i}' is not configured. Please call connect() first with namespace config.`);if(i&&s)return[i,s];const a=Vs(Object.keys(this.namespaces)[0]),u=this.rpcProviders[a].getDefaultChain();return[a,u]}async requestAccounts(){const[t]=this.validateChain();return await this.getProvider(t).requestAccounts()}onChainChanged(t,i=!1){var s;if(!this.namespaces)return;const[a,u]=this.validateChain(t);i||this.getProvider(a).setDefaultChain(u),((s=this.namespaces[a])!=null?s:this.namespaces[`${a}:${u}`]).defaultChain=u,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",u)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(t,i){this.client.core.storage.setItem(`${Dl}/${t}`,i)}async getFromStore(t){return await this.client.core.storage.getItem(`${Dl}/${t}`)}}const OE=Hc,RE="wc",AE="ethereum_provider",CE=`${RE}@2:${AE}:`,TE="https://rpc.walletconnect.com/v1/",Ac=["eth_sendTransaction","personal_sign"],$E=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],Cc=["chainChanged","accountsChanged"],NE=["chainChanged","accountsChanged","message","disconnect","connect"];var DE=Object.defineProperty,qE=Object.defineProperties,jE=Object.getOwnPropertyDescriptors,Ul=Object.getOwnPropertySymbols,LE=Object.prototype.hasOwnProperty,zE=Object.prototype.propertyIsEnumerable,Hl=(o,t,i)=>t in o?DE(o,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[t]=i,Bs=(o,t)=>{for(var i in t||(t={}))LE.call(t,i)&&Hl(o,i,t[i]);if(Ul)for(var i of Ul(t))zE.call(t,i)&&Hl(o,i,t[i]);return o},kl=(o,t)=>qE(o,jE(t));function _a(o){return Number(o[0].split(":")[1])}function vc(o){return`0x${o.toString(16)}`}function ME(o){const{chains:t,optionalChains:i,methods:s,optionalMethods:a,events:u,optionalEvents:f,rpcMap:y}=o;if(!ys(t))throw new Error("Invalid chains");const m={chains:t,methods:s||Ac,events:u||Cc,rpcMap:Bs({},t.length?{[_a(t)]:y[_a(t)]}:{})},d=u==null?void 0:u.filter(D=>!Cc.includes(D)),_=s==null?void 0:s.filter(D=>!Ac.includes(D));if(!i&&!f&&!a&&!(d!=null&&d.length)&&!(_!=null&&_.length))return{required:t.length?m:void 0};const S=(d==null?void 0:d.length)&&(_==null?void 0:_.length)||!i,R={chains:[...new Set(S?m.chains.concat(i||[]):i)],methods:[...new Set(m.methods.concat(a!=null&&a.length?a:$E))],events:[...new Set(m.events.concat(f!=null&&f.length?f:NE))],rpcMap:y};return{required:t.length?m:void 0,optional:i.length?R:void 0}}class kc{constructor(){this.events=new qr.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=CE,this.on=(t,i)=>(this.events.on(t,i),this),this.once=(t,i)=>(this.events.once(t,i),this),this.removeListener=(t,i)=>(this.events.removeListener(t,i),this),this.off=(t,i)=>(this.events.off(t,i),this),this.parseAccount=t=>this.isCompatibleChainId(t)?this.parseAccountId(t).address:t,this.signer={},this.rpc={}}static async init(t){const i=new kc;return await i.initialize(t),i}async request(t){return await this.signer.request(t,this.formatChainId(this.chainId))}sendAsync(t,i){this.signer.sendAsync(t,i,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(t){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(t);const{required:i,optional:s}=ME(this.rpc);try{const a=await new Promise(async(f,y)=>{var m;this.rpc.showQrModal&&((m=this.modal)==null||m.subscribeModal(d=>{!d.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),y(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(kl(Bs({namespaces:Bs({},i&&{[this.namespace]:i})},s&&{optionalNamespaces:{[this.namespace]:s}}),{pairingTopic:t==null?void 0:t.pairingTopic})).then(d=>{f(d)}).catch(d=>{y(new Error(d.message))})});if(!a)return;const u=W0(a.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:u),this.setAccounts(u),this.events.emit("connect",{chainId:vc(this.chainId)})}catch(a){throw this.signer.logger.error(a),a}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",t=>{const{params:i}=t,{event:s}=i;s.name==="accountsChanged"?(this.accounts=this.parseAccounts(s.data),this.events.emit("accountsChanged",this.accounts)):s.name==="chainChanged"?this.setChainId(this.formatChainId(s.data)):this.events.emit(s.name,s.data),this.events.emit("session_event",t)}),this.signer.on("chainChanged",t=>{const i=parseInt(t);this.chainId=i,this.events.emit("chainChanged",vc(this.chainId)),this.persist()}),this.signer.on("session_update",t=>{this.events.emit("session_update",t)}),this.signer.on("session_delete",t=>{this.reset(),this.events.emit("session_delete",t),this.events.emit("disconnect",kl(Bs({},kt("USER_DISCONNECTED")),{data:t.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",t=>{var i,s;this.rpc.showQrModal&&((i=this.modal)==null||i.closeModal(),(s=this.modal)==null||s.openModal({uri:t})),this.events.emit("display_uri",t)})}switchEthereumChain(t){this.request({method:"wallet_switchEthereumChain",params:[{chainId:t.toString(16)}]})}isCompatibleChainId(t){return typeof t=="string"?t.startsWith(`${this.namespace}:`):!1}formatChainId(t){return`${this.namespace}:${t}`}parseChainId(t){return Number(t.split(":")[1])}setChainIds(t){const i=t.filter(s=>this.isCompatibleChainId(s)).map(s=>this.parseChainId(s));i.length&&(this.chainId=i[0],this.events.emit("chainChanged",vc(this.chainId)),this.persist())}setChainId(t){if(this.isCompatibleChainId(t)){const i=this.parseChainId(t);this.chainId=i,this.switchEthereumChain(i)}}parseAccountId(t){const[i,s,a]=t.split(":");return{chainId:`${i}:${s}`,address:a}}setAccounts(t){this.accounts=t.filter(i=>this.parseChainId(this.parseAccountId(i).chainId)===this.chainId).map(i=>this.parseAccountId(i).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(t){var i,s;const a=(i=t==null?void 0:t.chains)!=null?i:[],u=(s=t==null?void 0:t.optionalChains)!=null?s:[],f=a.concat(u);if(!f.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const y=a.length?(t==null?void 0:t.methods)||Ac:[],m=a.length?(t==null?void 0:t.events)||Cc:[],d=(t==null?void 0:t.optionalMethods)||[],_=(t==null?void 0:t.optionalEvents)||[],S=(t==null?void 0:t.rpcMap)||this.buildRpcMap(f,t.projectId),R=(t==null?void 0:t.qrModalOptions)||void 0;return{chains:a==null?void 0:a.map(D=>this.formatChainId(D)),optionalChains:u.map(D=>this.formatChainId(D)),methods:y,events:m,optionalMethods:d,optionalEvents:_,rpcMap:S,showQrModal:!!(t!=null&&t.showQrModal),qrModalOptions:R,projectId:t.projectId,metadata:t.metadata}}buildRpcMap(t,i){const s={};return t.forEach(a=>{s[a]=this.getRpcUrl(a,i)}),s}async initialize(t){if(this.rpc=this.getRpcConfig(t),this.chainId=this.rpc.chains.length?_a(this.rpc.chains):_a(this.rpc.optionalChains),this.signer=await OE.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:t.disableProviderPing,relayUrl:t.relayUrl,storageOptions:t.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let i;try{const{WalletConnectModal:s}=await J0(()=>import("./index-D_Om384i.js").then(a=>a.i),__vite__mapDeps([0,1,2]));i=s}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(i)try{this.modal=new i(Bs({projectId:this.rpc.projectId},this.rpc.qrModalOptions))}catch(s){throw this.signer.logger.error(s),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(t){if(!t)return;const{chains:i,optionalChains:s,rpcMap:a}=t;i&&ys(i)&&(this.rpc.chains=i.map(u=>this.formatChainId(u)),i.forEach(u=>{this.rpc.rpcMap[u]=(a==null?void 0:a[u])||this.getRpcUrl(u)})),s&&ys(s)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=s==null?void 0:s.map(u=>this.formatChainId(u)),s.forEach(u=>{this.rpc.rpcMap[u]=(a==null?void 0:a[u])||this.getRpcUrl(u)}))}getRpcUrl(t,i){var s;return((s=this.rpc.rpcMap)==null?void 0:s[t])||`${TE}?chainId=eip155:${t}&projectId=${i||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const t=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),i=this.session.namespaces[`${this.namespace}:${t}`]?this.session.namespaces[`${this.namespace}:${t}`]:this.session.namespaces[this.namespace];this.setChainIds(t?[this.formatChainId(t)]:i==null?void 0:i.accounts),this.setAccounts(i==null?void 0:i.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(t){return typeof t=="string"||t instanceof String?[this.parseAccount(t)]:t.map(i=>this.parseAccount(i))}}const tx=kc;export{tx as EthereumProvider,NE as OPTIONAL_EVENTS,$E as OPTIONAL_METHODS,Cc as REQUIRED_EVENTS,Ac as REQUIRED_METHODS,kc as default};
